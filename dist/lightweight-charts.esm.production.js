/*!
 * @license
 * TradingView Lightweight Charts v4.0.0
 * Copyright (c) 2022 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
import{bindToDevicePixelRatio as t}from"fancy-canvas/coordinate-space";var i,s;function n(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function e(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(n,i+e),t.stroke()}function r(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function h(t){if(void 0===t)throw new Error("Value is undefined");return t}function l(t){if(null===t)throw new Error("Value is null");return t}function a(t){return l(h(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(i||(i={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(s||(s={}));const o={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function _(t){return t<0?0:t>255?255:Math.round(t)||0}function u(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const c=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,d=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,f=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,p=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function v(t){(t=t.toLowerCase())in o&&(t=o[t]);{const i=p.exec(t)||f.exec(t);if(i)return[_(parseInt(i[1],10)),_(parseInt(i[2],10)),_(parseInt(i[3],10)),u(i.length<5?1:parseFloat(i[4]))]}{const i=d.exec(t);if(i)return[_(parseInt(i[1],16)),_(parseInt(i[2],16)),_(parseInt(i[3],16)),1]}{const i=c.exec(t);if(i)return[_(17*parseInt(i[1],16)),_(17*parseInt(i[2],16)),_(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function m(t){const i=v(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class w{constructor(){this.h=[]}l(t,i,s){const n={o:t,_:i,u:!0===s};this.h.push(n)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}M(){return this.h.length>0}S(){this.h=[]}}function b(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:b(t[i],s[i]));return t}function g(t){return"number"==typeof t&&isFinite(t)}function M(t){return"number"==typeof t&&t%1==0}function S(t){return"string"==typeof t}function y(t){return"boolean"==typeof t}function k(t){const i=t;if(!i||"object"!=typeof i)return i;let s,n,e;for(n in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(n)&&(e=i[n],s[n]=e&&"object"==typeof e?k(e):e);return s}function x(t){return null!==t}function C(t){return null===t?void 0:t}const T="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function P(t,i,s){return void 0===i&&(i=T),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class D{constructor(t){this.k={C:1,T:4,P:NaN,D:"",O:"",I:"",N:0,R:0,A:0,L:0,V:0},this.B=t}F(){const t=this.k,i=this.W(),s=this.j();return t.P===i&&t.O===s||(t.P=i,t.O=s,t.D=P(i,s),t.L=Math.floor(i/3.5),t.N=t.L,t.R=Math.max(Math.ceil(i/2-t.T/2),0),t.A=Math.ceil(i/2+t.T/2),t.V=Math.round(i/10)),t.I=this.$(),this.k}$(){return this.B.F().layout.textColor}W(){return this.B.F().layout.fontSize}j(){return this.B.F().layout.fontFamily}}class E{constructor(){this.H=[]}U(t){this.H=t}q(t,i,s,n){this.H.forEach((e=>{t.save(),e.q(t,i,s,n),t.restore()}))}}class O{q(t,i,s,n){t.save(),t.scale(i,i),this.Y(t,s,n),t.restore()}X(t,i,s,n){t.save(),t.scale(i,i),this.K(t,s,n),t.restore()}K(t,i,s){}}class I extends O{constructor(){super(...arguments),this.Z=null}G(t){this.Z=t}Y(t){if(null===this.Z||null===this.Z.J)return;const i=this.Z.J,s=this.Z,n=n=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.tt[e];t.moveTo(i.it,i.st),t.arc(i.it,i.st,n,0,2*Math.PI)}t.fill()};t.fillStyle=s.nt,n(s.et+2),t.fillStyle=s.rt,n(s.et)}}function N(){return{tt:[{it:0,st:0,ht:0,lt:0}],rt:"",nt:"",et:0,J:null}}const R={from:0,to:1};class A{constructor(t,i){this.ot=new E,this._t=[],this.ut=[],this.ct=new Map,this.B=t,this.dt=i,this.ot.U(this._t)}ft(t){const i=this.B.vt();i.length!==this._t.length&&(this.ut=i.map(N),this._t=this.ut.map((t=>{const i=new I;return i.G(t),i})),this.ot.U(this._t)),this.ct.clear()}wt(t,i,s,n){let e=this.ct.get(s);if(!e){e=this.bt(s,t),this.ct.set(s,e);const i=new E;return i.U(e),i}const r=new E;return r.U(e),r}bt(t,i){const s=this.B.vt().map(((t,i)=>[t,i])).filter((i=>t.gt().includes(i[0]))),n=this.dt.Mt(),e=this.B.St();return s.map((([t,s])=>{var r;const h=this.ut[s],a=t.yt(n);if(null!==a&&t.kt()){const s=l(t.xt());h.rt=a.Ct,h.et=a.et,h.tt[0].lt=a.lt,h.tt[0].st=t.Pt().Tt(a.lt,s.Dt),h.nt=null!==(r=a.Et)&&void 0!==r?r:this.B.Ot(h.tt[0].st/i),h.tt[0].ht=n,h.tt[0].it=e.It(n),h.J=R}else h.J=null;return this._t[s]}))}}class L{constructor(t){this.Nt=t}q(t,i,s,r){if(null===this.Nt)return;const h=this.Nt.Rt.kt,l=this.Nt.At.kt;if(!h&&!l)return;t.save();const a=Math.round(this.Nt.it*i),o=Math.round(this.Nt.st*i),_=Math.ceil(this.Nt.Lt*i),u=Math.ceil(this.Nt.Vt*i);t.lineCap="butt",h&&a>=0&&(t.lineWidth=Math.floor(this.Nt.Rt.Bt*i),t.strokeStyle=this.Nt.Rt.I,t.fillStyle=this.Nt.Rt.I,n(t,this.Nt.Rt.Ft),function(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,s),t.lineTo(i+e,n),t.stroke()}(t,a,0,u)),l&&o>=0&&(t.lineWidth=Math.floor(this.Nt.At.Bt*i),t.strokeStyle=this.Nt.At.I,t.fillStyle=this.Nt.At.I,n(t,this.Nt.At.Ft),e(t,o,0,_)),t.restore()}}class V{constructor(t){this.ct=new Map,this.zt={Rt:{Bt:1,Ft:0,I:"",kt:!1},At:{Bt:1,Ft:0,I:"",kt:!1},Lt:0,Vt:0,it:0,st:0},this.Wt=new L(this.zt),this.jt=t}ft(){this.ct.clear()}wt(t,i,s){return this.bt(s),this.Wt}bt(t){const i=this.jt.kt(),s=l(this.jt.Ht()).$t().F().crosshair,n=this.zt;n.At.kt=i&&this.jt.Ut(t),n.Rt.kt=i&&this.jt.qt(),n.At.Bt=s.horzLine.width,n.At.Ft=s.horzLine.style,n.At.I=s.horzLine.color,n.Rt.Bt=s.vertLine.width,n.Rt.Ft=s.vertLine.style,n.Rt.I=s.vertLine.color,n.Lt=t.Yt(),n.Vt=t.Xt(),n.it=this.jt.Kt(),n.st=this.jt.Zt()}}function B(t,i,s,n,e,r){t.fillRect(i+r,s,n-2*r,r),t.fillRect(i+r,s+e-r,n-2*r,r),t.fillRect(i,s,r,e),t.fillRect(i+n-r,s,r,e)}function F(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function z(t,i,s,n,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,s,n,e),t.restore()}function W(t,i,s,n,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,s,n,e),t.restore()}class j{constructor(t,i){this.G(t,i)}G(t,i){this.Nt=t,this.Gt=i}q(t,i,s,n,e,r){if(!this.Nt.kt)return;t.font=i.D;const h=this.Nt.Jt||!this.Nt.Qt?i.T:0,l=i.C,a=i.L,o=i.N,_=i.R,u=i.A,c=this.Nt.ti,d=Math.ceil(s.ii(t,c)),f=i.V,p=i.P+a+o,v=Math.ceil(.5*p),m=l+d+_+u+h;let w=this.Gt.si;this.Gt.ni&&(w=this.Gt.ni),w=Math.round(w);const b=w-v,g=b+p,M="right"===e,S=M?n:0,y=Math.ceil(n*r);let k,x,C=S;if(t.fillStyle=this.Gt.t,t.lineWidth=1,t.lineCap="butt",c){M?(C=S-m,k=S-h,x=C+u):(C=S+m,k=S+h,x=S+l+h+_);const i=Math.max(1,Math.floor(r)),s=Math.max(1,Math.floor(l*r)),n=M?y:0,e=Math.round(b*r),a=Math.round(C*r),d=Math.round(w*r)-Math.floor(.5*r),p=d+i+(d-e),v=Math.round(k*r);t.save(),t.beginPath(),t.moveTo(n,e),t.lineTo(a,e),t.lineTo(a,p),t.lineTo(n,p),t.fill(),t.fillStyle=this.Nt.Et,t.fillRect(M?y-s:0,e,s,p-e),this.Nt.Jt&&(t.fillStyle=this.Gt.I,t.fillRect(n,d,v-n,i)),t.textAlign="left",t.fillStyle=this.Gt.I,F(t,r,(()=>{t.fillText(c,x,g-o-f)})),t.restore()}}Xt(t,i){return this.Nt.kt?t.P+t.L+t.N:0}}class ${constructor(t){this.ei={si:0,I:"#FFF",t:"#000"},this.ri={ti:"",kt:!1,Jt:!0,Qt:!1,Et:""},this.hi={ti:"",kt:!1,Jt:!1,Qt:!0,Et:""},this.li=!0,this.ai=new(t||j)(this.ri,this.ei),this.oi=new(t||j)(this.hi,this.ei)}ti(){return this._i(),this.ri.ti}si(){return this._i(),this.ei.si}ft(){this.li=!0}Xt(t,i=!1){return Math.max(this.ai.Xt(t,i),this.oi.Xt(t,i))}ui(){return this.ei.ni||0}ci(t){this.ei.ni=t}di(){return this._i(),this.ri.kt||this.hi.kt}fi(){return this._i(),this.ri.kt}wt(t){return this._i(),this.ri.Jt=this.ri.Jt&&t.F().ticksVisible,this.hi.Jt=this.hi.Jt&&t.F().ticksVisible,this.ai.G(this.ri,this.ei),this.oi.G(this.hi,this.ei),this.ai}pi(){return this._i(),this.ai.G(this.ri,this.ei),this.oi.G(this.hi,this.ei),this.oi}_i(){this.li&&(this.ri.Jt=!0,this.hi.Jt=!1,this.vi(this.ri,this.hi,this.ei))}}class H extends ${constructor(t,i,s){super(),this.jt=t,this.mi=i,this.wi=s}vi(t,i,s){t.kt=!1;const n=this.jt.F().horzLine;if(!n.labelVisible)return;const e=this.mi.xt();if(!this.jt.kt()||this.mi.bi()||null===e)return;const r=m(n.labelBackgroundColor);s.t=r.t,s.I=r.i;const h=this.wi(this.mi);s.si=h.si,t.ti=this.mi.gi(h.lt,e),t.kt=!0}}const U=/[1-9]/g;class q{constructor(){this.Nt=null}G(t){this.Nt=t}q(t,i,s){if(null===this.Nt||!1===this.Nt.kt||0===this.Nt.ti.length)return;t.font=i.D;const n=Math.round(i.Mi.ii(t,this.Nt.ti,U));if(n<=0)return;t.save();const e=i.Si,r=n+2*e,h=r/2,a=this.Nt.Yt;let o=this.Nt.si,_=Math.floor(o-h)+.5;_<0?(o+=Math.abs(0-_),_=Math.floor(o-h)+.5):_+r>a&&(o-=Math.abs(a-(_+r)),_=Math.floor(o-h)+.5);const u=_+r,c=0+i.C+i.L+i.P+i.N;t.fillStyle=this.Nt.t;const d=Math.round(_*s),f=Math.round(0*s),p=Math.round(u*s),v=Math.round(c*s);if(t.fillRect(d,f,p-d,v-f),this.Nt.Jt){const n=Math.round(this.Nt.si*s),e=f,r=Math.round((e+i.C+i.T)*s);t.fillStyle=this.Nt.I;const h=Math.max(1,Math.floor(s)),l=Math.floor(.5*s);t.fillRect(n-l,e,h,r-e)}const m=c-i.V-i.N;t.textAlign="left",t.fillStyle=this.Nt.I,F(t,s,(()=>{t.fillText(l(this.Nt).ti,_+e,m)})),t.restore()}}class Y{constructor(t,i,s){this.li=!0,this.Wt=new q,this.zt={kt:!1,t:"#4c525e",I:"white",ti:"",Yt:0,si:NaN,Jt:!0},this.dt=t,this.yi=i,this.wi=s}ft(){this.li=!0}wt(){return this.li&&(this.bt(),this.li=!1),this.Wt.G(this.zt),this.Wt}bt(){const t=this.zt;t.kt=!1;const i=this.dt.F().vertLine;if(!i.labelVisible)return;const s=this.yi.St();if(s.bi())return;t.Yt=s.Yt();const n=this.wi();if(!n.ht)return;t.si=n.si;const e=s.ki(this.dt.Mt());t.ti=s.xi(l(e)),t.kt=!0;const r=m(i.labelBackgroundColor);t.t=r.t,t.I=r.i,t.Jt=s.F().ticksVisible}}class X{constructor(){this.Ci=null,this.Ti=0}Pi(){return this.Ti}Di(t){this.Ti=t}Pt(){return this.Ci}Ei(t){this.Ci=t}Oi(t){return[]}Ii(){return[]}kt(){return!0}}var K;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(K||(K={}));class Z extends X{constructor(t,i){super(),this.Ni=null,this.Ri=NaN,this.Ai=0,this.Li=!0,this.Vi=new Map,this.Bi=!1,this.Fi=NaN,this.zi=NaN,this.Wi=NaN,this.ji=NaN,this.yi=t,this.$i=i,this.Hi=new A(t,this);this.Ui=((t,i)=>s=>{const n=i(),e=t();if(s===l(this.Ni).qi())return{lt:e,si:n};{const t=l(s.xt());return{lt:s.Yi(n,t),si:n}}})((()=>this.Ri),(()=>this.zi));const s=((t,i)=>()=>({ht:this.yi.St().Xi(t()),si:i()}))((()=>this.Ai),(()=>this.Kt()));this.Ki=new Y(this,t,s),this.Zi=new V(this)}F(){return this.$i}Gi(t,i){this.Wi=t,this.ji=i}Ji(){this.Wi=NaN,this.ji=NaN}Qi(){return this.Wi}ts(){return this.ji}ss(t,i,s){this.Bi||(this.Bi=!0),this.Li=!0,this.ns(t,i,s)}Mt(){return this.Ai}Kt(){return this.Fi}Zt(){return this.zi}kt(){return this.Li}es(){this.Li=!1,this.rs(),this.Ri=NaN,this.Fi=NaN,this.zi=NaN,this.Ni=null,this.Ji()}hs(t){return null!==this.Ni?[this.Zi,this.Hi]:[]}Ut(t){return t===this.Ni&&this.$i.horzLine.visible}qt(){return this.$i.vertLine.visible}ls(t,i){this.Li&&this.Ni===t||this.Vi.clear();const s=[];return this.Ni===t&&s.push(this.os(this.Vi,i,this.Ui)),s}Ii(){return this.Li?[this.Ki]:[]}Ht(){return this.Ni}_s(){this.Zi.ft(),this.Vi.forEach((t=>t.ft())),this.Ki.ft(),this.Hi.ft()}us(t){return t&&!t.qi().bi()?t.qi():null}ns(t,i,s){this.cs(t,i,s)&&this._s()}cs(t,i,s){const n=this.Fi,e=this.zi,r=this.Ri,h=this.Ai,l=this.Ni,a=this.us(s);this.Ai=t,this.Fi=isNaN(t)?NaN:this.yi.St().It(t),this.Ni=s;const o=null!==a?a.xt():null;return null!==a&&null!==o?(this.Ri=i,this.zi=a.Tt(i,o)):(this.Ri=NaN,this.zi=NaN),n!==this.Fi||e!==this.zi||h!==this.Ai||r!==this.Ri||l!==this.Ni}rs(){const t=this.yi.vt().map((t=>t.fs().ds())).filter(x),i=0===t.length?null:Math.max(...t);this.Ai=null!==i?i:NaN}os(t,i,s){let n=t.get(i);return void 0===n&&(n=new H(this,i,s),t.set(i,n)),n}}function G(t){return"left"===t||"right"===t}class J{constructor(t){this.ps=new Map,this.vs=[],this.ws=t}bs(t,i){const s=function(t,i){return void 0===t?i:{gs:Math.max(t.gs,i.gs),Ms:t.Ms||i.Ms}}(this.ps.get(t),i);this.ps.set(t,s)}Ss(){return this.ws}ys(t){const i=this.ps.get(t);return void 0===i?{gs:this.ws}:{gs:Math.max(this.ws,i.gs),Ms:i.Ms}}ks(){this.vs=[{xs:0}]}Cs(t){this.vs=[{xs:1,Dt:t}]}Ts(){this.vs=[{xs:4}]}Ps(t){this.vs.push({xs:2,Dt:t})}Ds(t){this.vs.push({xs:3,Dt:t})}Es(){return this.vs}Os(t){for(const i of t.vs)this.Is(i);this.ws=Math.max(this.ws,t.ws),t.ps.forEach(((t,i)=>{this.bs(i,t)}))}Is(t){switch(t.xs){case 0:this.ks();break;case 1:this.Cs(t.Dt);break;case 2:this.Ps(t.Dt);break;case 3:this.Ds(t.Dt);break;case 4:this.Ts()}}}const Q=".";function tt(t,i){if(!g(t))return"n/a";if(!M(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class it{constructor(t,i){if(i||(i=1),g(t)&&M(t)||(t=100),t<0)throw new TypeError("invalid base");this.mi=t,this.Ns=i,this.Rs()}format(t){const i=t<0?"−":"";return t=Math.abs(t),i+this.As(t)}Rs(){if(this.Ls=0,this.mi>0&&this.Ns>0){let t=this.mi;for(;t>1;)t/=10,this.Ls++}}As(t){const i=this.mi/this.Ns;let s=Math.floor(t),n="";const e=void 0!==this.Ls?this.Ls:NaN;if(i>1){let r=+(Math.round(t*i)-s*i).toFixed(this.Ls);r>=i&&(r-=i,s+=1),n=Q+tt(+r.toFixed(this.Ls)*this.Ns,e)}else s=Math.round(s*i)/i,e>0&&(n=Q+tt(0,e));return s.toFixed(0)+n}}class st extends it{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class nt{constructor(t){this.Vs=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.Bs(t):t<999995?i+this.Bs(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.Bs(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.Bs(t/1e9)+"B")}Bs(t){let i;const s=Math.pow(10,this.Vs);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.Vs).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function et(t,i,s,n){if(0===i.length)return;const e=i[n.from].it,r=i[n.from].st;t.moveTo(e,r);for(let e=n.from+1;e<n.to;++e){const n=i[e];switch(s){case 0:t.lineTo(n.it,n.st);break;case 1:t.lineTo(n.it,i[e-1].st),t.lineTo(n.it,n.st);break;case 2:{const[s,r]=at(i,e-1,e);t.bezierCurveTo(s.it,s.st,r.it,r.st,n.it,n.st);break}}}}const rt=6;function ht(t,i){return{it:t.it-i.it,st:t.st-i.st}}function lt(t,i){return{it:t.it/i,st:t.st/i}}function at(t,i,s){const n=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var r,h;return[(r=t[i],h=lt(ht(t[s],t[n]),rt),{it:r.it+h.it,st:r.st+h.st}),ht(t[s],lt(ht(t[e],t[i]),rt))]}class ot extends O{constructor(){super(...arguments),this.Z=null}G(t){this.Z=t}Y(t){if(null!==this.Z&&0!==this.Z.tt.length&&null!==this.Z.J){if(t.lineCap="butt",t.lineJoin="round",t.lineWidth=this.Z.Bt,n(t,this.Z.Ft),t.lineWidth=1,t.beginPath(),1===this.Z.tt.length){const i=this.Z.tt[0],s=this.Z.Fs/2;t.moveTo(i.it-s,this.Z.zs),t.lineTo(i.it-s,i.st),t.lineTo(i.it+s,i.st),t.lineTo(i.it+s,this.Z.zs)}else t.moveTo(this.Z.tt[this.Z.J.from].it,this.Z.zs),t.lineTo(this.Z.tt[this.Z.J.from].it,this.Z.tt[this.Z.J.from].st),et(t,this.Z.tt,this.Z.Ws,this.Z.J),this.Z.J.to>this.Z.J.from&&(t.lineTo(this.Z.tt[this.Z.J.to-1].it,this.Z.zs),t.lineTo(this.Z.tt[this.Z.J.from].it,this.Z.zs));t.closePath(),t.fillStyle=this.js(t),t.fill()}}}class _t extends ot{js(t){const i=this.Z,s=t.createLinearGradient(0,0,0,i.$s);return s.addColorStop(0,i.Hs),s.addColorStop(1,i.Us),s}}class ut extends O{constructor(){super(...arguments),this.Z=null}G(t){this.Z=t}Y(t){if(null!==this.Z&&0!==this.Z.tt.length&&null!==this.Z.J)if(t.lineCap="butt",t.lineWidth=this.Z.Bt,n(t,this.Z.Ft),t.strokeStyle=this.qs(t),t.lineJoin="round",1===this.Z.tt.length){t.beginPath();const i=this.Z.tt[0];t.moveTo(i.it-this.Z.Fs/2,i.st),t.lineTo(i.it+this.Z.Fs/2,i.st),void 0!==i.I&&(t.strokeStyle=i.I),t.stroke()}else this.Ys(t,this.Z)}Ys(t,i){t.beginPath(),et(t,i.tt,i.Ws,i.J),t.stroke()}}class ct extends ut{Ys(t,i){var s,n;const{tt:e,J:r,Ws:h,rt:l}=i;if(0===e.length||null===r)return;t.beginPath();const a=e[r.from];t.moveTo(a.it,a.st);let o=null!==(s=a.I)&&void 0!==s?s:l;t.strokeStyle=o;const _=i=>{t.stroke(),t.beginPath(),t.strokeStyle=i,o=i};for(let i=r.from+1;i<r.to;++i){const s=e[i],r=null!==(n=s.I)&&void 0!==n?n:l;switch(h){case 0:t.lineTo(s.it,s.st);break;case 1:t.lineTo(s.it,e[i-1].st),r!==o&&(_(r),t.lineTo(s.it,e[i-1].st)),t.lineTo(s.it,s.st);break;case 2:{const[n,r]=at(e,i-1,i);t.bezierCurveTo(n.it,n.st,r.it,r.st,s.it,s.st);break}}1!==h&&r!==o&&(_(r),t.moveTo(s.it,s.st))}t.stroke()}qs(){return this.Z.rt}}function dt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(t[h],i)?(n=h+1,r-=e+1):r=e}return n}function ft(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(i,t[h])?r=e:(n=h+1,r-=e+1)}return n}function pt(t,i){return t.ht<i}function vt(t,i){return t<i.ht}function mt(t,i,s){const n=i.Xs(),e=i.Ks(),r=dt(t,n,pt),h=ft(t,e,vt);if(!s)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r].ht>=n&&(l=r-1),h>0&&h<t.length&&t[h-1].ht<=e&&(a=h+1),{from:l,to:a}}class wt{constructor(t,i,s){this.Zs=!0,this.Gs=!0,this.Js=!0,this.Qs=[],this.tn=null,this.sn=t,this.nn=i,this.en=s}ft(t){this.Zs=!0,"data"===t&&(this.Gs=!0),"options"===t&&(this.Js=!0)}rn(){this.Gs&&(this.hn(),this.Gs=!1),this.Zs&&(this.ln(),this.Zs=!1),this.Js&&(this.an(),this.Js=!1)}on(){this.tn=null}ln(){const t=this.sn.Pt(),i=this.nn.St();if(this.on(),i.bi()||t.bi())return;const s=i._n();if(null===s)return;if(0===this.sn.fs().un())return;const n=this.sn.xt();null!==n&&(this.tn=mt(this.Qs,s,this.en),this.cn(t,i,n.Dt))}}class bt extends wt{constructor(t,i){super(t,i,!0)}cn(t,i,s){i.dn(this.Qs,C(this.tn)),t.fn(this.Qs,s,C(this.tn))}pn(t,i){return{ht:t,lt:i,it:NaN,st:NaN}}an(){}hn(){const t=this.sn.vn();this.Qs=this.sn.fs().mn().map((i=>{const s=i.Dt[3];return this.wn(i.bn,s,t)}))}}class gt extends bt{constructor(t,i){super(t,i),this.Wt=new E,this.gn=new _t,this.Mn=new ct,this.Wt.U([this.gn,this.Mn])}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.F();return this.rn(),this.gn.G({Ws:s.lineType,tt:this.Qs,Ft:s.lineStyle,Bt:s.lineWidth,Hs:s.topColor,Us:s.bottomColor,zs:t,$s:t,J:this.tn,Fs:this.nn.St().Sn()}),this.Mn.G({Ws:s.lineType,tt:this.Qs,rt:s.lineColor,Ft:s.lineStyle,Bt:s.lineWidth,J:this.tn,Fs:this.nn.St().Sn()}),this.Wt}wn(t,i){return this.pn(t,i)}}class Mt{constructor(){this.Nt=null,this.yn=0,this.kn=0}G(t){this.Nt=t}q(t,i,s,n){if(null===this.Nt||0===this.Nt.fs.length||null===this.Nt.J)return;if(this.yn=this.xn(i),this.yn>=2){Math.max(1,Math.floor(i))%2!=this.yn%2&&this.yn--}this.kn=this.Nt.Cn?Math.min(this.yn,Math.floor(i)):this.yn;let e=null;const r=this.kn<=this.yn&&this.Nt.Sn>=Math.floor(1.5*i);for(let s=this.Nt.J.from;s<this.Nt.J.to;++s){const n=this.Nt.fs[s];e!==n.I&&(t.fillStyle=n.I,e=n.I);const h=Math.floor(.5*this.kn),l=Math.round(n.it*i),a=l-h,o=this.kn,_=a+o-1,u=Math.min(n.Tn,n.Pn),c=Math.max(n.Tn,n.Pn),d=Math.round(u*i)-h,f=Math.round(c*i)+h,p=Math.max(f-d,this.kn);t.fillRect(a,d,o,p);const v=Math.ceil(1.5*this.yn);if(r){if(this.Nt.Dn){const s=l-v;let e=Math.max(d,Math.round(n.En*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(s,e,a-s,r-e+1)}const s=l+v;let e=Math.max(d,Math.round(n.On*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(_+1,e,s-_,r-e+1)}}}xn(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(l(this.Nt).Sn,t)))}}class St extends wt{constructor(t,i){super(t,i,!1)}cn(t,i,s){i.dn(this.Qs,C(this.tn)),t.In(this.Qs,s,C(this.tn))}Nn(t,i,s){return{ht:t,Rn:i.Dt[0],An:i.Dt[1],Ln:i.Dt[2],Vn:i.Dt[3],it:NaN,En:NaN,Tn:NaN,Pn:NaN,On:NaN}}hn(){const t=this.sn.vn();this.Qs=this.sn.fs().mn().map((i=>this.wn(i.bn,i,t)))}}class yt extends St{constructor(){super(...arguments),this.Wt=new Mt}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.F();this.rn();const n={fs:this.Qs,Sn:this.nn.St().Sn(),Dn:s.openVisible,Cn:s.thinBars,J:this.tn};return this.Wt.G(n),this.Wt}an(){this.Qs.forEach((t=>{t.I=this.sn.vn().Fn(t.ht).Bn}))}wn(t,i,s){return Object.assign(Object.assign({},this.Nn(t,i,s)),{I:s.Fn(t).Bn})}}function kt(t,i,s){return Math.min(Math.max(t,i),s)}function xt(t,i,s){return i-t<=s}function Ct(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Tt(t){const i=Math.ceil(t);return i%2!=0?i-1:i}function Pt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Dt extends ot{js(t){const i=this.Z,s=t.createLinearGradient(0,0,0,i.$s),n=kt(i.zs/i.$s,0,1);return s.addColorStop(0,i.zn),s.addColorStop(n,i.Wn),s.addColorStop(n,i.jn),s.addColorStop(1,i.$n),s}}class Et extends ut{qs(t){const i=this.Z,s=t.createLinearGradient(0,0,0,i.$s),n=kt(i.zs/i.$s,0,1);return s.addColorStop(0,i.Hs),s.addColorStop(n,i.Hs),s.addColorStop(n,i.Us),s.addColorStop(1,i.Us),s}}class Ot extends bt{constructor(t,i){super(t,i),this.Hn=new Dt,this.Un=new Et,this.ot=new E,this.ot.U([this.Hn,this.Un])}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.xt();if(null===s)return null;const n=this.sn.F();this.rn();const e=this.sn.Pt().Tt(n.baseValue.price,s.Dt),r=this.nn.St().Sn();return this.Hn.G({tt:this.Qs,zn:n.topFillColor1,Wn:n.topFillColor2,jn:n.bottomFillColor1,$n:n.bottomFillColor2,Bt:n.lineWidth,Ft:n.lineStyle,Ws:n.lineType,zs:e,$s:t,J:this.tn,Fs:r}),this.Un.G({tt:this.Qs,Hs:n.topLineColor,Us:n.bottomLineColor,Bt:n.lineWidth,Ft:n.lineStyle,Ws:n.lineType,zs:e,$s:t,J:this.tn,Fs:r}),this.ot}wn(t,i){return this.pn(t,i)}}class It{constructor(){this.Nt=null,this.yn=0}G(t){this.Nt=t}q(t,i,s,n){if(null===this.Nt||0===this.Nt.fs.length||null===this.Nt.J)return;if(this.yn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),n=Math.floor(t*s*i),e=Math.floor(t*i),r=Math.min(n,e);return Math.max(Math.floor(i),r)}(this.Nt.Sn,i),this.yn>=2){Math.floor(i)%2!=this.yn%2&&this.yn--}const e=this.Nt.fs;this.Nt.qn&&this.Yn(t,e,this.Nt.J,i),this.Nt.Xn&&this.Kn(t,e,this.Nt.J,this.Nt.Sn,i);const r=this.Zn(i);(!this.Nt.Xn||this.yn>2*r)&&this.Gn(t,e,this.Nt.J,i)}Yn(t,i,s,n){if(null===this.Nt)return;let e="",r=Math.min(Math.floor(n),Math.floor(this.Nt.Sn*n));r=Math.max(Math.floor(n),Math.min(r,this.yn));const h=Math.floor(.5*r);let l=null;for(let a=s.from;a<s.to;a++){const s=i[a];s.Jn!==e&&(t.fillStyle=s.Jn,e=s.Jn);const o=Math.round(Math.min(s.En,s.On)*n),_=Math.round(Math.max(s.En,s.On)*n),u=Math.round(s.Tn*n),c=Math.round(s.Pn*n);let d=Math.round(n*s.it)-h;const f=d+r-1;null!==l&&(d=Math.max(l+1,d),d=Math.min(d,f));const p=f-d+1;t.fillRect(d,u,p,o-u),t.fillRect(d,_+1,p,c-_),l=f}}Zn(t){let i=Math.floor(1*t);this.yn<=2*i&&(i=Math.floor(.5*(this.yn-1)));const s=Math.max(Math.floor(t),i);return this.yn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}Kn(t,i,s,n,e){if(null===this.Nt)return;let r="";const h=this.Zn(e);let l=null;for(let n=s.from;n<s.to;n++){const s=i[n];s.Et!==r&&(t.fillStyle=s.Et,r=s.Et);let a=Math.round(s.it*e)-Math.floor(.5*this.yn);const o=a+this.yn-1,_=Math.round(Math.min(s.En,s.On)*e),u=Math.round(Math.max(s.En,s.On)*e);if(null!==l&&(a=Math.max(l+1,a),a=Math.min(a,o)),this.Nt.Sn*e>2*h)B(t,a,_,o-a+1,u-_+1,h);else{const i=o-a+1;t.fillRect(a,_,i,u-_+1)}l=o}}Gn(t,i,s,n){if(null===this.Nt)return;let e="";const r=this.Zn(n);for(let h=s.from;h<s.to;h++){const s=i[h];let l=Math.round(Math.min(s.En,s.On)*n),a=Math.round(Math.max(s.En,s.On)*n),o=Math.round(s.it*n)-Math.floor(.5*this.yn),_=o+this.yn-1;if(s.I!==e){const i=s.I;t.fillStyle=i,e=i}this.Nt.Xn&&(o+=r,l+=r,_-=r,a-=r),l>a||t.fillRect(o,l,_-o+1,a-l+1)}}}class Nt extends St{constructor(){super(...arguments),this.Wt=new It}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.F();this.rn();const n={fs:this.Qs,Sn:this.nn.St().Sn(),qn:s.wickVisible,Xn:s.borderVisible,J:this.tn};return this.Wt.G(n),this.Wt}an(){this.Qs.forEach((t=>{const i=this.sn.vn().Fn(t.ht);t.I=i.Bn,t.Jn=i.Qn,t.Et=i.te}))}wn(t,i,s){const n=s.Fn(t);return Object.assign(Object.assign({},this.Nn(t,i,s)),{I:n.Bn,Jn:n.Qn,Et:n.te})}}class Rt{constructor(){this.Nt=null,this.ie=[]}G(t){this.Nt=t,this.ie=[]}q(t,i,s,n){if(null===this.Nt||0===this.Nt.tt.length||null===this.Nt.J)return;this.ie.length||this.se(i);const e=Math.max(1,Math.floor(i)),r=Math.round(this.Nt.ne*i)-Math.floor(e/2),h=r+e;for(let s=this.Nt.J.from;s<this.Nt.J.to;s++){const n=this.Nt.tt[s],l=this.ie[s-this.Nt.J.from],a=Math.round(n.st*i);let o,_;t.fillStyle=n.I,a<=r?(o=a,_=h):(o=r,_=a-Math.floor(e/2)+e),t.fillRect(l.Xs,o,l.Ks-l.Xs+1,_-o)}}se(t){if(null===this.Nt||0===this.Nt.tt.length||null===this.Nt.J)return void(this.ie=[]);const i=Math.ceil(this.Nt.Sn*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Nt.Sn*t)-i;this.ie=new Array(this.Nt.J.to-this.Nt.J.from);for(let i=this.Nt.J.from;i<this.Nt.J.to;i++){const n=this.Nt.tt[i],e=Math.round(n.it*t);let r,h;if(s%2){const t=(s-1)/2;r=e-t,h=e+t}else{const t=s/2;r=e-t,h=e+t-1}this.ie[i-this.Nt.J.from]={Xs:r,Ks:h,ee:e,re:n.it*t,ht:n.ht}}for(let t=this.Nt.J.from+1;t<this.Nt.J.to;t++){const s=this.ie[t-this.Nt.J.from],n=this.ie[t-this.Nt.J.from-1];s.ht===n.ht+1&&(s.Xs-n.Ks!==i+1&&(n.ee>n.re?n.Ks=s.Xs-i-1:s.Xs=n.Ks+i+1))}let n=Math.ceil(this.Nt.Sn*t);for(let t=this.Nt.J.from;t<this.Nt.J.to;t++){const i=this.ie[t-this.Nt.J.from];i.Ks<i.Xs&&(i.Ks=i.Xs);const s=i.Ks-i.Xs+1;n=Math.min(s,n)}if(i>0&&n<4)for(let t=this.Nt.J.from;t<this.Nt.J.to;t++){const i=this.ie[t-this.Nt.J.from];i.Ks-i.Xs+1>n&&(i.ee>i.re?i.Ks-=1:i.Xs+=1)}}}function At(t){return{tt:[],Sn:t,ne:NaN,J:null}}function Lt(t,i,s){return{ht:t,lt:i,it:NaN,st:NaN,I:s}}class Vt extends wt{constructor(t,i){super(t,i,!1),this.ot=new E,this.he=At(0),this.Wt=new Rt}wt(t,i){return this.sn.kt()?(this.rn(),this.ot):null}hn(){const t=this.nn.St().Sn();this.he=At(t);let i=0,s=0;const n=this.sn.F().color;for(const t of this.sn.fs().mn()){const e=t.Dt[3],r=void 0!==t.I?t.I:n,h=Lt(t.bn,e,r);i++,i<this.he.tt.length?this.he.tt[i]=h:this.he.tt.push(h),this.Qs[s++]={ht:t.bn,it:0}}this.Wt.G(this.he),this.ot.U([this.Wt])}an(){}on(){super.on(),this.he.J=null}cn(t,i,s){if(null===this.tn)return;const n=i.Sn(),e=l(i._n()),r=t.Tt(this.sn.F().base,s);i.dn(this.he.tt),t.fn(this.he.tt,s),this.he.ne=r,this.he.J=mt(this.he.tt,e,!1),this.he.Sn=n,this.Wt.G(this.he)}}class Bt extends bt{constructor(t,i){super(t,i),this.Mn=new ct}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.F();this.rn();const n={tt:this.Qs,rt:s.color,Ft:s.lineStyle,Ws:s.lineType,Bt:s.lineWidth,J:this.tn,Fs:this.nn.St().Sn()};return this.Mn.G(n),this.Mn}an(){this.Qs.forEach((t=>{t.I=this.sn.vn().Fn(t.ht).Bn}))}wn(t,i,s){const n=this.pn(t,i);return n.I=s.Fn(t).Bn,n}}const Ft=/[2-9]/g;class zt{constructor(t=50){this.le=new Map,this.ae=0,this.oe=Array.from(new Array(t))}_e(){this.le.clear(),this.oe.fill(void 0)}ii(t,i,s){const n=s||Ft,e=String(i).replace(n,"0");let r=this.le.get(e);if(void 0===r){if(r=t.measureText(e).width,0===r&&0!==i.length)return 0;const s=this.oe[this.ae];void 0!==s&&this.le.delete(s),this.oe[this.ae]=e,this.ae=(this.ae+1)%this.oe.length,this.le.set(e,r)}return r}}class Wt{constructor(t){this.ue=null,this.k=null,this.ce="right",this.de=0,this.fe=t}pe(t,i,s,n){this.ue=t,this.k=i,this.de=s,this.ce=n}q(t,i){null!==this.k&&null!==this.ue&&this.ue.q(t,this.k,this.fe,this.de,this.ce,i)}}class jt{constructor(t,i,s){this.ve=t,this.fe=new zt(50),this.me=i,this.B=s,this.W=-1,this.Wt=new Wt(this.fe)}wt(t,i){const s=this.B.we(this.me);if(null===s)return null;const n=s.be(this.me)?s.ge():this.me.Pt();if(null===n)return null;const e=s.Me(n);if("overlay"===e)return null;const r=this.B.Se();return r.P!==this.W&&(this.W=r.P,this.fe._e()),this.Wt.pe(this.ve.pi(),r,i,e),this.Wt}}class $t{constructor(){this.Nt=null}G(t){this.Nt=t}q(t,i,s,r){if(null===this.Nt)return;if(!1===this.Nt.kt)return;const h=Math.round(this.Nt.st*i);if(h<0||h>Math.ceil(this.Nt.Xt*i))return;const l=Math.ceil(this.Nt.Yt*i);t.lineCap="butt",t.strokeStyle=this.Nt.I,t.lineWidth=Math.floor(this.Nt.Bt*i),n(t,this.Nt.Ft),e(t,h,0,l)}}class Ht{constructor(t){this.ye={Yt:0,Xt:0,st:0,I:"rgba(0, 0, 0, 0)",Bt:1,Ft:0,kt:!1},this.ke=new $t,this.li=!0,this.sn=t,this.nn=t.$t(),this.ke.G(this.ye)}ft(){this.li=!0}wt(t,i){return this.sn.kt()?(this.li&&(this.xe(t,i),this.li=!1),this.ke):null}}class Ut extends Ht{constructor(t){super(t)}xe(t,i){this.ye.kt=!1;const s=this.sn.Pt(),n=s.Ce().Ce;if(2!==n&&3!==n)return;const e=this.sn.F();if(!e.baseLineVisible||!this.sn.kt())return;const r=this.sn.xt();null!==r&&(this.ye.kt=!0,this.ye.st=s.Tt(r.Dt,r.Dt),this.ye.Yt=i,this.ye.Xt=t,this.ye.I=e.baseLineColor,this.ye.Bt=e.baseLineWidth,this.ye.Ft=e.baseLineStyle)}}class qt{constructor(){this.Nt=null}G(t){this.Nt=t}Te(){return this.Nt}q(t,i,s,n){const e=this.Nt;if(null===e)return;t.save();const r=Math.max(1,Math.floor(i)),h=r%2/2,l=Math.round(e.re.x*i)+h,a=e.re.y*i;t.fillStyle=e.Pe,t.beginPath();const o=Math.max(2,1.5*e.De)*i;t.arc(l,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=e.Ee,t.beginPath(),t.arc(l,a,e.et*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=e.Oe,t.beginPath(),t.arc(l,a,e.et*i+r/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Yt=[{Ie:0,Ne:.25,Re:4,Ae:10,Le:.25,Ve:0,Be:.4,Fe:.8},{Ie:.25,Ne:.525,Re:10,Ae:14,Le:0,Ve:0,Be:.8,Fe:0},{Ie:.525,Ne:1,Re:14,Ae:14,Le:0,Ve:0,Be:0,Fe:0}];function Xt(t,i,s,n){return function(t,i){if("transparent"===t)return t;const s=v(t),n=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*n})`}(t,s+(n-s)*i)}function Kt(t,i){const s=t%2600/2600;let n;for(const t of Yt)if(s>=t.Ie&&s<=t.Ne){n=t;break}r(void 0!==n,"Last price animation internal logic error");const e=(s-n.Ie)/(n.Ne-n.Ie);return{Ee:Xt(i,e,n.Le,n.Ve),Oe:Xt(i,e,n.Be,n.Fe),et:(h=e,l=n.Re,a=n.Ae,l+(a-l)*h)};var h,l,a}class Zt{constructor(t){this.Wt=new qt,this.li=!0,this.ze=!0,this.We=performance.now(),this.je=this.We-1,this.$e=t}He(){this.je=this.We-1,this.ft()}Ue(){if(this.ft(),2===this.$e.F().lastPriceAnimation){const t=performance.now(),i=this.je-t;if(i>0)return void(i<650&&(this.je+=2600));this.We=t,this.je=t+2600}}ft(){this.li=!0}qe(){this.ze=!0}kt(){return 0!==this.$e.F().lastPriceAnimation}Ye(){switch(this.$e.F().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.je}}wt(t,i){return this.li?(this.bt(t,i),this.li=!1,this.ze=!1):this.ze&&(this.Xe(),this.ze=!1),this.Wt}bt(t,i){this.Wt.G(null);const s=this.$e.$t().St(),n=s._n(),e=this.$e.xt();if(null===n||null===e)return;const r=this.$e.Ke(!0);if(r.Ze||!n.Ge(r.bn))return;const h={x:s.It(r.bn),y:this.$e.Pt().Tt(r.lt,e.Dt)},l=r.I,a=this.$e.F().lineWidth,o=Kt(this.Je(),l);this.Wt.G({Pe:l,De:a,Ee:o.Ee,Oe:o.Oe,et:o.et,re:h})}Xe(){const t=this.Wt.Te();if(null!==t){const i=Kt(this.Je(),t.Pe);t.Ee=i.Ee,t.Oe=i.Oe,t.et=i.et}}Je(){return this.Ye()?performance.now()-this.We:2599}}function Gt(t,i){return Pt(Math.min(Math.max(t,12),30)*i)}function Jt(t,i){switch(t){case"arrowDown":case"arrowUp":return Gt(i,1);case"circle":return Gt(i,.8);case"square":return Gt(i,.7)}}function Qt(t){return Tt(Gt(t,1))}function ti(t){return Math.max(Gt(t,.1),3)}function ii(t,i,s,n,e){const r=Jt("square",s),h=(r-1)/2,l=t-h,a=i-h;return n>=l&&n<=l+r&&e>=a&&e<=a+r}function si(t,i,s,n,e){const r=(Jt("arrowUp",e)-1)/2,h=(Pt(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-r,n),i.lineTo(s,n-r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n+r),i.lineTo(s-h,n+r),i.lineTo(s-h,n)):(i.moveTo(s-r,n),i.lineTo(s,n+r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n-r),i.lineTo(s-h,n-r),i.lineTo(s-h,n)),i.fill()}function ni(t,i,s,n,e,r){return ii(i,s,n,e,r)}class ei extends O{constructor(){super(...arguments),this.Nt=null,this.fe=new zt,this.W=-1,this.j="",this.Qe=""}G(t){this.Nt=t}pe(t,i){this.W===t&&this.j===i||(this.W=t,this.j=i,this.Qe=P(t,i),this.fe._e())}tr(t,i){if(null===this.Nt||null===this.Nt.J)return null;for(let s=this.Nt.J.from;s<this.Nt.J.to;s++){const n=this.Nt.tt[s];if(hi(n,t,i))return{ir:n.sr,nr:n.nr}}return null}Y(t,i,s){if(null!==this.Nt&&null!==this.Nt.J){t.textBaseline="middle",t.font=this.Qe;for(let i=this.Nt.J.from;i<this.Nt.J.to;i++){const s=this.Nt.tt[i];void 0!==s.ti&&(s.ti.Yt=this.fe.ii(t,s.ti.er),s.ti.Xt=this.W),ri(s,t)}}}}function ri(t,i){i.fillStyle=t.I,void 0!==t.ti&&function(t,i,s,n){t.fillText(i,s,n)}(i,t.ti.er,t.it-t.ti.Yt/2,t.ti.st),function(t,i){if(0===t.un)return;switch(t.rr){case"arrowDown":return void si(!1,i,t.it,t.st,t.un);case"arrowUp":return void si(!0,i,t.it,t.st,t.un);case"circle":return void function(t,i,s,n){const e=(Jt("circle",n)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.it,t.st,t.un);case"square":return void function(t,i,s,n){const e=Jt("square",n),r=(e-1)/2,h=i-r,l=s-r;t.fillRect(h,l,e,e)}(i,t.it,t.st,t.un)}t.rr}(t,i)}function hi(t,i,s){return!(void 0===t.ti||!function(t,i,s,n,e,r){const h=n/2;return e>=t&&e<=t+s&&r>=i-h&&r<=i+h}(t.it,t.ti.st,t.ti.Yt,t.ti.Xt,i,s))||function(t,i,s){if(0===t.un)return!1;switch(t.rr){case"arrowDown":case"arrowUp":return ni(0,t.it,t.st,t.un,i,s);case"circle":return function(t,i,s,n,e){const r=2+Jt("circle",s)/2,h=t-n,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.it,t.st,t.un,i,s);case"square":return ii(t.it,t.st,t.un,i,s)}}(t,i,s)}function li(t,i,s,n,e,r,h,l,a){const o=g(s)?s:s.Vn,_=g(s)?s:s.An,u=g(s)?s:s.Ln,c=g(i.size)?Math.max(i.size,0):1,d=Qt(l.Sn())*c,f=d/2;switch(t.un=d,i.position){case"inBar":return t.st=h.Tt(o,a),void(void 0!==t.ti&&(t.ti.st=t.st+f+r+.6*e));case"aboveBar":return t.st=h.Tt(_,a)-f-n.hr,void 0!==t.ti&&(t.ti.st=t.st-f-.6*e,n.hr+=1.2*e),void(n.hr+=d+r);case"belowBar":return t.st=h.Tt(u,a)+f+n.lr,void 0!==t.ti&&(t.ti.st=t.st+f+r+.6*e,n.lr+=1.2*e),void(n.lr+=d+r)}i.position}class ai{constructor(t,i){this.li=!0,this.ar=!0,this._r=!0,this.ur=null,this.Wt=new ei,this.$e=t,this.yi=i,this.Nt={tt:[],J:null}}ft(t){this.li=!0,this._r=!0,"data"===t&&(this.ar=!0)}wt(t,i,s,n){if(!this.$e.kt())return null;this.li&&this.rn();const e=this.yi.F().layout;return this.Wt.pe(e.fontSize,e.fontFamily),this.Wt.G(this.Nt),this.Wt}cr(){if(this._r){if(this.$e.dr().length>0){const t=this.yi.St().Sn(),i=ti(t),s=1.5*Qt(t)+2*i;this.ur={above:s,below:s}}else this.ur=null;this._r=!1}return this.ur}rn(){const t=this.$e.Pt(),i=this.yi.St(),s=this.$e.dr();this.ar&&(this.Nt.tt=s.map((t=>({ht:t.time,it:0,st:0,un:0,rr:t.shape,I:t.color,sr:t.internalId,nr:t.id,ti:void 0}))),this.ar=!1);const n=this.yi.F().layout;this.Nt.J=null;const e=i._n();if(null===e)return;const r=this.$e.xt();if(null===r)return;if(0===this.Nt.tt.length)return;let h=NaN;const l=ti(i.Sn()),a={hr:l,lr:l};this.Nt.J=mt(this.Nt.tt,e,!0);for(let e=this.Nt.J.from;e<this.Nt.J.to;e++){const o=s[e];o.time!==h&&(a.hr=l,a.lr=l,h=o.time);const _=this.Nt.tt[e];_.it=i.It(o.time),void 0!==o.text&&o.text.length>0&&(_.ti={er:o.text,st:0,Yt:0,Xt:0});const u=this.$e.pr(o.time);null!==u&&li(_,o,u,a,n.fontSize,l,t,i,r.Dt)}this.li=!1}}class oi extends Ht{constructor(t){super(t)}xe(t,i){const s=this.ye;s.kt=!1;const n=this.sn.F();if(!n.priceLineVisible||!this.sn.kt())return;const e=this.sn.Ke(0===n.priceLineSource);e.Ze||(s.kt=!0,s.st=e.si,s.I=this.sn.vr(e.I),s.Yt=i,s.Xt=t,s.Bt=n.priceLineWidth,s.Ft=n.priceLineStyle)}}class _i extends ${constructor(t){super(),this.jt=t}vi(t,i,s){t.kt=!1,i.kt=!1;const n=this.jt;if(!n.kt())return;const e=n.F(),r=e.lastValueVisible,h=""!==n.mr(),l=0===e.seriesLastValueMode,a=n.Ke(!1);if(a.Ze)return;r&&(t.ti=this.wr(a,r,l),t.kt=0!==t.ti.length),(h||l)&&(i.ti=this.br(a,r,h,l),i.kt=i.ti.length>0);const o=n.vr(a.I),_=m(o);s.t=_.t,s.I=_.i,s.si=a.si,i.Et=n.$t().Ot(a.si/n.Pt().Xt()),t.Et=o}br(t,i,s,n){let e="";const r=this.jt.mr();return s&&0!==r.length&&(e+=`${r} `),i&&n&&(e+=this.jt.Pt().gr()?t.Mr:t.Sr),e.trim()}wr(t,i,s){return i?s?this.jt.Pt().gr()?t.Sr:t.Mr:t.ti:""}}class ui{constructor(t,i){this.yr=t,this.kr=i}Cr(t){return null!==t&&(this.yr===t.yr&&this.kr===t.kr)}Tr(){return new ui(this.yr,this.kr)}Pr(){return this.yr}Dr(){return this.kr}Er(){return this.kr-this.yr}bi(){return this.kr===this.yr||Number.isNaN(this.kr)||Number.isNaN(this.yr)}Os(t){return null===t?this:new ui(Math.min(this.Pr(),t.Pr()),Math.max(this.Dr(),t.Dr()))}Or(t){if(!g(t))return;if(0===this.kr-this.yr)return;const i=.5*(this.kr+this.yr);let s=this.kr-i,n=this.yr-i;s*=t,n*=t,this.kr=i+s,this.yr=i+n}Ir(t){g(t)&&(this.kr+=t,this.yr+=t)}Nr(){return{minValue:this.yr,maxValue:this.kr}}static Rr(t){return null===t?null:new ui(t.minValue,t.maxValue)}}class ci{constructor(t,i){this.Ar=t,this.Lr=i||null}Vr(){return this.Ar}Br(){return this.Lr}Nr(){return null===this.Ar?null:{priceRange:this.Ar.Nr(),margins:this.Lr||void 0}}static Rr(t){return null===t?null:new ci(ui.Rr(t.priceRange),t.margins)}}class di extends Ht{constructor(t,i){super(t),this.Fr=i}xe(t,i){const s=this.ye;s.kt=!1;const n=this.Fr.F();if(!this.sn.kt()||!n.lineVisible)return;const e=this.Fr.zr();null!==e&&(s.kt=!0,s.st=e,s.I=n.color,s.Yt=i,s.Xt=t,s.Bt=n.lineWidth,s.Ft=n.lineStyle)}}class fi extends ${constructor(t,i){super(),this.$e=t,this.Fr=i}vi(t,i,s){t.kt=!1,i.kt=!1;const n=this.Fr.F(),e=n.axisLabelVisible,r=""!==n.title,h=this.$e;if(!e||!h.kt())return;const l=this.Fr.zr();if(null===l)return;r&&(i.ti=n.title,i.kt=!0),i.Et=h.$t().Ot(l/h.Pt().Xt()),t.ti=this.Wr(n.price),t.kt=!0;const a=m(n.color);s.t=a.t,s.I=a.i,s.si=l}Wr(t){const i=this.$e.xt();return null===i?"":this.$e.Pt().gi(t,i.Dt)}}class pi{constructor(t,i){this.$e=t,this.$i=i,this.jr=new di(t,this),this.ve=new fi(t,this),this.$r=new jt(this.ve,t,t.$t())}Hr(t){b(this.$i,t),this.ft(),this.$e.$t().Ur()}F(){return this.$i}qr(){return this.jr}Yr(){return this.$r}Xr(){return this.ve}ft(){this.jr.ft(),this.ve.ft()}zr(){const t=this.$e,i=t.Pt();if(t.$t().St().bi()||i.bi())return null;const s=t.xt();return null===s?null:i.Tt(this.$i.price,s.Dt)}}class vi extends X{constructor(t){super(),this.yi=t}$t(){return this.yi}}const mi={Bn:"",te:"",Qn:""};class wi{constructor(t){this.$e=t}Fn(t,i){const s=this.$e.Kr(),n=this.$e.F();switch(s){case"Line":return this.Zr(n,t,i);case"Area":return this.Gr(n);case"Baseline":return this.Jr(n,t,i);case"Bar":return this.Qr(n,t,i);case"Candlestick":return this.th(n,t,i);case"Histogram":return this.ih(n,t,i)}throw new Error("Unknown chart style")}Qr(t,i,s){const n=Object.assign({},mi),e=t.upColor,r=t.downColor,h=e,o=r,_=l(this.sh(i,s)),u=a(_.Dt[0])<=a(_.Dt[3]);return void 0!==_.I?(n.Bn=_.I,n.te=_.I):(n.Bn=u?e:r,n.te=u?h:o),n}th(t,i,s){var n,e,r;const h=Object.assign({},mi),o=t.upColor,_=t.downColor,u=t.borderUpColor,c=t.borderDownColor,d=t.wickUpColor,f=t.wickDownColor,p=l(this.sh(i,s)),v=a(p.Dt[0])<=a(p.Dt[3]);return h.Bn=null!==(n=p.I)&&void 0!==n?n:v?o:_,h.te=null!==(e=p.Et)&&void 0!==e?e:v?u:c,h.Qn=null!==(r=p.Jn)&&void 0!==r?r:v?d:f,h}Gr(t){return Object.assign(Object.assign({},mi),{Bn:t.lineColor})}Jr(t,i,s){const n=l(this.sh(i,s)).Dt[3]>=t.baseValue.price;return Object.assign(Object.assign({},mi),{Bn:n?t.topLineColor:t.bottomLineColor})}Zr(t,i,s){var n;const e=l(this.sh(i,s));return Object.assign(Object.assign({},mi),{Bn:null!==(n=e.I)&&void 0!==n?n:t.color})}ih(t,i,s){const n=Object.assign({},mi),e=l(this.sh(i,s));return n.Bn=void 0!==e.I?e.I:t.color,n}sh(t,i){return void 0!==i?i.Dt:this.$e.fs().nh(t)}}var bi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(bi||(bi={}));const gi=30;class Mi{constructor(){this.eh=[],this.rh=new Map,this.hh=new Map}lh(){return this.un()>0?this.eh[this.eh.length-1]:null}ah(){return this.un()>0?this.oh(0):null}ds(){return this.un()>0?this.oh(this.eh.length-1):null}un(){return this.eh.length}bi(){return 0===this.un()}Ge(t){return null!==this._h(t,0)}nh(t){return this.uh(t)}uh(t,i=0){const s=this._h(t,i);return null===s?null:Object.assign(Object.assign({},this.dh(s)),{bn:this.oh(s)})}mn(){return this.eh}fh(t,i,s){if(this.bi())return null;let n=null;for(const e of s){n=Si(n,this.ph(t,i,e))}return n}G(t){this.hh.clear(),this.rh.clear(),this.eh=t}oh(t){return this.eh[t].bn}dh(t){return this.eh[t]}_h(t,i){const s=this.mh(t);if(null===s&&0!==i)switch(i){case-1:return this.wh(t);case 1:return this.bh(t);default:throw new TypeError("Unknown search mode")}return s}wh(t){let i=this.gh(t);return i>0&&(i-=1),i!==this.eh.length&&this.oh(i)<t?i:null}bh(t){const i=this.Mh(t);return i!==this.eh.length&&t<this.oh(i)?i:null}mh(t){const i=this.gh(t);return i===this.eh.length||t<this.eh[i].bn?null:i}gh(t){return dt(this.eh,t,((t,i)=>t.bn<i))}Mh(t){return ft(this.eh,t,((t,i)=>i.bn>t))}Sh(t,i,s){let n=null;for(let e=t;e<i;e++){const t=this.eh[e].Dt[s];Number.isNaN(t)||(null===n?n={yh:t,kh:t}:(t<n.yh&&(n.yh=t),t>n.kh&&(n.kh=t)))}return n}ph(t,i,s){if(this.bi())return null;let n=null;const e=l(this.ah()),r=l(this.ds()),h=Math.max(t,e),a=Math.min(i,r),o=Math.ceil(h/gi)*gi,_=Math.max(o,Math.floor(a/gi)*gi);{const t=this.gh(h),e=this.Mh(Math.min(a,o,i));n=Si(n,this.Sh(t,e,s))}let u=this.rh.get(s);void 0===u&&(u=new Map,this.rh.set(s,u));for(let t=Math.max(o+1,h);t<_;t+=gi){const i=Math.floor(t/gi);let e=u.get(i);if(void 0===e){const t=this.gh(i*gi),n=this.Mh((i+1)*gi-1);e=this.Sh(t,n,s),u.set(i,e)}n=Si(n,e)}{const t=this.gh(_),i=this.Mh(a);n=Si(n,this.Sh(t,i,s))}return n}}function Si(t,i){if(null===t)return i;if(null===i)return t;return{yh:Math.min(t.yh,i.yh),kh:Math.max(t.kh,i.kh)}}class yi extends vi{constructor(t,i,s){super(t),this.Nt=new Mi,this.jr=new oi(this),this.xh=[],this.Ch=new Ut(this),this.Th=null,this.Ph=null,this.Dh=[],this.Eh=[],this.Oh=null,this.$i=i,this.Ih=s;const n=new _i(this);this.Vi=[n],this.$r=new jt(n,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.Th=new Zt(this)),this.Nh(),this.Rh()}S(){null!==this.Oh&&clearTimeout(this.Oh)}vr(t){return this.$i.priceLineColor||t}Ke(t){const i={Ze:!0},s=this.Pt();if(this.$t().St().bi()||s.bi()||this.Nt.bi())return i;const n=this.$t().St()._n(),e=this.xt();if(null===n||null===e)return i;let r,h;if(t){const t=this.Nt.lh();if(null===t)return i;r=t,h=t.bn}else{const t=this.Nt.uh(n.Ks(),-1);if(null===t)return i;if(r=this.Nt.nh(t.bn),null===r)return i;h=t.bn}const l=r.Dt[3],a=this.vn().Fn(h,{Dt:r}),o=s.Tt(l,e.Dt);return{Ze:!1,lt:l,ti:s.gi(l,e.Dt),Mr:s.Ah(l),Sr:s.Lh(l,e.Dt),I:a.Bn,si:o,bn:h}}vn(){return null!==this.Ph||(this.Ph=new wi(this)),this.Ph}F(){return this.$i}Hr(t){var i;const s=t.priceScaleId;void 0!==s&&s!==this.$i.priceScaleId&&this.$t().Vh(this,s);const n=null!==(i=this.$i.pane)&&void 0!==i?i:0;b(this.$i,t),void 0!==t.priceFormat&&(this.Nh(),this.$t().Bh()),t.pane&&n!==t.pane&&this.$t().Fh(this,n,t.pane),this.$t().zh(this),this.$t().Wh(),this.Zi.ft("options")}G(t,i){this.Nt.G(t),this.jh(),this.Zi.ft("data"),this.Hi.ft("data"),null!==this.Th&&(i&&i.$h?this.Th.Ue():0===t.length&&this.Th.He());const s=this.$t().we(this);this.$t().Hh(s),this.$t().zh(this),this.$t().Wh(),this.$t().Ur()}Uh(t){this.Dh=t,this.jh();const i=this.$t().we(this);this.Hi.ft("data"),this.$t().Hh(i),this.$t().zh(this),this.$t().Wh(),this.$t().Ur()}qh(){return this.Dh}dr(){return this.Eh}Yh(t){const i=new pi(this,t);return this.xh.push(i),this.$t().zh(this),i}Xh(t){const i=this.xh.indexOf(t);-1!==i&&this.xh.splice(i,1),this.$t().zh(this)}Kr(){return this.Ih}xt(){const t=this.Kh();return null===t?null:{Dt:t.Dt[3],Zh:t.ht}}Kh(){const t=this.$t().St()._n();if(null===t)return null;const i=t.Xs();return this.Nt.uh(i,1)}fs(){return this.Nt}pr(t){const i=this.Nt.nh(t);return null===i?null:"Bar"===this.Ih||"Candlestick"===this.Ih?{Rn:i.Dt[0],An:i.Dt[1],Ln:i.Dt[2],Vn:i.Dt[3]}:i.Dt[3]}Gh(t){const i=this.Th;return null!==i&&i.kt()?(null===this.Oh&&i.Ye()&&(this.Oh=setTimeout((()=>{this.Oh=null,this.$t().Jh()}),0)),i.qe(),[i]):[]}hs(){const t=[];this.Qh()||t.push(this.Ch),t.push(this.Zi,this.jr,this.Hi);const i=this.xh.map((t=>t.qr()));return t.push(...i),t}Oi(t){return[this.$r,...this.xh.map((t=>t.Yr()))]}ls(t,i){if(i!==this.Ci&&!this.Qh())return[];const s=[...this.Vi];for(const t of this.xh)s.push(t.Xr());return s}tl(t,i){if(void 0!==this.$i.autoscaleInfoProvider){const s=this.$i.autoscaleInfoProvider((()=>{const s=this.il(t,i);return null===s?null:s.Nr()}));return ci.Rr(s)}return this.il(t,i)}sl(){return this.$i.priceFormat.minMove}nl(){return this.el}_s(){var t;this.Zi.ft(),this.Hi.ft();for(const t of this.Vi)t.ft();for(const t of this.xh)t.ft();this.jr.ft(),this.Ch.ft(),null===(t=this.Th)||void 0===t||t.ft()}Pt(){return l(super.Pt())}yt(t){if(!(("Line"===this.Ih||"Area"===this.Ih||"Baseline"===this.Ih)&&this.$i.crosshairMarkerVisible))return null;const i=this.Nt.nh(t);if(null===i)return null;return{lt:i.Dt[3],et:this.rl(),Et:this.hl(),Ct:this.ll(t)}}mr(){return this.$i.title}kt(){return this.$i.visible}Qh(){return!G(this.Pt().al())}il(t,i){if(!M(t)||!M(i)||this.Nt.bi())return null;const s="Line"===this.Ih||"Area"===this.Ih||"Baseline"===this.Ih||"Histogram"===this.Ih?[3]:[2,1],n=this.Nt.fh(t,i,s);let e=null!==n?new ui(n.yh,n.kh):null;if("Histogram"===this.Kr()){const t=this.$i.base,i=new ui(t,t);e=null!==e?e.Os(i):i}return new ci(e,this.Hi.cr())}rl(){switch(this.Ih){case"Line":case"Area":case"Baseline":return this.$i.crosshairMarkerRadius}return 0}hl(){switch(this.Ih){case"Line":case"Area":case"Baseline":{const t=this.$i.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}ll(t){switch(this.Ih){case"Line":case"Area":case"Baseline":{const t=this.$i.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.vn().Fn(t).Bn}Nh(){switch(this.$i.priceFormat.type){case"custom":this.el={format:this.$i.priceFormat.formatter};break;case"volume":this.el=new nt(this.$i.priceFormat.precision);break;case"percent":this.el=new st(this.$i.priceFormat.precision);break;default:{const t=Math.pow(10,this.$i.priceFormat.precision);this.el=new it(t,this.$i.priceFormat.minMove*t)}}null!==this.Ci&&this.Ci.ol()}jh(){const t=this.$t().St();if(t.bi()||0===this.Nt.un())return void(this.Eh=[]);const i=l(this.Nt.ah());this.Eh=this.Dh.map(((s,n)=>{const e=l(t._l(s.time,!0)),r=e<i?1:-1;return{time:l(this.Nt.uh(e,r)).bn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:n,text:s.text,size:s.size}}))}Rh(){switch(this.Hi=new ai(this,this.$t()),this.Ih){case"Bar":this.Zi=new yt(this,this.$t());break;case"Candlestick":this.Zi=new Nt(this,this.$t());break;case"Line":this.Zi=new Bt(this,this.$t());break;case"Area":this.Zi=new gt(this,this.$t());break;case"Baseline":this.Zi=new Ot(this,this.$t());break;case"Histogram":this.Zi=new Vt(this,this.$t());break;default:throw Error("Unknown chart style assigned: "+this.Ih)}}}class ki{constructor(t){this.$i=t}ul(t,i,s){let n=t;if(0===this.$i.mode)return n;const e=s.qi(),r=e.xt();if(null===r)return n;const h=e.Tt(t,r),l=s.gt().filter((t=>t instanceof yi)).reduce(((t,n)=>{if(s.be(n)||!n.kt())return t;const e=n.Pt(),r=n.fs();if(e.bi()||!r.Ge(i))return t;const h=r.nh(i);if(null===h)return t;const l=a(n.xt());return t.concat([e.Tt(h.Dt[3],l.Dt)])}),[]);if(0===l.length)return n;l.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const o=l[0];return n=e.Yi(o,r),n}}class xi{constructor(){this.Nt=null}G(t){this.Nt=t}q(t,i,s,e){if(null===this.Nt)return;const r=Math.max(1,Math.floor(i));t.lineWidth=r;const h=Math.ceil(this.Nt.Vt*i),a=Math.ceil(this.Nt.Lt*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const s=l(this.Nt);if(s.cl){t.strokeStyle=s.dl,n(t,s.fl),t.beginPath();for(const n of s.pl){const s=Math.round(n.vl*i);t.moveTo(s,-r),t.lineTo(s,h+r)}t.stroke()}if(s.ml){t.strokeStyle=s.wl,n(t,s.bl),t.beginPath();for(const n of s.gl){const s=Math.round(n.vl*i);t.moveTo(-r,s),t.lineTo(a+r,s)}t.stroke()}}))}}class Ci{constructor(t){this.Wt=new xi,this.li=!0,this.Ni=t}ft(){this.li=!0}wt(t,i){if(this.li){const s=this.Ni.$t().F().grid,n={Vt:t,Lt:i,ml:s.horzLines.visible,cl:s.vertLines.visible,wl:s.horzLines.color,dl:s.vertLines.color,bl:s.horzLines.style,fl:s.vertLines.style,gl:this.Ni.qi().Ml(),pl:this.Ni.$t().St().Ml()||[]};this.Wt.G(n),this.li=!1}return this.Wt}}class Ti{constructor(t){this.Zi=new Ci(t)}qr(){return this.Zi}}const Pi={Sl:4,yl:1e-4};function Di(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Ei(t,i){const s=Di(t.Pr(),i),n=Di(t.Dr(),i);return new ui(s,n)}function Oi(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Ii(t,i){const s=Oi(t.Pr(),i),n=Oi(t.Dr(),i);return new ui(s,n)}function Ni(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Ct(s+i.yl)+i.Sl;return t<0?-n:n}function Ri(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Math.pow(10,s-i.Sl)-i.yl;return t<0?-n:n}function Ai(t,i){if(null===t)return null;const s=Ni(t.Pr(),i),n=Ni(t.Dr(),i);return new ui(s,n)}function Li(t,i){if(null===t)return null;const s=Ri(t.Pr(),i),n=Ri(t.Dr(),i);return new ui(s,n)}function Vi(t){if(null===t)return Pi;const i=Math.abs(t.Dr()-t.Pr());if(i>=1||i<1e-15)return Pi;const s=Math.ceil(Math.abs(Math.log10(i))),n=Pi.Sl+s;return{Sl:n,yl:1/Math.pow(10,n)}}class Bi{constructor(t,i){if(this.kl=t,this.xl=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.kl))this.Cl=[2,2.5,2];else{this.Cl=[];for(let t=this.kl;1!==t;){if(t%2==0)this.Cl.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.Cl.push(2,2.5),t/=5}if(this.Cl.length>100)throw new Error("something wrong with base")}}}Tl(t,i,s){const n=0===this.kl?0:1/this.kl;let e=Math.pow(10,Math.max(0,Math.ceil(Ct(t-i)))),r=0,h=this.xl[0];for(;;){const t=xt(e,n,1e-14)&&e>n+1e-14,i=xt(e,s*h,1e-14),l=xt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.xl[++r%this.xl.length]}if(e<=n+1e-14&&(e=n),e=Math.max(1,e),this.Cl.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.Cl[0];xt(e,s*h,1e-14)&&e>n+1e-14;)e/=h,h=this.Cl[++r%this.Cl.length];var l,a,o;return e}}class Fi{constructor(t,i,s,n){this.Pl=[],this.mi=t,this.kl=i,this.Dl=s,this.El=n}Tl(t,i){if(t<i)throw new Error("high < low");const s=this.mi.Xt(),n=(t-i)*this.Ol()/s,e=new Bi(this.kl,[2,2.5,2]),r=new Bi(this.kl,[2,2,2.5]),h=new Bi(this.kl,[2.5,2,2]),l=[];return l.push(e.Tl(t,i,n),r.Tl(t,i,n),h.Tl(t,i,n)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}Il(){const t=this.mi,i=t.xt();if(null===i)return void(this.Pl=[]);const s=t.Xt(),n=this.Dl(s-1,i),e=this.Dl(0,i),r=this.mi.F().entireTextOnly?this.Nl()/2:0,h=r,l=s-1-r,a=Math.max(n,e),o=Math.min(n,e);if(a===o)return void(this.Pl=[]);let _=this.Tl(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let s=a-u;s>o;s-=_){const n=this.El(s,i,!0);null!==d&&Math.abs(n-d)<this.Ol()||(n<h||n>l||(f<this.Pl.length?(this.Pl[f].vl=n,this.Pl[f].Rl=t.Al(s)):this.Pl.push({vl:n,Rl:t.Al(s)}),f++,d=n,t.Ll()&&(_=this.Tl(s*c,o))))}this.Pl.length=f}Ml(){return this.Pl}Nl(){return this.mi.P()}Ol(){return Math.ceil(2.5*this.Nl())}}function zi(t){return t.slice().sort(((t,i)=>l(t.Pi())-l(i.Pi())))}var Wi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(Wi||(Wi={}));const ji=new st,$i=new it(100,1);class Hi{constructor(t,i,s,n){this.Vl=0,this.Bl=null,this.Ar=null,this.Fl=null,this.zl={Wl:!1,jl:null},this.$l=0,this.Hl=0,this.Ul=new w,this.ql=new w,this.Yl=[],this.Xl=null,this.Kl=null,this.Zl=null,this.Gl=null,this.el=$i,this.Jl=Vi(null),this.Ql=t,this.$i=i,this.ta=s,this.ia=n,this.sa=new Fi(this,100,this.na.bind(this),this.ea.bind(this))}al(){return this.Ql}F(){return this.$i}Hr(t){if(b(this.$i,t),this.ol(),void 0!==t.mode&&this.ra({Ce:t.mode}),void 0!==t.scaleMargins){const i=h(t.scaleMargins.top),s=h(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.ha(),this.Kl=null}}la(){return this.$i.autoScale}Ll(){return 1===this.$i.mode}gr(){return 2===this.$i.mode}aa(){return 3===this.$i.mode}Ce(){return{Ms:this.$i.autoScale,oa:this.$i.invertScale,Ce:this.$i.mode}}ra(t){const i=this.Ce();let s=null;void 0!==t.Ms&&(this.$i.autoScale=t.Ms),void 0!==t.Ce&&(this.$i.mode=t.Ce,2!==t.Ce&&3!==t.Ce||(this.$i.autoScale=!0),this.zl.Wl=!1),1===i.Ce&&t.Ce!==i.Ce&&(!function(t,i){if(null===t)return!1;const s=Ri(t.Pr(),i),n=Ri(t.Dr(),i);return isFinite(s)&&isFinite(n)}(this.Ar,this.Jl)?this.$i.autoScale=!0:(s=Li(this.Ar,this.Jl),null!==s&&this._a(s))),1===t.Ce&&t.Ce!==i.Ce&&(s=Ai(this.Ar,this.Jl),null!==s&&this._a(s));const n=i.Ce!==this.$i.mode;n&&(2===i.Ce||this.gr())&&this.ol(),n&&(3===i.Ce||this.aa())&&this.ol(),void 0!==t.oa&&i.oa!==t.oa&&(this.$i.invertScale=t.oa,this.ua()),this.ql.m(i,this.Ce())}ca(){return this.ql}P(){return this.ta.fontSize}Xt(){return this.Vl}da(t){this.Vl!==t&&(this.Vl=t,this.ha(),this.Kl=null)}fa(){if(this.Bl)return this.Bl;const t=this.Xt()-this.pa()-this.va();return this.Bl=t,t}Vr(){return this.ma(),this.Ar}_a(t,i){const s=this.Ar;(i||null===s&&null!==t||null!==s&&!s.Cr(t))&&(this.Kl=null,this.Ar=t)}bi(){return this.ma(),0===this.Vl||!this.Ar||this.Ar.bi()}wa(t){return this.oa()?t:this.Xt()-1-t}Tt(t,i){return this.gr()?t=Di(t,i):this.aa()&&(t=Oi(t,i)),this.ea(t,i)}fn(t,i,s){this.ma();const n=this.va(),e=l(this.Vr()),r=e.Pr(),h=e.Dr(),a=this.fa()-1,o=this.oa(),_=a/(h-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.ba();for(let s=u;s<c;s++){const e=t[s],h=e.lt;if(isNaN(h))continue;let l=h;null!==d&&(l=d(e.lt,i));const a=n+_*(l-r),u=o?a:this.Vl-1-a;e.st=u}}In(t,i,s){this.ma();const n=this.va(),e=l(this.Vr()),r=e.Pr(),h=e.Dr(),a=this.fa()-1,o=this.oa(),_=a/(h-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.ba();for(let s=u;s<c;s++){const e=t[s];let h=e.Rn,l=e.An,a=e.Ln,u=e.Vn;null!==d&&(h=d(e.Rn,i),l=d(e.An,i),a=d(e.Ln,i),u=d(e.Vn,i));let c=n+_*(h-r),f=o?c:this.Vl-1-c;e.En=f,c=n+_*(l-r),f=o?c:this.Vl-1-c,e.Tn=f,c=n+_*(a-r),f=o?c:this.Vl-1-c,e.Pn=f,c=n+_*(u-r),f=o?c:this.Vl-1-c,e.On=f}}Yi(t,i){const s=this.na(t,i);return this.ga(s,i)}ga(t,i){let s=t;return this.gr()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.aa()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}gt(){return this.Yl}Ma(){if(this.Xl)return this.Xl;let t=[];for(let i=0;i<this.Yl.length;i++){const s=this.Yl[i];null===s.Pi()&&s.Di(i+1),t.push(s)}return t=zi(t),this.Xl=t,this.Xl}Sa(t){-1===this.Yl.indexOf(t)&&(this.Yl.push(t),this.ol(),this.ya())}ka(t){const i=this.Yl.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.Yl.splice(i,1),0===this.Yl.length&&(this.ra({Ms:!0}),this._a(null)),this.ol(),this.ya()}xt(){let t=null;for(const i of this.Yl){const s=i.xt();null!==s&&((null===t||s.Zh<t.Zh)&&(t=s))}return null===t?null:t.Dt}oa(){return this.$i.invertScale}Ml(){const t=null===this.xt();if(null!==this.Kl&&(t||this.Kl.xa===t))return this.Kl.Ml;this.sa.Il();const i=this.sa.Ml();return this.Kl={Ml:i,xa:t},this.Ul.m(),i}Ca(){return this.Ul}Ta(t){this.gr()||this.aa()||null===this.Zl&&null===this.Fl&&(this.bi()||(this.Zl=this.Vl-t,this.Fl=l(this.Vr()).Tr()))}Pa(t){if(this.gr()||this.aa())return;if(null===this.Zl)return;this.ra({Ms:!1}),(t=this.Vl-t)<0&&(t=0);let i=(this.Zl+.2*(this.Vl-1))/(t+.2*(this.Vl-1));const s=l(this.Fl).Tr();i=Math.max(i,.1),s.Or(i),this._a(s)}Da(){this.gr()||this.aa()||(this.Zl=null,this.Fl=null)}Ea(t){this.la()||null===this.Gl&&null===this.Fl&&(this.bi()||(this.Gl=t,this.Fl=l(this.Vr()).Tr()))}Oa(t){if(this.la())return;if(null===this.Gl)return;const i=l(this.Vr()).Er()/(this.fa()-1);let s=t-this.Gl;this.oa()&&(s*=-1);const n=s*i,e=l(this.Fl).Tr();e.Ir(n),this._a(e,!0),this.Kl=null}Ia(){this.la()||null!==this.Gl&&(this.Gl=null,this.Fl=null)}nl(){return this.el||this.ol(),this.el}gi(t,i){switch(this.$i.mode){case 2:return this.nl().format(Di(t,i));case 3:return this.nl().format(Oi(t,i));default:return this.Wr(t)}}Al(t){switch(this.$i.mode){case 2:case 3:return this.nl().format(t);default:return this.Wr(t)}}Ah(t){return this.Wr(t,l(this.Na()).nl())}Lh(t,i){return t=Di(t,i),ji.format(t)}Ra(){return this.Yl}Aa(t){this.zl={jl:t,Wl:!1}}_s(){this.Yl.forEach((t=>t._s()))}ol(){this.Kl=null;const t=this.Na();let i=100;null!==t&&(i=Math.round(1/t.sl())),this.el=$i,this.gr()?(this.el=ji,i=100):this.aa()?(this.el=new it(100,1),i=100):null!==t&&(this.el=t.nl()),this.sa=new Fi(this,i,this.na.bind(this),this.ea.bind(this)),this.sa.Il()}ya(){this.Xl=null}Na(){return this.Yl[0]||null}pa(){return this.oa()?this.$i.scaleMargins.bottom*this.Xt()+this.Hl:this.$i.scaleMargins.top*this.Xt()+this.$l}va(){return this.oa()?this.$i.scaleMargins.top*this.Xt()+this.$l:this.$i.scaleMargins.bottom*this.Xt()+this.Hl}ma(){this.zl.Wl||(this.zl.Wl=!0,this.La())}ha(){this.Bl=null}ea(t,i){if(this.ma(),this.bi())return 0;t=this.Ll()&&t?Ni(t,this.Jl):t;const s=l(this.Vr()),n=this.va()+(this.fa()-1)*(t-s.Pr())/s.Er();return this.wa(n)}na(t,i){if(this.ma(),this.bi())return 0;const s=this.wa(t),n=l(this.Vr()),e=n.Pr()+n.Er()*((s-this.va())/(this.fa()-1));return this.Ll()?Ri(e,this.Jl):e}ua(){this.Kl=null,this.sa.Il()}La(){const t=this.zl.jl;if(null===t)return;let i=null;const s=this.Ra();let n=0,e=0;for(const r of s){if(!r.kt())continue;const s=r.xt();if(null===s)continue;const h=r.tl(t.Xs(),t.Ks());let a=h&&h.Vr();if(null!==a){switch(this.$i.mode){case 1:a=Ai(a,this.Jl);break;case 2:a=Ei(a,s.Dt);break;case 3:a=Ii(a,s.Dt)}if(i=null===i?a:i.Os(l(a)),null!==h){const t=h.Br();null!==t&&(n=Math.max(n,t.above),e=Math.max(n,t.below))}}}if(n===this.$l&&e===this.Hl||(this.$l=n,this.Hl=e,this.Kl=null,this.ha()),null!==i){if(i.Pr()===i.Dr()){const t=this.Na(),s=5*(null===t||this.gr()||this.aa()?1:t.sl());this.Ll()&&(i=Li(i,this.Jl)),i=new ui(i.Pr()-s,i.Dr()+s),this.Ll()&&(i=Ai(i,this.Jl))}if(this.Ll()){const t=Li(i,this.Jl),s=Vi(t);if(r=s,h=this.Jl,r.Sl!==h.Sl||r.yl!==h.yl){const n=null!==this.Fl?Li(this.Fl,this.Jl):null;this.Jl=s,i=Ai(t,s),null!==n&&(this.Fl=Ai(n,s))}}this._a(i)}else null===this.Ar&&(this._a(new ui(-.5,.5)),this.Jl=Vi(null));var r,h;this.zl.Wl=!0}ba(){return this.gr()?Di:this.aa()?Oi:this.Ll()?t=>Ni(t,this.Jl):null}Wr(t,i){return void 0===this.ia.priceFormatter?(void 0===i&&(i=this.nl()),i.format(t)):this.ia.priceFormatter(t)}}class Ui{constructor(t,i,s=0){this.Yl=[],this.Va=new Map,this.Vl=0,this.de=0,this.Ba=1e3,this.Xl=null,this.Fa=new w,this.za=t,this.yi=i,this.Wa=new Ti(this);const n=i.F();this.ja=this.$a("left",n.leftPriceScale),this.Ha=0===s?this.$a("right",n.rightPriceScale):this.$a("non-primary",n.nonPrimaryPriceScale),this.ja.ca().l(this.Ua.bind(this,this.ja),this),this.Ha.ca().l(this.Ua.bind(this,this.Ha),this),this.qa(n)}qa(t){if(t.leftPriceScale&&this.ja.Hr(t.leftPriceScale),"right"===this.Ha.al()&&t.rightPriceScale&&this.Ha.Hr(t.rightPriceScale),"non-primary"===this.Ha.al()&&t.nonPrimaryPriceScale&&this.Ha.Hr(t.nonPrimaryPriceScale),t.localization&&(this.ja.ol(),this.Ha.ol()),t.overlayPriceScales){const i=Array.from(this.Va.values());for(const s of i){const i=l(s[0].Pt());i.Hr(t.overlayPriceScales),t.localization&&i.ol()}}}Ya(t){switch(t){case"left":return this.ja;case"right":return this.Ha}return this.Va.has(t)?h(this.Va.get(t))[0].Pt():null}S(){this.$t().Xa().v(this),this.ja.ca().v(this),this.Ha.ca().v(this),this.Yl.forEach((t=>{t.S&&t.S()})),this.Fa.m()}Ka(){return this.Ba}Za(t){this.Ba=t}$t(){return this.yi}Yt(){return this.de}Xt(){return this.Vl}Ga(t){this.de=t,this.Ja()}da(t){this.Vl=t,this.ja.da(t),this.Ha.da(t),this.Yl.forEach((i=>{if(this.be(i)){const s=i.Pt();null!==s&&s.da(t)}})),this.Ja()}gt(){return this.Yl}be(t){const i=t.Pt();return null===i||this.ja!==i&&this.Ha!==i}Sa(t,i,s){const n=void 0!==s?s:this.io().Qa+1;this.so(t,i,n)}ka(t){const i=this.Yl.indexOf(t);r(-1!==i,"removeDataSource: invalid data source"),this.Yl.splice(i,1);const s=l(t.Pt()).al();if(this.Va.has(s)){const i=h(this.Va.get(s)),n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.Va.delete(s))}const n=t.Pt();n&&n.gt().indexOf(t)>=0&&n.ka(t),null!==n&&(n.ya(),this.no(n)),this.Xl=null}Me(t){return t===this.ja?"left":t===this.Ha?"right":"overlay"}eo(){return this.ja}ro(){return this.Ha}ho(t,i){t.Ta(i)}lo(t,i){t.Pa(i),this.Ja()}ao(t){t.Da()}oo(t,i){t.Ea(i)}_o(t,i){t.Oa(i),this.Ja()}uo(t){t.Ia()}Ja(){this.Yl.forEach((t=>{t._s()}))}qi(){let t=null;return this.yi.F().rightPriceScale.visible&&0!==this.Ha.gt().length?t=this.Ha:this.yi.F().leftPriceScale.visible&&0!==this.ja.gt().length?t=this.ja:0!==this.Yl.length&&(t=this.Yl[0].Pt()),null===t&&(t=this.Ha),t}ge(){let t=null;return this.yi.F().rightPriceScale.visible?t=this.Ha:this.yi.F().leftPriceScale.visible&&(t=this.ja),t}no(t){null!==t&&t.la()&&this.co(t)}do(t){const i=this.za._n();t.ra({Ms:!0}),null!==i&&t.Aa(i),this.Ja()}fo(){this.co(this.ja),this.co(this.Ha)}po(){this.no(this.ja),this.no(this.Ha),this.Yl.forEach((t=>{this.be(t)&&this.no(t.Pt())})),this.Ja(),this.yi.Ur()}Ma(){return null===this.Xl&&(this.Xl=zi(this.Yl)),this.Xl}vo(){return this.Fa}mo(){return this.Wa}co(t){const i=t.Ra();if(i&&i.length>0&&!this.za.bi()){const i=this.za._n();null!==i&&t.Aa(i)}t._s()}io(){const t=this.Ma();if(0===t.length)return{wo:0,Qa:0};let i=0,s=0;for(let n=0;n<t.length;n++){const e=t[n].Pi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{wo:i,Qa:s}}so(t,i,s){let n=this.Ya(i);if(null===n&&(n=this.$a(i,this.yi.F().overlayPriceScales)),this.Yl.push(t),!G(i)){const s=this.Va.get(i)||[];s.push(t),this.Va.set(i,s)}n.Sa(t),t.Ei(n),t.Di(s),this.no(n),this.Xl=null}Ua(t,i,s){i.Ce!==s.Ce&&this.co(t)}$a(t,i){const s=Object.assign({visible:!0,autoScale:!0},k(i)),n=new Hi(t,s,this.yi.F().layout,this.yi.F().localization);return n.da(this.Xt()),n}}const qi=t=>t.getUTCFullYear();function Yi(t,i,s){return i.replace(/yyyy/g,(t=>tt(qi(t),4))(t)).replace(/yy/g,(t=>tt(qi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>tt((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>tt((t=>t.getUTCDate())(t),2))(t))}class Xi{constructor(t="yyyy-MM-dd",i="default"){this.bo=t,this.Mo=i}So(t){return Yi(t,this.bo,this.Mo)}}class Ki{constructor(t){this.yo=t||"%h:%m:%s"}So(t){return this.yo.replace("%h",tt(t.getUTCHours(),2)).replace("%m",tt(t.getUTCMinutes(),2)).replace("%s",tt(t.getUTCSeconds(),2))}}const Zi={ko:"yyyy-MM-dd",xo:"%h:%m:%s",Co:" ",To:"default"};class Gi{constructor(t={}){const i=Object.assign(Object.assign({},Zi),t);this.Po=new Xi(i.ko,i.To),this.Do=new Ki(i.xo),this.Eo=i.Co}So(t){return`${this.Po.So(t)}${this.Eo}${this.Do.So(t)}`}}class Ji{constructor(t,i=50){this.Oo=0,this.Io=1,this.No=1,this.le=new Map,this.Ro=new Map,this.Ao=t,this.Lo=i}So(t){const i=t.ht,s=void 0===i.Vo?new Date(1e3*i.Bo).getTime():new Date(Date.UTC(i.Vo.year,i.Vo.month-1,i.Vo.day)).getTime(),n=this.le.get(s);if(void 0!==n)return n.Fo;if(this.Oo===this.Lo){const t=this.Ro.get(this.No);this.Ro.delete(this.No),this.le.delete(h(t)),this.No++,this.Oo--}const e=this.Ao(t);return this.le.set(s,{Fo:e,zo:this.Io}),this.Ro.set(this.Io,s),this.Oo++,this.Io++,e}}class Qi{constructor(t,i){r(t<=i,"right should be >= left"),this.Wo=t,this.jo=i}Xs(){return this.Wo}Ks(){return this.jo}$o(){return this.jo-this.Wo+1}Ge(t){return this.Wo<=t&&t<=this.jo}Cr(t){return this.Wo===t.Xs()&&this.jo===t.Ks()}}function ts(t,i){return null===t||null===i?t===i:t.Cr(i)}class is{constructor(){this.Ho=new Map,this.le=null}Uo(t,i){this.qo(i),this.le=null;for(let s=i;s<t.length;++s){const i=t[s];let n=this.Ho.get(i.Yo);void 0===n&&(n=[],this.Ho.set(i.Yo,n)),n.push({bn:s,ht:i.ht,Xo:i.Yo,Ko:i.Ko})}}Zo(t,i){const s=Math.ceil(i/t);return null!==this.le&&this.le.Go===s||(this.le={Ml:this.Jo(s),Go:s}),this.le.Ml}qo(t){if(0===t)return void this.Ho.clear();const i=[];this.Ho.forEach(((s,n)=>{t<=s[0].bn?i.push(n):s.splice(dt(s,t,(i=>i.bn<t)),1/0)}));for(const t of i)this.Ho.delete(t)}Jo(t){let i=[];for(const s of Array.from(this.Ho.keys()).sort(((t,i)=>i-t))){if(!this.Ho.get(s))continue;const n=i;i=[];const e=n.length;let r=0;const l=h(this.Ho.get(s)),a=l.length;let o=1/0,_=-1/0;for(let s=0;s<a;s++){const h=l[s],a=h.bn;for(;r<e;){const t=n[r],s=t.bn;if(!(s<a)){o=s;break}r++,i.push(t),_=s,o=1/0}o-a>=t&&a-_>=t&&(i.push(h),_=a)}for(;r<e;r++)i.push(n[r])}return i}}class ss{constructor(t){this.Qo=t}t_(){return null===this.Qo?null:new Qi(Math.floor(this.Qo.Xs()),Math.ceil(this.Qo.Ks()))}i_(){return this.Qo}static s_(){return new ss(null)}}var ns,es,rs,hs,ls;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(ns||(ns={}));class as{constructor(t,i,s){this.de=0,this.n_=null,this.e_=[],this.Gl=null,this.Zl=null,this.r_=new is,this.h_=new Map,this.l_=ss.s_(),this.a_=!0,this.o_=new w,this.__=new w,this.u_=new w,this.c_=null,this.d_=null,this.f_=[],this.$i=i,this.ia=s,this.p_=i.rightOffset,this.v_=i.barSpacing,this.yi=t,this.m_()}F(){return this.$i}w_(t){b(this.ia,t),this.b_(),this.m_()}Hr(t,i){var s;b(this.$i,t),this.$i.fixLeftEdge&&this.g_(),this.$i.fixRightEdge&&this.M_(),void 0!==t.barSpacing&&this.yi.Ps(t.barSpacing),void 0!==t.rightOffset&&this.yi.Ds(t.rightOffset),void 0!==t.minBarSpacing&&this.yi.Ps(null!==(s=t.barSpacing)&&void 0!==s?s:this.v_),this.b_(),this.m_(),this.u_.m()}Xi(t){var i,s;return null!==(s=null===(i=this.e_[t])||void 0===i?void 0:i.ht)&&void 0!==s?s:null}ki(t){var i;return null!==(i=this.e_[t])&&void 0!==i?i:null}_l(t,i){if(this.e_.length<1)return null;if(t.Bo>this.e_[this.e_.length-1].ht.Bo)return i?this.e_.length-1:null;const s=dt(this.e_,t.Bo,((t,i)=>t.ht.Bo<i));return t.Bo<this.e_[s].ht.Bo?i?s:null:s}bi(){return 0===this.de||0===this.e_.length||null===this.n_}_n(){return this.S_(),this.l_.t_()}y_(){return this.S_(),this.l_.i_()}k_(){const t=this._n();if(null===t)return null;const i={from:t.Xs(),to:t.Ks()};return this.x_(i)}x_(t){const i=Math.round(t.from),s=Math.round(t.to),n=l(this.C_()),e=l(this.T_());return{from:l(this.Xi(Math.max(n,i))),to:l(this.Xi(Math.min(e,s)))}}P_(t){return{from:l(this._l(t.from,!0)),to:l(this._l(t.to,!0))}}Yt(){return this.de}Ga(t){if(!isFinite(t)||t<=0)return;if(this.de===t)return;const i=this.y_(),s=this.de;if(this.de=t,this.a_=!0,this.$i.lockVisibleTimeRangeOnResize&&0!==s){const i=this.v_*t/s;this.v_=i}if(this.$i.fixLeftEdge&&null!==i&&i.Xs()<=0){const i=s-t;this.p_-=Math.round(i/this.v_)+1,this.a_=!0}this.D_(),this.E_()}It(t){if(this.bi()||!M(t))return 0;const i=this.O_()+this.p_-t;return this.de-(i+.5)*this.v_-1}dn(t,i){const s=this.O_(),n=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=n;i<e;i++){const n=t[i].ht,e=s+this.p_-n,r=this.de-(e+.5)*this.v_-1;t[i].it=r}}I_(t){return Math.ceil(this.N_(t))}Ds(t){this.a_=!0,this.p_=t,this.E_(),this.yi.R_(),this.yi.Ur()}Sn(){return this.v_}Ps(t){this.A_(t),this.E_(),this.yi.R_(),this.yi.Ur()}L_(){return this.p_}Ml(){if(this.bi())return null;if(null!==this.d_)return this.d_;const t=this.v_,i=5*(this.yi.F().layout.fontSize+4),s=Math.round(i/t),n=l(this._n()),e=Math.max(n.Xs(),n.Xs()-s),r=Math.max(n.Ks(),n.Ks()-s),h=this.r_.Zo(t,i),a=this.C_()+s,o=this.T_()-s,_=this.V_(),u=this.$i.fixLeftEdge||_,c=this.$i.fixRightEdge||_;let d=0;for(const t of h){if(!(e<=t.bn&&t.bn<=r))continue;let s;d<this.f_.length?(s=this.f_[d],s.vl=this.It(t.bn),s.Rl=this.B_(t),s.Xo=t.Xo):(s={F_:!1,vl:this.It(t.bn),Rl:this.B_(t),Xo:t.Xo},this.f_.push(s)),this.v_>i/2&&!_?s.F_=!1:s.F_=u&&t.bn<=a||c&&t.bn>=o,d++}return this.f_.length=d,this.d_=this.f_,this.f_}z_(){this.a_=!0,this.Ps(this.$i.barSpacing),this.Ds(this.$i.rightOffset)}W_(t){this.a_=!0,this.n_=t,this.E_(),this.g_()}j_(t,i){const s=this.N_(t),n=this.Sn(),e=n+i*(n/10);this.Ps(e),this.$i.rightBarStaysOnScroll||this.Ds(this.L_()+(s-this.N_(t)))}Ta(t){this.Gl&&this.Ia(),null===this.Zl&&null===this.c_&&(this.bi()||(this.Zl=t,this.H_()))}Pa(t){if(null===this.c_)return;const i=kt(this.de-t,0,this.de),s=kt(this.de-l(this.Zl),0,this.de);0!==i&&0!==s&&this.Ps(this.c_.Sn*i/s)}Da(){null!==this.Zl&&(this.Zl=null,this.U_())}Ea(t){null===this.Gl&&null===this.c_&&(this.bi()||(this.Gl=t,this.H_()))}Oa(t){if(null===this.Gl)return;const i=(this.Gl-t)/this.Sn();this.p_=l(this.c_).L_+i,this.a_=!0,this.E_()}Ia(){null!==this.Gl&&(this.Gl=null,this.U_())}q_(){this.Y_(this.$i.rightOffset)}Y_(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.p_,n=performance.now(),e=()=>{const r=(performance.now()-n)/i,h=r>=1,l=h?t:s+(t-s)*r;this.Ds(l),h||setTimeout(e,20)};e()}ft(t,i){this.a_=!0,this.e_=t,this.r_.Uo(t,i),this.E_()}X_(){return this.o_}K_(){return this.__}Z_(){return this.u_}O_(){return this.n_||0}G_(t){const i=t.$o();this.A_(this.de/i),this.p_=t.Ks()-this.O_(),this.E_(),this.a_=!0,this.yi.R_(),this.yi.Ur()}J_(){const t=this.C_(),i=this.T_();null!==t&&null!==i&&this.G_(new Qi(t,i+this.$i.rightOffset))}Q_(t){const i=new Qi(t.from,t.to);this.G_(i)}xi(t){return void 0!==this.ia.timeFormatter?this.ia.timeFormatter(t.Ko):this.tu.So(new Date(1e3*t.ht.Bo))}V_(){const{handleScroll:t,handleScale:i}=this.yi.F();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}C_(){return 0===this.e_.length?null:0}T_(){return 0===this.e_.length?null:this.e_.length-1}iu(t){return(this.de-1-t)/this.v_}N_(t){const i=this.iu(t),s=this.O_()+this.p_-i;return Math.round(1e6*s)/1e6}A_(t){const i=this.v_;this.v_=t,this.D_(),i!==this.v_&&(this.a_=!0,this.su())}S_(){if(!this.a_)return;if(this.a_=!1,this.bi())return void this.nu(ss.s_());const t=this.O_(),i=this.de/this.v_,s=this.p_+t,n=new Qi(s-i+1,s);this.nu(new ss(n))}D_(){const t=this.eu();if(this.v_<t&&(this.v_=t,this.a_=!0),0!==this.de){const t=.5*this.de;this.v_>t&&(this.v_=t,this.a_=!0)}}eu(){return this.$i.fixLeftEdge&&this.$i.fixRightEdge&&0!==this.e_.length?this.de/this.e_.length:this.$i.minBarSpacing}E_(){const t=this.ru();this.p_>t&&(this.p_=t,this.a_=!0);const i=this.hu();null!==i&&this.p_<i&&(this.p_=i,this.a_=!0)}hu(){const t=this.C_(),i=this.n_;if(null===t||null===i)return null;return t-i-1+(this.$i.fixLeftEdge?this.de/this.v_:Math.min(2,this.e_.length))}ru(){return this.$i.fixRightEdge?0:this.de/this.v_-Math.min(2,this.e_.length)}H_(){this.c_={Sn:this.Sn(),L_:this.L_()}}U_(){this.c_=null}B_(t){let i=this.h_.get(t.Xo);return void 0===i&&(i=new Ji((t=>this.lu(t))),this.h_.set(t.Xo,i)),i.So(t)}lu(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.Xo,this.$i.timeVisible,this.$i.secondsVisible);return void 0!==this.$i.tickMarkFormatter?this.$i.tickMarkFormatter(t.Ko,i,this.ia.locale):function(t,i,s){const n={};switch(i){case 0:n.year="numeric";break;case 1:n.month="short";break;case 2:n.day="numeric";break;case 3:n.hour12=!1,n.hour="2-digit",n.minute="2-digit";break;case 4:n.hour12=!1,n.hour="2-digit",n.minute="2-digit",n.second="2-digit"}const e=void 0===t.Vo?new Date(1e3*t.Bo):new Date(Date.UTC(t.Vo.year,t.Vo.month-1,t.Vo.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,n)}(t.ht,i,this.ia.locale)}nu(t){const i=this.l_;this.l_=t,ts(i.t_(),this.l_.t_())||this.o_.m(),ts(i.i_(),this.l_.i_())||this.__.m(),this.su()}su(){this.d_=null}b_(){this.su(),this.h_.clear()}m_(){const t=this.ia.dateFormat;this.$i.timeVisible?this.tu=new Gi({ko:t,xo:this.$i.secondsVisible?"%h:%m:%s":"%h:%m",Co:"   ",To:this.ia.locale}):this.tu=new Xi(t,this.ia.locale)}g_(){if(!this.$i.fixLeftEdge)return;const t=this.C_();if(null===t)return;const i=this._n();if(null===i)return;const s=i.Xs()-t;if(s<0){const t=this.p_-s-1;this.Ds(t)}this.D_()}M_(){this.E_(),this.D_()}}class os extends O{constructor(t){super(),this.au=new Map,this.Nt=t}Y(t){}K(t){if(!this.Nt.kt)return;t.save();let i=0;for(const s of this.Nt.ou){if(0===s.ti.length)continue;t.font=s.D;const n=this._u(t,s.ti);n>this.Nt.Yt?s.j_=this.Nt.Yt/n:s.j_=1,i+=s.uu*s.j_}let s=0;switch(this.Nt.cu){case"top":s=0;break;case"center":s=Math.max((this.Nt.Xt-i)/2,0);break;case"bottom":s=Math.max(this.Nt.Xt-i,0)}t.fillStyle=this.Nt.I;for(const i of this.Nt.ou){t.save();let n=0;switch(this.Nt.du){case"left":t.textAlign="left",n=i.uu/2;break;case"center":t.textAlign="center",n=this.Nt.Yt/2;break;case"right":t.textAlign="right",n=this.Nt.Yt-1-i.uu/2}t.translate(n,s),t.textBaseline="top",t.font=i.D,t.scale(i.j_,i.j_),t.fillText(i.ti,0,i.fu),t.restore(),s+=i.uu*i.j_}t.restore()}_u(t,i){const s=this.pu(t.font);let n=s.get(i);return void 0===n&&(n=t.measureText(i).width,s.set(i,n)),n}pu(t){let i=this.au.get(t);return void 0===i&&(i=new Map,this.au.set(t,i)),i}}class _s{constructor(t){this.li=!0,this.zt={kt:!1,I:"",Xt:0,Yt:0,ou:[],cu:"center",du:"center"},this.Wt=new os(this.zt),this.jt=t}ft(){this.li=!0}wt(t,i){return this.li&&(this.bt(t,i),this.li=!1),this.Wt}bt(t,i){const s=this.jt.F(),n=this.zt;n.kt=s.visible,n.kt&&(n.I=s.color,n.Yt=i,n.Xt=t,n.du=s.horzAlign,n.cu=s.vertAlign,n.ou=[{ti:s.text,D:P(s.fontSize,s.fontFamily,s.fontStyle),uu:1.2*s.fontSize,fu:0,j_:0}])}}class us extends X{constructor(t,i){super(),this.$i=i,this.Zi=new _s(this)}ls(){return[]}hs(){return[this.Zi]}F(){return this.$i}_s(){this.Zi.ft()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(es||(es={}));class cs{constructor(t,i){this.vu=[],this.mu=new Map,this.wu=[],this.de=0,this.bu=null,this.gu=null,this.Mu=new w,this.Su=new w,this.yu=!1,this.ku=null,this.xu=t,this.$i=i,this.Cu=new D(this),this.za=new as(this,i.timeScale,this.$i.localization),this.dt=new Z(this,i.crosshair),this.Tu=new ki(i.crosshair),this.Pu=new us(this,i.watermark),this.Du(),this.vu[0].Za(2e3),this.Eu=this.Ou(0),this.Iu=this.Ou(1)}Bh(){this.Nu(new J(3))}Ur(){this.Nu(new J(2))}Jh(){this.Nu(new J(1))}zh(t){const i=this.Ru(t);this.Nu(i)}Au(){return this.gu}Lu(t){const i=this.gu;this.gu=t,null!==i&&this.zh(i.Vu),null!==t&&this.zh(t.Vu)}F(){return this.$i}Hr(t){b(this.$i,t),this.vu.forEach((i=>i.qa(t))),void 0!==t.timeScale&&this.za.Hr(t.timeScale),void 0!==t.localization&&this.za.w_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Mu.m(),this.Eu=this.Ou(0),this.Iu=this.Ou(1),this.Bh()}Bu(t,i){if("left"===t)return void this.Hr({leftPriceScale:i});if("right"===t)return void this.Hr({rightPriceScale:i});const s=this.Fu(t);null!==s&&(s.Pt.Hr(i),this.Mu.m())}Fu(t){for(const i of this.vu){const s=i.Ya(t);if(null!==s)return{Ht:i,Pt:s}}return null}St(){return this.za}zu(){return this.vu}Wu(){return this.Pu}ju(){return this.dt}$u(){return this.Su}Hu(t,i){t.da(i),this.R_()}Ga(t){this.de=t,this.za.Ga(this.de),this.vu.forEach((i=>i.Ga(t))),this.R_()}Du(t){if(void 0!==t)if(t>this.vu.length)for(let i=this.vu.length;i<t;i++)this.Du(i);else if(t<this.vu.length)return this.vu[t];const i=void 0===t?this.vu.length-1+1:t,s=new Ui(this.za,this,i);void 0!==t?this.vu.splice(t,0,s):this.vu.push(s),this.Uu();const n=new J(3);return n.bs(i,{gs:0,Ms:!0}),this.Nu(n),s}qu(t){if(0===t)return;if(this.vu[t].Ma().forEach((t=>{t instanceof yi&&this.Yu(t)})),this.yu=!0,t!==this.vu.length-1)for(let i=t+1;i<this.vu.length;i++){this.vu[i].Ma().forEach((t=>{t instanceof yi&&t.Hr({pane:i-1})}))}this.vu.splice(t,1),this.yu=!1,this.Uu();const i=new J(3);this.Nu(i)}Xu(t,i){const s=this.vu[t],n=this.vu[i];this.yu=!0,s.Ma().forEach((t=>{t instanceof yi&&t.Hr({pane:i})})),n.Ma().forEach((i=>{i instanceof yi&&i.Hr({pane:t})})),this.vu[t]=n,this.vu[i]=s,this.yu=!1,this.Uu(),this.Nu(new J(3))}ho(t,i,s){t.ho(i,s)}lo(t,i,s){t.lo(i,s),this.Wh(),this.Nu(this.Ku(t,2))}ao(t,i){t.ao(i),this.Nu(this.Ku(t,2))}oo(t,i,s){i.la()||t.oo(i,s)}_o(t,i,s){i.la()||(t._o(i,s),this.Wh(),this.Nu(this.Ku(t,2)))}uo(t,i){i.la()||(t.uo(i),this.Nu(this.Ku(t,2)))}do(t,i){t.do(i),this.Nu(this.Ku(t,2))}Zu(t){this.za.Ta(t)}Gu(t,i){const s=this.St();if(s.bi()||0===i)return;const n=s.Yt();t=Math.max(1,Math.min(t,n)),s.j_(t,i),this.R_()}Ju(t){this.Qu(0),this.tc(t),this.ic()}sc(t){this.za.Pa(t),this.R_()}nc(){this.za.Da(),this.Ur()}Qu(t){this.bu=t,this.za.Ea(t)}tc(t){let i=!1;return null!==this.bu&&Math.abs(t-this.bu)>20&&(this.bu=null,i=!0),this.za.Oa(t),this.R_(),i}ic(){this.za.Ia(),this.Ur(),this.bu=null}vt(){return this.wu}ec(t,i,s){this.dt.Gi(t,i);let n=NaN,e=this.za.I_(t);const r=this.za._n();null!==r&&(e=Math.min(Math.max(r.Xs(),e),r.Ks()));const h=s.qi(),l=h.xt();null!==l&&(n=h.Yi(i,l)),n=this.Tu.ul(n,e,s),this.dt.ss(e,n,s),this.Jh();const a=this.rc(s);this.Su.m(this.dt.Mt(),{x:t,y:i,hc:a})}lc(){this.ju().es(),this.Jh(),this.Su.m(null,null)}Wh(){const t=this.dt.Ht();if(null!==t){const i=this.dt.Qi(),s=this.dt.ts();this.ec(i,s,t)}this.dt._s()}ac(t,i,s){const n=this.za.Xi(0);void 0!==i&&void 0!==s&&this.za.ft(i,s);const e=this.za.Xi(0),r=this.za.O_(),h=this.za._n();if(null!==h&&null!==n&&null!==e){const i=h.Ge(r),s=n.Bo>e.Bo,l=null!==t&&t>r&&!s,a=i&&this.za.F().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-r;this.za.Ds(this.za.L_()-i)}}this.za.W_(t)}Hh(t){null!==t&&t.po()}we(t){const i=this.vu.find((i=>i.Ma().includes(t)));return void 0===i?null:i}R_(){this.Pu._s(),this.vu.forEach((t=>t.po())),this.Wh()}S(){this.vu.forEach((t=>t.S())),this.vu.length=0,this.$i.localization.priceFormatter=void 0,this.$i.localization.timeFormatter=void 0}oc(){return this.Cu}Se(){return this.Cu.F()}Xa(){return this.Mu}_c(t,i){const s=i.pane||0;this.vu.length-1<=s&&this.Du(s);const n=this.vu[s],e=this.uc(i,t,n);return this.wu.push(e),1===this.wu.length?this.Bh():this.Ur(),e}Yu(t){const i=this.we(t),s=this.wu.indexOf(t);r(-1!==s,"Series not found"),this.wu.splice(s,1),l(i).ka(t),t.S&&t.S()}Vh(t,i){const s=l(this.we(t));s.ka(t);const n=this.Fu(i);if(null===n){const n=t.Pi();s.Sa(t,i,n)}else{const e=n.Ht===s?t.Pi():void 0;n.Ht.Sa(t,i,e)}}J_(){const t=new J(2);t.ks(),this.Nu(t)}cc(t){const i=new J(2);i.Cs(t),this.Nu(i)}Ts(){const t=new J(2);t.Ts(),this.Nu(t)}Ps(t){const i=new J(2);i.Ps(t),this.Nu(i)}Ds(t){const i=new J(2);i.Ds(t),this.Nu(i)}dc(){return this.$i.rightPriceScale.visible?"right":"left"}Fh(t,i,s){if(s===i||this.yu)return;t.F().pane!==s&&t.Hr({pane:s});const n=this.we(t);null==n||n.ka(t);const e=this.Du(s);this.fc(t,e)}vc(){return this.Iu}mc(){return this.Eu}Ot(t){const i=this.Iu,s=this.Eu;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.ku||this.ku.Hs!==s||this.ku.Us!==i)this.ku={Hs:s,Us:i,wc:new Map};else{const i=this.ku.wc.get(t);if(void 0!==i)return i}const n=function(t,i,s){const[n,e,r,h]=v(t),[l,a,o,c]=v(i),d=[_(n+s*(l-n)),_(e+s*(a-e)),_(r+s*(o-r)),u(h+s*(c-h))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(s,i,t/100);return this.ku.wc.set(t,n),n}rc(t){var i;return null!==(i=this.mu.get(t))&&void 0!==i?i:0}Ku(t,i){const s=new J(i);if(null!==t){const n=this.vu.indexOf(t);s.bs(n,{gs:i})}return s}Ru(t,i){return void 0===i&&(i=2),this.Ku(this.we(t),i)}Nu(t){this.xu&&this.xu(t),this.vu.forEach((t=>t.mo().qr().ft()))}uc(t,i,s){const n=new yi(this,t,i);return this.fc(n,s),n}fc(t,i){const s=t.F().priceScaleId,n=void 0!==s?s:this.dc();i.Sa(t,n),G(n)||t.Hr(t.F())}Ou(t){const i=this.$i.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}Uu(){this.mu.clear();for(let t=0;t<this.vu.length;t++)this.mu.set(this.vu[t],t)}}function ds(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function fs(t){return!g(t)&&!S(t)}function ps(t){return g(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(rs||(rs={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(hs||(hs={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(ls||(ls={}));class vs{constructor(t,i){this.Lt=t,this.Vt=i}Cr(t){return this.Lt===t.Lt&&this.Vt===t.Vt}}function ms(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function ws(t){const i=l(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function bs(t,i){const s=t.createElement("canvas"),n=ms(s);return s.style.width=`${i.Lt}px`,s.style.height=`${i.Vt}px`,s.width=i.Lt*n,s.height=i.Vt*n,s}function gs(i,s){const n=l(i.ownerDocument).createElement("canvas");i.appendChild(n);const e=t(n,{allowDownsampling:!1});return e.resizeCanvas({width:s.Lt,height:s.Vt}),e}const Ms="undefined"!=typeof window;function Ss(){return!!Ms&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function ys(){return!!Ms&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function ks(t){Ms&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class xs{constructor(t,i,s){this.bc=0,this.gc=null,this.Mc={it:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.Sc=0,this.yc=null,this.kc={it:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.xc=null,this.Cc=!1,this.Tc=null,this.Pc=null,this.Dc=!1,this.Ec=!1,this.Oc=!1,this.Ic=null,this.Nc=null,this.Rc=null,this.Ac=null,this.Lc=null,this.Vc=null,this.Bc=null,this.Fc=0,this.zc=!1,this.Wc=!1,this.jc=!1,this.$c=0,this.Hc=null,this.Uc=!ys(),this.qc=t=>{this.Yc(t)},this.Xc=t=>{if(this.Kc(t)){const i=this.Zc(t);if(++this.Sc,this.yc&&this.Sc>1){const{Gc:s}=this.Jc(Ps(t),this.kc);s<30&&!this.Oc&&this.Qc(i,this.sd.td),this.nd()}}else{const i=this.Zc(t);if(++this.bc,this.gc&&this.bc>1){const{Gc:s}=this.Jc(Ps(t),this.Mc);s<5&&!this.Ec&&this.ed(i,this.sd.rd),this.hd()}}},this.ld=t,this.sd=i,this.$i=s,this.ad()}S(){null!==this.Ic&&(this.Ic(),this.Ic=null),null!==this.Nc&&(this.Nc(),this.Nc=null),null!==this.Ac&&(this.Ac(),this.Ac=null),null!==this.Lc&&(this.Lc(),this.Lc=null),null!==this.Vc&&(this.Vc(),this.Vc=null),null!==this.Rc&&(this.Rc(),this.Rc=null),this.od(),this.hd()}_d(t){this.Ac&&this.Ac();const i=this.ud.bind(this);if(this.Ac=()=>{this.ld.removeEventListener("mousemove",i)},this.ld.addEventListener("mousemove",i),this.Kc(t))return;const s=this.Zc(t);this.ed(s,this.sd.dd),this.Uc=!0}hd(){null!==this.gc&&clearTimeout(this.gc),this.bc=0,this.gc=null,this.Mc={it:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}nd(){null!==this.yc&&clearTimeout(this.yc),this.Sc=0,this.yc=null,this.kc={it:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}ud(t){if(this.jc||null!==this.Pc)return;if(this.Kc(t))return;const i=this.Zc(t);this.ed(i,this.sd.fd),this.Uc=!0}pd(t){const i=Es(t.changedTouches,l(this.Hc));if(null===i)return;if(this.$c=Ds(t),null!==this.Bc)return;if(this.Wc)return;this.zc=!0;const s=this.Jc(Ps(i),l(this.Pc)),{vd:n,md:e,Gc:r}=s;if(this.Dc||!(r<5)){if(!this.Dc){const t=.5*n,i=e>=t&&!this.$i.wd(),s=t>e&&!this.$i.bd();i||s||(this.Wc=!0),this.Dc=!0,this.Oc=!0,this.od(),this.nd()}if(!this.Wc){const s=this.Zc(t,i);this.Qc(s,this.sd.gd),Ts(t)}}}Md(t){if(0!==t.button)return;const i=this.Jc(Ps(t),l(this.Tc)),{Gc:s}=i;if(s>=5&&(this.Ec=!0,this.hd()),this.Ec){const i=this.Zc(t);this.ed(i,this.sd.Sd)}}Jc(t,i){const s=Math.abs(i.it-t.it),n=Math.abs(i.st-t.st);return{vd:s,md:n,Gc:s+n}}yd(t){let i=Es(t.changedTouches,l(this.Hc));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Hc=null,this.$c=Ds(t),this.od(),this.Pc=null,this.Vc&&(this.Vc(),this.Vc=null);const s=this.Zc(t,i);if(this.Qc(s,this.sd.kd),++this.Sc,this.yc&&this.Sc>1){const{Gc:t}=this.Jc(Ps(i),this.kc);t<30&&!this.Oc&&this.Qc(s,this.sd.td),this.nd()}else this.Oc||(this.Qc(s,this.sd.xd),this.sd.xd&&Ts(t));0===this.Sc&&Ts(t),0===t.touches.length&&this.Cc&&(this.Cc=!1,Ts(t))}Yc(t){if(0!==t.button)return;const i=this.Zc(t);if(this.Tc=null,this.jc=!1,this.Lc&&(this.Lc(),this.Lc=null),Ss()){this.ld.ownerDocument.documentElement.removeEventListener("mouseleave",this.qc)}if(!this.Kc(t))if(this.ed(i,this.sd.Cd),++this.bc,this.gc&&this.bc>1){const{Gc:s}=this.Jc(Ps(t),this.Mc);s<5&&!this.Ec&&this.ed(i,this.sd.rd),this.hd()}else this.Ec||this.ed(i,this.sd.Td)}od(){null!==this.xc&&(clearTimeout(this.xc),this.xc=null)}Pd(t){if(null!==this.Hc)return;const i=t.changedTouches[0];this.Hc=i.identifier,this.$c=Ds(t);const s=this.ld.ownerDocument.documentElement;this.Oc=!1,this.Dc=!1,this.Wc=!1,this.Pc=Ps(i),this.Vc&&(this.Vc(),this.Vc=null);{const i=this.pd.bind(this),n=this.yd.bind(this);this.Vc=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",n)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",n,{passive:!1}),this.od(),this.xc=setTimeout(this.Dd.bind(this,t),240)}const n=this.Zc(t,i);this.Qc(n,this.sd.Ed),this.yc||(this.Sc=0,this.yc=setTimeout(this.nd.bind(this),500),this.kc=Ps(i))}Od(t){if(0!==t.button)return;const i=this.ld.ownerDocument.documentElement;Ss()&&i.addEventListener("mouseleave",this.qc),this.Ec=!1,this.Tc=Ps(t),this.Lc&&(this.Lc(),this.Lc=null);{const t=this.Md.bind(this),s=this.Yc.bind(this);this.Lc=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.jc=!0,this.Kc(t))return;const s=this.Zc(t);this.ed(s,this.sd.Id),this.gc||(this.bc=0,this.gc=setTimeout(this.hd.bind(this),500),this.Mc=Ps(t))}ad(){this.ld.addEventListener("mouseenter",this._d.bind(this)),this.ld.addEventListener("touchcancel",this.od.bind(this));{const t=this.ld.ownerDocument,i=t=>{this.sd.Nd&&(t.target&&this.ld.contains(t.target)||this.sd.Nd())};this.Nc=()=>{t.removeEventListener("touchstart",i)},this.Ic=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}ys()&&(this.Rc=()=>{this.ld.removeEventListener("dblclick",this.Xc)},this.ld.addEventListener("dblclick",this.Xc)),this.ld.addEventListener("mouseleave",this.Rd.bind(this)),this.ld.addEventListener("touchstart",this.Pd.bind(this),{passive:!0}),ks(this.ld),this.ld.addEventListener("mousedown",this.Od.bind(this)),this.Ad(),this.ld.addEventListener("touchmove",(()=>{}),{passive:!1})}Ad(){void 0===this.sd.Ld&&void 0===this.sd.Vd&&void 0===this.sd.Bd||(this.ld.addEventListener("touchstart",(t=>this.Fd(t.touches)),{passive:!0}),this.ld.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.Bc&&void 0!==this.sd.Vd){const i=Cs(t.touches[0],t.touches[1])/this.Fc;this.sd.Vd(this.Bc,i),Ts(t)}}),{passive:!1}),this.ld.addEventListener("touchend",(t=>{this.Fd(t.touches)})))}Fd(t){1===t.length&&(this.zc=!1),2!==t.length||this.zc||this.Cc?this.zd():this.Wd(t)}Wd(t){const i=this.ld.getBoundingClientRect()||{left:0,top:0};this.Bc={it:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,st:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Fc=Cs(t[0],t[1]),void 0!==this.sd.Ld&&this.sd.Ld(),this.od()}zd(){null!==this.Bc&&(this.Bc=null,void 0!==this.sd.Bd&&this.sd.Bd())}Rd(t){if(this.Ac&&this.Ac(),this.Kc(t))return;if(!this.Uc)return;const i=this.Zc(t);this.ed(i,this.sd.jd),this.Uc=!ys()}Dd(t){const i=Es(t.touches,l(this.Hc));if(null===i)return;const s=this.Zc(t,i);this.Qc(s,this.sd.$d),this.Oc=!0,this.Cc=!0}Kc(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Ds(t)<this.$c+500}Qc(t,i){i&&i.call(this.sd,t)}ed(t,i){i&&i.call(this.sd,t)}Zc(t,i){const s=i||t,n=this.ld.getBoundingClientRect()||{left:0,top:0};return{Hd:s.clientX,Ud:s.clientY,qd:s.pageX,Yd:s.pageY,Xd:s.screenX,Kd:s.screenY,Zd:s.clientX-n.left,Gd:s.clientY-n.top,Jd:t.ctrlKey,Qd:t.altKey,tf:t.shiftKey,if:t.metaKey,sf:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,nf:t.type,ef:s.target,rf:t.view,hf:()=>{"touchstart"!==t.type&&Ts(t)}}}}function Cs(t,i){const s=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(s*s+n*n)}function Ts(t){t.cancelable&&t.preventDefault()}function Ps(t){return{it:t.pageX,st:t.pageY}}function Ds(t){return t.timeStamp||performance.now()}function Es(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Os{constructor(t,i,s,n){if(this.lf=0,this.af=0,this._f=0,this.uf=0,this.cf=0,this.df=0,this.ff=0,this.pf=!1,this.vf=t,this.mf=t.wf()[i],this.bf=t.wf()[s],this.gf=document.createElement("tr"),this.gf.style.height="1px",this.Mf=document.createElement("td"),this.Mf.style.position="relative",this.Mf.style.padding="0",this.Mf.style.margin="0",this.Mf.setAttribute("colspan","3"),this.Sf(),this.gf.appendChild(this.Mf),n)this.yf=null,this.kf=null;else{this.yf=document.createElement("div"),this.yf.style.position="absolute",this.yf.style.zIndex="50",this.yf.style.top="-4px",this.yf.style.height="9px",this.yf.style.width="100%",this.yf.style.backgroundColor="",this.yf.style.cursor="row-resize",this.Mf.appendChild(this.yf);const t={dd:this.xf.bind(this),jd:this.Cf.bind(this),Id:this.Tf.bind(this),Ed:this.Tf.bind(this),Sd:this.Pf.bind(this),gd:this.Pf.bind(this),Cd:this.Df.bind(this),kd:this.Df.bind(this)};this.kf=new xs(this.yf,t,{wd:()=>!1,bd:()=>!0})}}S(){null!==this.kf&&this.kf.S()}Ef(){return this.gf}Of(){return new vs(this.mf.Of().Lt,1)}If(){const t=this.Of(),i=bs(document,t),s=ws(i);return s.fillStyle=this.vf.F().timeScale.borderColor,s.fillRect(0,0,t.Lt,t.Vt),i}ft(){this.Sf()}Sf(){this.Mf.style.background=this.vf.F().timeScale.borderColor}xf(t){null!==this.yf&&(this.yf.style.backgroundColor="hsla(225,8%,72%,.2)")}Cf(t){null===this.yf||this.pf||(this.yf.style.backgroundColor="")}Tf(t){this.lf=t.Yd,this.af=0,this._f=this.mf.Of().Vt+this.bf.Of().Vt,this.uf=this.mf.Ka()+this.bf.Ka(),this.cf=30,this.df=this._f-this.cf,this.ff=this.uf/this._f,this.pf=!0}Pf(t){this.af=t.Yd-this.lf;const i=this.mf.Of().Vt,s=kt(i+this.af,this.cf,this.df)*this.ff,n=this.uf-s;this.mf.Za(s),this.bf.Za(n),this.vf.Nf(),this.mf.Of().Vt!==i&&(this.lf=t.Yd),this.vf.$t().Bh()}Df(t){this.lf=0,this.af=0,this._f=0,this.uf=0,this.cf=0,this.df=0,this.ff=0,this.pf=!1,this.Cf(t)}}function Is(t,i){return t.Rf-i.Rf}function Ns(t,i,s){const n=(t.Rf-i.Rf)/(t.ht-i.ht);return Math.sign(n)*Math.min(Math.abs(n),s)}class Rs{constructor(t,i,s,n){this.Af=null,this.Lf=null,this.Vf=null,this.Bf=null,this.Ff=null,this.zf=0,this.Wf=0,this.jf=!1,this.$f=t,this.Hf=i,this.Uf=s,this.Ns=n}qf(t,i){if(null!==this.Af){if(this.Af.ht===i)return void(this.Af.Rf=t);if(Math.abs(this.Af.Rf-t)<this.Ns)return}this.Bf=this.Vf,this.Vf=this.Lf,this.Lf=this.Af,this.Af={ht:i,Rf:t}}Ie(t,i){if(null===this.Af||null===this.Lf)return;if(i-this.Af.ht>50)return;let s=0;const n=Ns(this.Af,this.Lf,this.Hf),e=Is(this.Af,this.Lf),r=[n],h=[e];if(s+=e,null!==this.Vf){const t=Ns(this.Lf,this.Vf,this.Hf);if(Math.sign(t)===Math.sign(n)){const i=Is(this.Lf,this.Vf);if(r.push(t),h.push(i),s+=i,null!==this.Bf){const t=Ns(this.Vf,this.Bf,this.Hf);if(Math.sign(t)===Math.sign(n)){const i=Is(this.Vf,this.Bf);r.push(t),h.push(i),s+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/s*r[t];Math.abs(l)<this.$f||(this.Ff={Rf:t,ht:i},this.Wf=l,this.zf=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.Uf))}Yf(t){const i=l(this.Ff),s=t-i.ht;return i.Rf+this.Wf*(Math.pow(this.Uf,s)-1)/Math.log(this.Uf)}Xf(t){return null===this.Ff||this.Kf(t)===this.zf}Zf(){return this.jf}Gf(){this.jf=!0}Kf(t){const i=t-l(this.Ff).ht;return Math.min(i,this.zf)}}class As{constructor(t,i,s,n){this.fe=new zt(200),this.W=0,this.Jf="",this.Qe="",this.oe=[],this.Qf=new Map,this.W=t,this.Jf=i,this.Qe=P(t,s,n)}S(){this.fe._e(),this.oe=[],this.Qf.clear()}tp(t,i,s,n,e){const r=this.ip(t,i);if("left"!==e){const i=ms(t.canvas);s-=Math.floor(r.sp*i)}n-=Math.floor(r.Xt/2),t.drawImage(r.np,s,n,r.Yt,r.Xt)}ip(t,i){let s;if(this.Qf.has(i))s=h(this.Qf.get(i));else{if(this.oe.length>=200){const t=h(this.oe.shift());this.Qf.delete(t)}const n=ms(t.canvas),e=Math.ceil(this.W/4.5),r=Math.round(this.W/10),l=Math.ceil(this.fe.ii(t,i)),a=Tt(Math.round(l+2*e)),o=Tt(this.W+2*e),_=bs(document,new vs(a,o));s={ti:i,sp:Math.round(Math.max(1,l)),Yt:Math.ceil(a*n),Xt:Math.ceil(o*n),np:_},0!==l&&(this.oe.push(s.ti),this.Qf.set(s.ti,s)),F(t=ws(s.np),n,(()=>{t.font=this.Qe,t.fillStyle=this.Jf,t.fillText(i,0,o-e-r)}))}return s}}class Ls{constructor(t,i,s,n){this.mi=null,this.ep=null,this.rp=!1,this.hp=new zt(50),this.lp=new As(11,"#000"),this.Jf=null,this.Qe=null,this.ap=0,this.op=!1,this._p=()=>{this.up(this.Cu.F()),this.op||this.Ni.cp().$t().Ur()},this.dp=()=>{this.op||this.Ni.cp().$t().Ur()},this.Ni=t,this.$i=i,this.Cu=s,this.fp="left"===n,this.Mf=document.createElement("div"),this.Mf.style.height="100%",this.Mf.style.overflow="hidden",this.Mf.style.width="25px",this.Mf.style.left="0",this.Mf.style.position="relative",this.pp=gs(this.Mf,new vs(16,16)),this.pp.subscribeCanvasConfigured(this._p);const e=this.pp.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.vp=gs(this.Mf,new vs(16,16)),this.vp.subscribeCanvasConfigured(this.dp);const r=this.vp.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const h={Id:this.Tf.bind(this),Ed:this.Tf.bind(this),Sd:this.Pf.bind(this),gd:this.Pf.bind(this),Nd:this.mp.bind(this),Cd:this.Df.bind(this),kd:this.Df.bind(this),rd:this.wp.bind(this),td:this.wp.bind(this),dd:this.bp.bind(this),jd:this.Cf.bind(this)};this.kf=new xs(this.vp.canvas,h,{wd:()=>!1,bd:()=>!0})}S(){this.kf.S(),this.vp.unsubscribeCanvasConfigured(this.dp),this.vp.destroy(),this.pp.unsubscribeCanvasConfigured(this._p),this.pp.destroy(),null!==this.mi&&this.mi.Ca().v(this),this.mi=null,this.lp.S()}Ef(){return this.Mf}rt(){return l(this.mi).F().borderColor}gp(){return this.$i.textColor}P(){return this.$i.fontSize}Mp(){return P(this.P(),this.$i.fontFamily)}Sp(){const t=this.Cu.F(),i=this.Jf!==t.I,s=this.Qe!==t.D;return(i||s)&&(this.up(t),this.Jf=t.I),s&&(this.hp._e(),this.Qe=t.D),t}yp(){if(null===this.mi)return 0;let t=0;const i=this.Sp(),s=ws(this.pp.canvas),n=this.mi.Ml();s.font=this.Mp(),n.length>0&&(t=Math.max(this.hp.ii(s,n[0].Rl),this.hp.ii(s,n[n.length-1].Rl)));const e=this.kp();for(let i=e.length;i--;){const n=this.hp.ii(s,e[i].ti());n>t&&(t=n)}const r=this.mi.xt();if(null!==r&&null!==this.ep){const i=this.mi.Yi(1,r),n=this.mi.Yi(this.ep.Vt-2,r);t=Math.max(t,this.hp.ii(s,this.mi.gi(Math.floor(Math.min(i,n))+.11111111111111,r)),this.hp.ii(s,this.mi.gi(Math.ceil(Math.max(i,n))-.11111111111111,r)))}const h=t||34;let l=Math.ceil(i.C+i.T+i.R+i.A+h);return l+=l%2,l}xp(t){if(t.Lt<0||t.Vt<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.ep&&this.ep.Cr(t)||(this.ep=t,this.op=!0,this.pp.resizeCanvas({width:t.Lt,height:t.Vt}),this.vp.resizeCanvas({width:t.Lt,height:t.Vt}),this.op=!1,this.Mf.style.width=t.Lt+"px",this.Mf.style.height=t.Vt+"px",this.Mf.style.minWidth=t.Lt+"px")}Cp(){return l(this.ep).Lt}Ei(t){this.mi!==t&&(null!==this.mi&&this.mi.Ca().v(this),this.mi=t,t.Ca().l(this.Ul.bind(this),this))}Pt(){return this.mi}_e(){const t=this.Ni.Tp();this.Ni.cp().$t().do(t,l(this.Pt()))}Pp(t){if(null===this.ep)return;if(1!==t){const t=ws(this.pp.canvas);this.Dp(),this.Ep(t,this.pp.pixelRatio),this.Kn(t,this.pp.pixelRatio),this.Op(t,this.pp.pixelRatio),this.Ip(t,this.pp.pixelRatio)}const i=ws(this.vp.canvas),s=this.ep.Lt,n=this.ep.Vt;F(i,this.vp.pixelRatio,(()=>{i.clearRect(0,0,s,n)})),this.Np(i,this.vp.pixelRatio)}If(){return this.pp.canvas}ft(){var t;null===(t=this.mi)||void 0===t||t.Ml()}Tf(t){if(null===this.mi||this.mi.bi()||!this.Ni.cp().F().handleScale.axisPressedMouseMove.price)return;const i=this.Ni.cp().$t(),s=this.Ni.Tp();this.rp=!0,i.ho(s,this.mi,t.Gd)}Pf(t){if(null===this.mi||!this.Ni.cp().F().handleScale.axisPressedMouseMove.price)return;const i=this.Ni.cp().$t(),s=this.Ni.Tp(),n=this.mi;i.lo(s,n,t.Gd)}mp(){if(null===this.mi||!this.Ni.cp().F().handleScale.axisPressedMouseMove.price)return;const t=this.Ni.cp().$t(),i=this.Ni.Tp(),s=this.mi;this.rp&&(this.rp=!1,t.ao(i,s))}Df(t){if(null===this.mi||!this.Ni.cp().F().handleScale.axisPressedMouseMove.price)return;const i=this.Ni.cp().$t(),s=this.Ni.Tp();this.rp=!1,i.ao(s,this.mi)}wp(t){this.Ni.cp().F().handleScale.axisDoubleClickReset&&this._e()}bp(t){if(null===this.mi)return;!this.Ni.cp().$t().F().handleScale.axisPressedMouseMove.price||this.mi.gr()||this.mi.aa()||this.Rp(1)}Cf(t){this.Rp(0)}kp(){const t=[],i=null===this.mi?void 0:this.mi;return(s=>{for(let n=0;n<s.length;++n){const e=s[n].ls(this.Ni.Tp(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.Ni.Tp().Ma()),t}Ep(t,i){if(null===this.ep)return;const s=this.ep.Lt,n=this.ep.Vt;F(t,i,(()=>{const i=this.Ni.Tp().$t(),e=i.mc(),r=i.vc();e===r?z(t,0,0,s,n,e):W(t,0,0,s,n,e,r)}))}Kn(t,i){if(null===this.ep||null===this.mi||!this.mi.F().borderVisible)return;t.save(),t.fillStyle=this.rt();const s=Math.max(1,Math.floor(this.Sp().C*i));let n;n=this.fp?Math.floor(this.ep.Lt*i)-s:0,t.fillRect(n,0,s,Math.ceil(this.ep.Vt*i)),t.restore()}Op(t,i){if(null===this.ep||null===this.mi)return;const s=this.mi.Ml();t.save(),t.strokeStyle=this.rt(),t.font=this.Mp(),t.fillStyle=this.rt();const n=this.Sp(),e=this.fp?Math.floor((this.ep.Lt-n.T)*i-n.C*i):Math.floor(n.C*i),r=this.fp?Math.round(e-n.R*i):Math.round(e+n.T*i+n.R*i),h=this.fp?"right":"left",l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i),o=this.mi.F();if(o.borderVisible&&o.ticksVisible){const r=Math.round(n.T*i);t.beginPath();for(const n of s)t.rect(e,Math.round(n.vl*i)-a,r,l);t.fill()}t.fillStyle=this.gp();for(const n of s)this.lp.tp(t,n.Rl,r,Math.round(n.vl*i),h);t.restore()}Dp(){if(null===this.ep||null===this.mi)return;let t=this.ep.Vt/2;const i=[],s=this.mi.Ma().slice(),n=this.Ni.Tp(),e=this.Sp();this.mi===n.ge()&&this.Ni.Tp().Ma().forEach((t=>{n.be(t)&&s.push(t)}));const r=this.mi.gt()[0],h=this.mi;s.forEach((s=>{const e=s.ls(n,h);e.forEach((t=>{t.ci(null),t.di()&&i.push(t)})),r===s&&e.length>0&&(t=e[0].si())}));const l=i.filter((i=>i.si()<=t)),a=i.filter((i=>i.si()>t));l.sort(((t,i)=>i.si()-t.si())),l.length&&a.length&&a.push(l[0]),a.sort(((t,i)=>t.si()-i.si())),i.forEach((t=>t.ci(t.si())));if(this.mi.F().alignLabels){for(let t=1;t<l.length;t++){const i=l[t],s=l[t-1],n=s.Xt(e,!1),r=i.si(),h=s.ui();r>h-n&&i.ci(h-n)}for(let t=1;t<a.length;t++){const i=a[t],s=a[t-1],n=s.Xt(e,!0),r=i.si(),h=s.ui();r<h+n&&i.ci(h+n)}}}Ip(t,i){if(null===this.ep)return;t.save();const s=this.ep,n=this.kp(),e=this.Sp(),r=this.fp?"right":"left";n.forEach((n=>{if(n.fi()){const h=n.wt(l(this.mi));t.save(),h.q(t,e,this.hp,s.Lt,r,i),t.restore()}})),t.restore()}Np(t,i){if(null===this.ep||null===this.mi)return;t.save();const s=this.ep,n=this.Ni.cp().$t(),e=[],r=this.Ni.Tp(),h=n.ju().ls(r,this.mi);h.length&&e.push(h);const a=this.Sp(),o=this.fp?"right":"left";e.forEach((n=>{n.forEach((n=>{t.save(),n.wt(l(this.mi)).q(t,a,this.hp,s.Lt,o,i),t.restore()}))})),t.restore()}Rp(t){this.Mf.style.cursor=1===t?"ns-resize":"default"}Ul(){const t=this.yp();this.ap<t&&this.Ni.cp().$t().Bh(),this.ap=t}up(t){this.lp.S(),this.lp=new As(t.P,t.I,t.O)}}function Vs(t,i,s,n,e){t.X&&t.X(i,s,n,e)}function Bs(t,i,s,n,e){t.q(i,s,n,e)}function Fs(t,i){return t.hs(i)}function zs(t,i){return t.Oi(i)}function Ws(t,i){return void 0!==t.Gh?t.Gh(i):[]}class js{constructor(t,i){this.ep=new vs(0,0),this.Ap=null,this.Lp=null,this.Vp=null,this.Bp=!1,this.Fp=new w,this.zp=0,this.Wp=!1,this.jp=null,this.$p=!1,this.Hp=null,this.Up=null,this.op=!1,this._p=()=>{this.op||null===this.qp||this.yi().Ur()},this.dp=()=>{this.op||null===this.qp||this.yi().Ur()},this.Yp=t,this.qp=i,this.qp.vo().l(this.Xp.bind(this),this,!0),this.Kp=document.createElement("td"),this.Kp.style.padding="0",this.Kp.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Zp=document.createElement("td"),this.Zp.style.padding="0",this.Gp=document.createElement("td"),this.Gp.style.padding="0",this.Kp.appendChild(s),this.pp=gs(s,new vs(16,16)),this.pp.subscribeCanvasConfigured(this._p);const n=this.pp.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.vp=gs(s,new vs(16,16)),this.vp.subscribeCanvasConfigured(this.dp);const e=this.vp.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.gf=document.createElement("tr"),this.gf.appendChild(this.Zp),this.gf.appendChild(this.Kp),this.gf.appendChild(this.Gp),this.Jp(),this.kf=new xs(this.vp.canvas,this,{wd:()=>null===this.jp&&!this.Yp.F().handleScroll.vertTouchDrag,bd:()=>null===this.jp&&!this.Yp.F().handleScroll.horzTouchDrag})}S(){null!==this.Ap&&this.Ap.S(),null!==this.Lp&&this.Lp.S(),this.vp.unsubscribeCanvasConfigured(this.dp),this.vp.destroy(),this.pp.unsubscribeCanvasConfigured(this._p),this.pp.destroy(),null!==this.qp&&this.qp.vo().v(this),this.kf.S()}Tp(){return l(this.qp)}Qp(t){null!==this.qp&&this.qp.vo().v(this),this.qp=t,null!==this.qp&&this.qp.vo().l(js.prototype.Xp.bind(this),this,!0),this.Jp()}cp(){return this.Yp}Ef(){return this.gf}Jp(){if(null!==this.qp&&(this.tv(),0!==this.yi().vt().length)){if(null!==this.Ap){const t=this.qp.eo();this.Ap.Ei(l(t))}if(null!==this.Lp){const t=this.qp.ro();this.Lp.Ei(l(t))}}}iv(){null!==this.Ap&&this.Ap.ft(),null!==this.Lp&&this.Lp.ft()}Ka(){return null!==this.qp?this.qp.Ka():0}Za(t){this.qp&&this.qp.Za(t)}dd(t){if(!this.qp)return;this.sv();const i=t.Zd,s=t.Gd;this.nv(i,s)}Id(t){this.sv(),this.ev(),this.nv(t.Zd,t.Gd)}fd(t){if(!this.qp)return;this.sv();const i=t.Zd,s=t.Gd;this.nv(i,s);const n=this.tr(i,s);this.yi().Lu(n&&{Vu:n.Vu,rv:n.rv})}Td(t){if(null===this.qp)return;this.sv();const i=t.Zd,s=t.Gd;if(this.Fp.M()){const t=this.yi().ju().Mt(),n=this.yi().rc(l(this.qp));this.Fp.m(t,{x:i,y:s,hc:n})}}Sd(t){this.sv(),this.hv(t),this.nv(t.Zd,t.Gd)}Cd(t){null!==this.qp&&(this.sv(),this.Wp=!1,this.lv(t))}$d(t){if(this.Wp=!0,null===this.jp){const i={x:t.Zd,y:t.Gd};this.av(i,i)}}jd(t){null!==this.qp&&(this.sv(),this.qp.$t().Lu(null),this.ov())}_v(){return this.Fp}Ld(){this.zp=1,this.uv()}Vd(t,i){if(!this.Yp.F().handleScale.pinch)return;const s=5*(i-this.zp);this.zp=i,this.yi().Gu(t.it,s)}Ed(t){if(this.Wp=!1,this.$p=null!==this.jp,this.ev(),null!==this.jp){const i=this.yi().ju();this.Hp={x:i.Kt(),y:i.Zt()},this.jp={x:t.Zd,y:t.Gd}}}gd(t){if(null===this.qp)return;const i=t.Zd,s=t.Gd;if(null===this.jp)this.hv(t);else{this.$p=!1;const t=l(this.Hp),n=t.x+(i-this.jp.x),e=t.y+(s-this.jp.y);this.nv(n,e)}}kd(t){0===this.cp().F().trackingMode.exitMode&&(this.$p=!0),this.cv(),this.lv(t)}tr(t,i){const s=this.qp;if(null===s)return null;const n=s.Ma();for(const e of n){const n=this.dv(e.hs(s),t,i);if(null!==n)return{Vu:e,rf:n.rf,rv:n.rv}}return null}fv(t,i){l("left"===i?this.Ap:this.Lp).xp(new vs(t,this.ep.Vt))}Of(){return this.ep}xp(t){if(t.Lt<0||t.Vt<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.ep.Cr(t)||(this.ep=t,this.op=!0,this.pp.resizeCanvas({width:t.Lt,height:t.Vt}),this.vp.resizeCanvas({width:t.Lt,height:t.Vt}),this.op=!1,this.Kp.style.width=t.Lt+"px",this.Kp.style.height=t.Vt+"px")}pv(){const t=l(this.qp);t.no(t.eo()),t.no(t.ro());for(const i of t.gt())if(t.be(i)){const s=i.Pt();null!==s&&t.no(s),i._s()}}If(){return this.pp.canvas}Pp(t){if(0===t)return;if(null===this.qp)return;if(t>1&&this.pv(),null!==this.Ap&&this.Ap.Pp(t),null!==this.Lp&&this.Lp.Pp(t),1!==t){const t=ws(this.pp.canvas);t.save(),this.Ep(t,this.pp.pixelRatio),this.qp&&(this.vv(t,this.pp.pixelRatio),this.mv(t,this.pp.pixelRatio),this.wv(t,this.pp.pixelRatio,Fs),this.wv(t,this.pp.pixelRatio,zs)),t.restore()}const i=ws(this.vp.canvas);i.clearRect(0,0,Math.ceil(this.ep.Lt*this.vp.pixelRatio),Math.ceil(this.ep.Vt*this.vp.pixelRatio)),this.wv(i,this.pp.pixelRatio,Ws),this.bv(i,this.vp.pixelRatio)}gv(){return this.Ap}Mv(){return this.Kp}Sv(){return this.Lp}Xp(){null!==this.qp&&this.qp.vo().v(this),this.qp=null}Ep(t,i){F(t,i,(()=>{const i=this.yi(),s=i.mc(),n=i.vc();s===n?z(t,0,0,this.ep.Lt,this.ep.Vt,n):W(t,0,0,this.ep.Lt,this.ep.Vt,s,n)}))}vv(t,i){const s=l(this.qp),n=s.mo().qr().wt(s.Xt(),s.Yt(),s);null!==n&&(t.save(),n.q(t,i,!1),t.restore())}mv(t,i){const s=this.yi().Wu();this.yv(t,i,Fs,Vs,s),this.yv(t,i,Fs,Bs,s)}bv(t,i){this.yv(t,i,Fs,Bs,this.yi().ju())}wv(t,i,s){const n=l(this.qp).Ma();for(const e of n)this.yv(t,i,s,Vs,e);for(const e of n)this.yv(t,i,s,Bs,e)}yv(t,i,s,n,e){const r=l(this.qp),h=s(e,r),a=r.Xt(),o=r.Yt(),_=r.$t().Au(),u=null!==_&&_.Vu===e,c=null!==_&&u&&void 0!==_.rv?_.rv.ir:void 0;for(const s of h){const e=s.wt(a,o,r);null!==e&&(t.save(),n(e,t,i,u,c),t.restore())}}dv(t,i,s){const n=l(this.qp);for(const e of t){const t=e.wt(this.ep.Vt,this.ep.Lt,n);if(null!==t&&t.tr){const n=t.tr(i,s);if(null!==n)return{rf:e,rv:n}}}return null}tv(){if(null===this.qp)return;const t=this.Yp,i=this.qp.eo().F().visible,s=this.qp.ro().F().visible;i||null===this.Ap||(this.Zp.removeChild(this.Ap.Ef()),this.Ap.S(),this.Ap=null),s||null===this.Lp||(this.Gp.removeChild(this.Lp.Ef()),this.Lp.S(),this.Lp=null);const n=t.$t().oc();i&&null===this.Ap&&(this.Ap=new Ls(this,t.F().layout,n,"left"),this.Zp.appendChild(this.Ap.Ef())),s&&null===this.Lp&&(this.Lp=new Ls(this,t.F().layout,n,"right"),this.Gp.appendChild(this.Lp.Ef()))}kv(t){return t.sf&&this.Wp||null!==this.jp}xv(t){return Math.max(0,Math.min(t,this.ep.Lt-1))}Cv(t){return Math.max(0,Math.min(t,this.ep.Vt-1))}nv(t,i){this.yi().ec(this.xv(t),this.Cv(i),l(this.qp))}ov(){this.yi().lc()}cv(){this.$p&&(this.jp=null,this.ov())}av(t,i){this.jp=t,this.$p=!1,this.nv(i.x,i.y);const s=this.yi().ju();this.Hp={x:s.Kt(),y:s.Zt()}}yi(){return this.Yp.$t()}Tv(){const t=this.yi(),i=this.Tp(),s=i.qi();t.uo(i,s),t.ic(),this.Vp=null,this.Bp=!1}lv(t){if(!this.Bp)return;const i=performance.now();if(null!==this.Up&&this.Up.Ie(t.Zd,i),null===this.Up||this.Up.Xf(i))return void this.Tv();const s=this.yi(),n=s.St(),e=this.Up,r=()=>{if(e.Zf())return;const t=performance.now();let i=e.Xf(t);if(!e.Zf()){const r=n.L_();s.tc(e.Yf(t)),r===n.L_()&&(i=!0,this.Up=null)}i?this.Tv():requestAnimationFrame(r)};requestAnimationFrame(r)}sv(){this.jp=null}ev(){if(!this.qp)return;if(this.uv(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)l(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.qp.qi().bi()&&this.yi().St().bi()}hv(t){if(null===this.qp)return;const i=this.yi();if(i.St().bi())return;const s=this.Yp.F(),n=s.handleScroll,e=s.kineticScroll;if((!n.pressedMouseMove||t.sf)&&(!n.horzTouchDrag&&!n.vertTouchDrag||!t.sf))return;const r=this.qp.qi(),h=performance.now();null!==this.Vp||this.kv(t)||(this.Vp={x:t.Hd,y:t.Ud,Bo:h,Zd:t.Zd,Gd:t.Gd}),null!==this.Up&&this.Up.qf(t.Zd,h),null===this.Vp||this.Bp||this.Vp.x===t.Hd&&this.Vp.y===t.Ud||(null===this.Up&&(t.sf&&e.touch||!t.sf&&e.mouse)&&(this.Up=new Rs(.2,7,.997,15),this.Up.qf(this.Vp.Zd,this.Vp.Bo),this.Up.qf(t.Zd,h)),r.bi()||i.oo(this.qp,r,t.Gd),i.Qu(t.Zd),this.Bp=!0),this.Bp&&(r.bi()||i._o(this.qp,r,t.Gd),i.tc(t.Zd))}uv(){const t=performance.now(),i=null===this.Up||this.Up.Xf(t);null!==this.Up&&(i||this.Tv()),null!==this.Up&&(this.Up.Gf(),this.Up=null)}}class $s{constructor(t,i,s,n,e){this.li=!0,this.ep=new vs(0,0),this._p=()=>this.Pp(3),this.fp="left"===t,this.Cu=s.oc,this.$i=i,this.Pv=n,this.Dv=e,this.Mf=document.createElement("div"),this.Mf.style.width="25px",this.Mf.style.height="100%",this.Mf.style.overflow="hidden",this.pp=gs(this.Mf,new vs(16,16)),this.pp.subscribeCanvasConfigured(this._p)}S(){this.pp.unsubscribeCanvasConfigured(this._p),this.pp.destroy()}Ef(){return this.Mf}Of(){return this.ep}xp(t){if(t.Lt<0||t.Vt<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.ep.Cr(t)||(this.ep=t,this.pp.resizeCanvas({width:t.Lt,height:t.Vt}),this.Mf.style.width=`${t.Lt}px`,this.Mf.style.minWidth=`${t.Lt}px`,this.Mf.style.height=`${t.Vt}px`,this.li=!0)}Pp(t){if(t<3&&!this.li)return;if(0===this.ep.Lt||0===this.ep.Vt)return;this.li=!1;const i=ws(this.pp.canvas);this.Ep(i,this.pp.pixelRatio),this.Kn(i,this.pp.pixelRatio)}If(){return this.pp.canvas}Kn(t,i){if(!this.Pv())return;const s=this.ep.Lt;t.save(),t.fillStyle=this.$i.timeScale.borderColor;const n=Math.floor(this.Cu.F().C*i),e=this.fp?Math.round(s*i)-n:0;t.fillRect(e,0,n,n),t.restore()}Ep(t,i){F(t,i,(()=>{z(t,0,0,this.ep.Lt,this.ep.Vt,this.Dv())}))}}function Hs(t,i){return t.Xo>i.Xo?t:i}class Us{constructor(t){this.Ev=null,this.Ov=null,this.k=null,this.Iv=!1,this.ep=new vs(0,0),this.Nv=new w,this.hp=new zt(5),this.op=!1,this._p=()=>{this.op||this.Yp.$t().Ur()},this.dp=()=>{this.op||this.Yp.$t().Ur()},this.Yp=t,this.$i=t.F().layout,this.Rv=document.createElement("tr"),this.Av=document.createElement("td"),this.Av.style.padding="0",this.Lv=document.createElement("td"),this.Lv.style.padding="0",this.Mf=document.createElement("td"),this.Mf.style.height="25px",this.Mf.style.padding="0",this.Vv=document.createElement("div"),this.Vv.style.width="100%",this.Vv.style.height="100%",this.Vv.style.position="relative",this.Vv.style.overflow="hidden",this.Mf.appendChild(this.Vv),this.pp=gs(this.Vv,new vs(16,16)),this.pp.subscribeCanvasConfigured(this._p);const i=this.pp.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.vp=gs(this.Vv,new vs(16,16)),this.vp.subscribeCanvasConfigured(this.dp);const s=this.vp.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Rv.appendChild(this.Av),this.Rv.appendChild(this.Mf),this.Rv.appendChild(this.Lv),this.Bv(),this.Yp.$t().Xa().l(this.Bv.bind(this),this),this.kf=new xs(this.vp.canvas,this,{wd:()=>!0,bd:()=>!1})}S(){this.kf.S(),null!==this.Ev&&this.Ev.S(),null!==this.Ov&&this.Ov.S(),this.vp.unsubscribeCanvasConfigured(this.dp),this.vp.destroy(),this.pp.unsubscribeCanvasConfigured(this._p),this.pp.destroy()}Ef(){return this.Rv}Fv(){return this.Ev}zv(){return this.Ov}Id(t){if(this.Iv)return;this.Iv=!0;const i=this.Yp.$t();!i.St().bi()&&this.Yp.F().handleScale.axisPressedMouseMove.time&&i.Zu(t.Zd)}Ed(t){this.Id(t)}Nd(){const t=this.Yp.$t();!t.St().bi()&&this.Iv&&(this.Iv=!1,this.Yp.F().handleScale.axisPressedMouseMove.time&&t.nc())}Sd(t){const i=this.Yp.$t();!i.St().bi()&&this.Yp.F().handleScale.axisPressedMouseMove.time&&i.sc(t.Zd)}gd(t){this.Sd(t)}Cd(){this.Iv=!1;const t=this.Yp.$t();t.St().bi()&&!this.Yp.F().handleScale.axisPressedMouseMove.time||t.nc()}kd(){this.Cd()}rd(){this.Yp.F().handleScale.axisDoubleClickReset&&this.Yp.$t().Ts()}td(){this.rd()}dd(){this.Yp.$t().F().handleScale.axisPressedMouseMove.time&&this.Rp(1)}jd(){this.Rp(0)}Of(){return this.ep}Wv(){return this.Nv}jv(t,i,s){this.ep&&this.ep.Cr(t)||(this.ep=t,this.op=!0,this.pp.resizeCanvas({width:t.Lt,height:t.Vt}),this.vp.resizeCanvas({width:t.Lt,height:t.Vt}),this.op=!1,this.Mf.style.width=t.Lt+"px",this.Mf.style.height=t.Vt+"px",this.Nv.m(t)),null!==this.Ev&&this.Ev.xp(new vs(i,t.Vt)),null!==this.Ov&&this.Ov.xp(new vs(s,t.Vt))}$v(){const t=this.Hv();return Math.ceil(t.C+t.T+t.P+t.L+t.N)}ft(){this.Yp.$t().St().Ml()}If(){return this.pp.canvas}Pp(t){if(0===t)return;if(1!==t){const i=ws(this.pp.canvas);this.Ep(i,this.pp.pixelRatio),this.Kn(i,this.pp.pixelRatio),this.Op(i,this.pp.pixelRatio),null!==this.Ev&&this.Ev.Pp(t),null!==this.Ov&&this.Ov.Pp(t)}const i=ws(this.vp.canvas),s=this.vp.pixelRatio;i.clearRect(0,0,Math.ceil(this.ep.Lt*s),Math.ceil(this.ep.Vt*s)),this.Uv([this.Yp.$t().ju()],i,s)}Ep(t,i){F(t,i,(()=>{z(t,0,0,this.ep.Lt,this.ep.Vt,this.Yp.$t().vc())}))}Kn(t,i){if(this.Yp.F().timeScale.borderVisible){t.save(),t.fillStyle=this.qv();const s=Math.max(1,Math.floor(this.Hv().C*i));t.fillRect(0,0,Math.ceil(this.ep.Lt*i),s),t.restore()}}Op(t,i){const s=this.Yp.$t().St(),n=s.Ml();if(!n||0===n.length)return;let e=n.reduce(Hs,n[0]).Xo;e>30&&e<50&&(e=30),t.save(),t.strokeStyle=this.qv();const r=this.Hv(),h=r.C+r.T+r.L+r.P-r.V;t.textAlign="center",t.fillStyle=this.qv();const l=Math.floor(this.Hv().C*i),a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i),_=s.F();if(_.borderVisible&&_.ticksVisible){t.beginPath();const s=Math.round(r.T*i);for(let e=n.length;e--;){const r=Math.round(n[e].vl*i);t.rect(r-o,l,a,s)}t.fill()}t.fillStyle=this.$(),F(t,i,(()=>{t.font=this.Yv();for(const i of n)if(i.Xo<e){const s=i.F_?this.Xv(t,i.vl,i.Rl):i.vl;t.fillText(i.Rl,s,h)}t.font=this.Kv();for(const i of n)if(i.Xo>=e){const s=i.F_?this.Xv(t,i.vl,i.Rl):i.vl;t.fillText(i.Rl,s,h)}})),t.restore()}Xv(t,i,s){const n=this.hp.ii(t,s),e=n/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+n>this.ep.Lt&&(i-=Math.abs(this.ep.Lt-(r+n))),i}Uv(t,i,s){const n=this.Hv();for(const e of t)for(const t of e.Ii())i.save(),t.wt().q(i,n,s),i.restore()}qv(){return this.Yp.F().timeScale.borderColor}$(){return this.$i.textColor}W(){return this.$i.fontSize}Yv(){return P(this.W(),this.$i.fontFamily)}Kv(){return P(this.W(),this.$i.fontFamily,"bold")}Hv(){null===this.k&&(this.k={C:1,V:NaN,L:NaN,N:NaN,Si:NaN,T:3,P:NaN,D:"",Mi:new zt});const t=this.k,i=this.Yv();if(t.D!==i){const s=this.W();t.P=s,t.D=i,t.L=Math.ceil(s/2.5),t.N=t.L,t.Si=Math.ceil(s/2),t.V=Math.round(this.W()/5),t.Mi._e()}return this.k}Rp(t){this.Mf.style.cursor=1===t?"ew-resize":"default"}Bv(){const t=this.Yp.$t(),i=t.F();i.leftPriceScale.visible||null===this.Ev||(this.Av.removeChild(this.Ev.Ef()),this.Ev.S(),this.Ev=null),i.rightPriceScale.visible||null===this.Ov||(this.Lv.removeChild(this.Ov.Ef()),this.Ov.S(),this.Ov=null);const s={oc:this.Yp.$t().oc()},n=()=>i.leftPriceScale.borderVisible&&t.St().F().borderVisible,e=()=>t.vc();i.leftPriceScale.visible&&null===this.Ev&&(this.Ev=new $s("left",i,s,n,e),this.Av.appendChild(this.Ev.Ef())),i.rightPriceScale.visible&&null===this.Ov&&(this.Ov=new $s("right",i,s,n,e),this.Lv.appendChild(this.Ov.Ef()))}}class qs{constructor(t,i){var s;this.Zv=[],this.Gv=[],this.Jv=0,this.Vl=0,this.de=0,this.Qv=0,this.tm=0,this.im=null,this.sm=!1,this.Fp=new w,this.Su=new w,this.$i=i,this.Rv=document.createElement("div"),this.Rv.classList.add("tv-lightweight-charts"),this.Rv.style.overflow="hidden",this.Rv.style.width="100%",this.Rv.style.height="100%",(s=this.Rv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.nm=document.createElement("table"),this.nm.setAttribute("cellspacing","0"),this.Rv.appendChild(this.nm),this.rm=this.hm.bind(this),this.Rv.addEventListener("wheel",this.rm,{passive:!1}),this.yi=new cs(this.xu.bind(this),this.$i),this.$t().$u().l(this.lm.bind(this),this),this.am=new Us(this),this.nm.appendChild(this.am.Ef());let n=this.$i.width,e=this.$i.height;if(0===n||0===e){const i=t.getBoundingClientRect();0===n&&(n=Math.floor(i.width),n-=n%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.om(n,e),this._m(),t.appendChild(this.Rv),this.um(),this.yi.St().Z_().l(this.yi.Bh.bind(this.yi),this),this.yi.Xa().l(this.yi.Bh.bind(this.yi),this)}$t(){return this.yi}F(){return this.$i}wf(){return this.Zv}dm(){return this.am}S(){this.Rv.removeEventListener("wheel",this.rm),0!==this.Jv&&window.cancelAnimationFrame(this.Jv),this.yi.$u().v(this),this.yi.St().Z_().v(this),this.yi.Xa().v(this),this.yi.S();for(const t of this.Zv)this.nm.removeChild(t.Ef()),t._v().v(this),t.S();this.Zv=[];for(const t of this.Gv)this.fm(t);this.Gv=[],l(this.am).S(),null!==this.Rv.parentElement&&this.Rv.parentElement.removeChild(this.Rv),this.Su.S(),this.Fp.S()}om(t,i,s=!1){if(this.Vl===i&&this.de===t)return;this.Vl=i,this.de=t;const n=i+"px",e=t+"px";l(this.Rv).style.height=n,l(this.Rv).style.width=e,this.nm.style.height=n,this.nm.style.width=e,s?this.pm(new J(3)):this.yi.Bh()}Pp(t){void 0===t&&(t=new J(3));for(let i=0;i<this.Zv.length;i++)this.Zv[i].Pp(t.ys(i).gs);this.$i.timeScale.visible&&this.am.Pp(t.Ss())}Hr(t){this.yi.Hr(t),this.um();const i=t.width||this.de,s=t.height||this.Vl;this.om(i,s)}_v(){return this.Fp}$u(){return this.Su}vm(){null!==this.im&&(this.pm(this.im),this.im=null);const t=this.Zv[0],i=bs(document,new vs(this.de,this.Vl)),s=ws(i),n=ms(i);return F(s,n,(()=>{let i=0,n=0;const e=t=>{for(let e=0;e<this.Zv.length;e++){const r=this.Zv[e],h=r.Of().Vt,a=l("left"===t?r.gv():r.Sv()),o=a.If();if(s.drawImage(o,i,n,a.Cp(),h),n+=h,e<this.Zv.length-1){const t=this.Gv[e],r=t.Of(),h=t.If();s.drawImage(h,i,n,r.Lt,r.Vt),n+=r.Vt}}};this.wm()&&(e("left"),i=l(t.gv()).Cp()),n=0;for(let t=0;t<this.Zv.length;t++){const e=this.Zv[t],r=e.Of(),h=e.If();if(s.drawImage(h,i,n,r.Lt,r.Vt),n+=r.Vt,t<this.Zv.length-1){const e=this.Gv[t],r=e.Of(),h=e.If();s.drawImage(h,i,n,r.Lt,r.Vt),n+=r.Vt}}i+=t.Of().Lt,this.bm()&&(n=0,e("right"));const r=t=>{const e=l("left"===t?this.am.Fv():this.am.zv()),r=e.Of(),h=e.If();s.drawImage(h,i,n,r.Lt,r.Vt)};if(this.$i.timeScale.visible){i=0,this.wm()&&(r("left"),i=l(t.gv()).Cp());const e=this.am.Of(),h=this.am.If();s.drawImage(h,i,n,e.Lt,e.Vt),this.bm()&&(i+=t.Of().Lt,r("right"),s.restore())}})),i}gm(t){if("left"===t&&!this.wm())return 0;if("right"===t&&!this.bm())return 0;if(0===this.Zv.length)return 0;return l("left"===t?this.Zv[0].gv():this.Zv[0].Sv()).Cp()}Nf(){this.Mm()}Mm(){var t;let i=0,s=0,n=0;for(const t of this.Zv)this.wm()&&(s=Math.max(s,l(t.gv()).yp())),this.bm()&&(n=Math.max(n,l(t.Sv()).yp())),i+=t.Ka();const e=this.de,r=this.Vl,h=Math.max(e-s-n,0),a=1*this.Gv.length,o=this.$i.timeScale.visible;let _=o?this.am.$v():0;_%2&&(_+=1);const u=a+_,c=r<u?0:r-u,d=c/i;let f=0;const p=(null===(t=document.body.ownerDocument.defaultView)||void 0===t?void 0:t.devicePixelRatio)||1;for(let t=0;t<this.Zv.length;++t){const i=this.Zv[t];i.Qp(this.yi.zu()[t]);let e=0,r=0;r=t===this.Zv.length-1?Math.ceil((c-f)*p)/p:Math.round(i.Ka()*d*p)/p,e=Math.max(r,2),f+=e,i.xp(new vs(h,e)),this.wm()&&i.fv(s,"left"),this.bm()&&i.fv(n,"right"),i.Tp()&&this.yi.Hu(i.Tp(),e)}this.am.jv(new vs(o?h:0,_),o?s:0,o?n:0),this.yi.Ga(h),this.Qv!==s&&(this.Qv=s),this.tm!==n&&(this.tm=n)}hm(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.$i.handleScroll.mouseWheel||0!==s&&this.$i.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.$i.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),n=t.clientX-this.Rv.getBoundingClientRect().left;this.$t().Gu(n,i)}0!==i&&this.$i.handleScroll.mouseWheel&&this.$t().Ju(-80*i)}}pm(t){var i;const s=t.Ss();3===s&&this.Sm(),3!==s&&2!==s||(this.ym(t),this.km(t),this.am.ft(),this.Zv.forEach((t=>{t.iv()})),3===(null===(i=this.im)||void 0===i?void 0:i.Ss())&&(this.im.Os(t),this.Sm(),this.ym(this.im),this.km(this.im),t=this.im,this.im=null)),this.Pp(t)}km(t){const i=t.Es();for(const t of i)this.Is(t)}ym(t){const i=this.yi.zu();for(let s=0;s<i.length;s++)t.ys(s).Ms&&i[s].fo()}Is(t){const i=this.yi.St();switch(t.xs){case 0:i.J_();break;case 1:i.Q_(t.Dt);break;case 2:i.Ps(t.Dt);break;case 3:i.Ds(t.Dt);break;case 4:i.z_()}}xu(t){null!==this.im?this.im.Os(t):this.im=t,this.sm||(this.sm=!0,this.Jv=window.requestAnimationFrame((()=>{if(this.sm=!1,this.Jv=0,null!==this.im){const t=this.im;this.im=null,this.pm(t)}})))}Sm(){this._m()}fm(t){this.nm.removeChild(t.Ef()),t.S()}_m(){const t=this.yi.zu(),i=t.length,s=this.Zv.length;for(let t=i;t<s;t++){const t=h(this.Zv.pop());this.nm.removeChild(t.Ef()),t._v().v(this),t.S();const i=this.Gv.pop();void 0!==i&&this.fm(i)}for(let n=s;n<i;n++){const i=new js(this,t[n]);if(i._v().l(this.xm.bind(this),this),this.Zv.push(i),n>0){const t=new Os(this,n-1,n,!1);this.Gv.push(t),this.nm.insertBefore(t.Ef(),this.am.Ef())}this.nm.insertBefore(i.Ef(),this.am.Ef())}for(let s=0;s<i;s++){const i=t[s],n=this.Zv[s];n.Tp()!==i?n.Qp(i):n.Jp()}this.um(),this.Mm()}Cm(t,i){var s,n;const e=new Map;if(null!==t){this.yi.vt().forEach((i=>{const s=i.fs().uh(t);null!==s&&e.set(i,s)}))}let r;if(null!==t){const i=null===(s=this.yi.St().ki(t))||void 0===s?void 0:s.Ko;void 0!==i&&(r=i)}const h=this.$t().Au(),l=null!==h&&h.Vu instanceof yi?h.Vu:void 0,a=null!==h&&void 0!==h.rv?h.rv.nr:void 0;return{ht:r,bn:null!=t?t:void 0,Tm:null!=i?i:void 0,hc:null!==(n=null==i?void 0:i.hc)&&void 0!==n?n:void 0,Pm:l,Dm:e,Em:a}}xm(t,i){this.Fp.m((()=>this.Cm(t,i)))}lm(t,i){this.Su.m((()=>this.Cm(t,i)))}um(){const t=this.$i.timeScale.visible?"":"none";this.am.Ef().style.display=t}wm(){return this.Zv[0].Tp().eo().F().visible}bm(){return this.Zv[0].Tp().ro().F().visible}}function Ys(t,i,s,n){const e=s.value;return{bn:i,ht:t,Dt:[e,e,e,e],Ko:n}}function Xs(t,i,s,n){const e=s.value,r={bn:i,ht:t,Dt:[e,e,e,e],Ko:n};return"color"in s&&void 0!==s.color&&(r.I=s.color),r}function Ks(t){return void 0!==t.Dt}function Zs(t){return(i,s,n,e)=>{return void 0===(r=n).open&&void 0===r.value?{ht:i,bn:s,Ko:e}:t(i,s,n,e);var r}}const Gs={Candlestick:Zs((function(t,i,s,n){const e={bn:i,ht:t,Dt:[s.open,s.high,s.low,s.close],Ko:n};return"color"in s&&void 0!==s.color&&(e.I=s.color),"borderColor"in s&&void 0!==s.borderColor&&(e.Et=s.borderColor),"wickColor"in s&&void 0!==s.wickColor&&(e.Jn=s.wickColor),e})),Bar:Zs((function(t,i,s,n){const e={bn:i,ht:t,Dt:[s.open,s.high,s.low,s.close],Ko:n};return"color"in s&&void 0!==s.color&&(e.I=s.color),e})),Area:Zs(Ys),Baseline:Zs(Ys),Histogram:Zs(Xs),Line:Zs(Xs)};function Js(t){return Gs[t]}function Qs(t){return 60*t*60*1e3}function tn(t){return 60*t*1e3}const sn=[{Om:(nn=1,1e3*nn),Xo:10},{Om:tn(1),Xo:20},{Om:tn(5),Xo:21},{Om:tn(30),Xo:22},{Om:Qs(1),Xo:30},{Om:Qs(3),Xo:31},{Om:Qs(6),Xo:32},{Om:Qs(12),Xo:33}];var nn;function en(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=sn.length-1;s>=0;--s)if(Math.floor(i.getTime()/sn[s].Om)!==Math.floor(t.getTime()/sn[s].Om))return sn[s].Xo;return 0}function rn(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].ht.Bo,n=null!==s?new Date(1e3*s):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.ht.Bo);null!==n&&(i.Yo=en(h,n)),e+=i.ht.Bo-(s||i.ht.Bo),s=i.ht.Bo,n=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].ht.Bo-i));t[0].Yo=en(new Date(1e3*t[0].ht.Bo),s)}}function hn(t){if(!fs(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{Bo:Math.round(i.getTime()/1e3),Vo:t}}function ln(t){if(!ps(t))throw new Error("time must be of type isUTCTimestamp");return{Bo:t}}function an(t){return 0===t.length?null:fs(t[0].time)?hn:ln}function on(t){return ps(t)?ln(t):fs(t)?hn(t):hn(_n(t))}function _n(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function un(t){S(t.time)&&(t.time=_n(t.time))}function cn(t){return{bn:0,Im:new Map,Zh:t}}function dn(t){if(void 0!==t&&0!==t.length)return{Nm:t[0].ht.Bo,Rm:t[t.length-1].ht.Bo}}function fn(t){let i;return t.forEach((t=>{void 0===i&&(i=t.Ko)})),h(i)}function pn(t){void 0===t.Ko&&(t.Ko=t.time)}class vn{constructor(){this.Am=new Map,this.Lm=new Map,this.Vm=new Map,this.Bm=[]}S(){this.Am.clear(),this.Lm.clear(),this.Vm.clear(),this.Bm=[]}Fm(t,i){let s=0!==this.Am.size,n=!1;const e=this.Lm.get(t);if(void 0!==e)if(1===this.Lm.size)s=!1,n=!0,this.Am.clear();else for(const i of this.Bm)i.pointData.Im.delete(t)&&(n=!0);let r=[];if(0!==i.length){const s=i;s.forEach((t=>pn(t))),function(t){t.forEach(un)}(i);const e=l(an(i)),h=Js(t.Kr());r=s.map((i=>{const s=e(i.time);let r=this.Am.get(s.Bo);void 0===r&&(r=cn(s),this.Am.set(s.Bo,r),n=!0);const l=h(s,r.bn,i,i.Ko);return r.Im.set(t,l),l}))}s&&this.zm(),this.Wm(t,r);let h=-1;if(n){const t=[];this.Am.forEach((i=>{t.push({Yo:0,ht:i.Zh,pointData:i,Ko:fn(i.Im)})})),t.sort(((t,i)=>t.ht.Bo-i.ht.Bo)),h=this.jm(t)}return this.$m(t,h,function(t,i){const s=dn(t),n=dn(i);if(void 0!==s&&void 0!==n)return{$h:s.Rm>=n.Rm&&s.Nm>=n.Nm}}(this.Lm.get(t),e))}Yu(t){return this.Fm(t,[])}Hm(t,i){const s=i;pn(s),un(i);const n=l(an([i]))(i.time),e=this.Vm.get(t);if(void 0!==e&&n.Bo<e.Bo)throw new Error(`Cannot update oldest data, last time=${e.Bo}, new time=${n.Bo}`);let r=this.Am.get(n.Bo);const h=void 0===r;void 0===r&&(r=cn(n),this.Am.set(n.Bo,r));const a=Js(t.Kr())(n,r.bn,i,s.Ko);r.Im.set(t,a),this.Um(t,a);const o={$h:Ks(a)};if(!h)return this.$m(t,-1,o);const _={Yo:0,ht:r.Zh,pointData:r,Ko:fn(r.Im)},u=dt(this.Bm,_.ht.Bo,((t,i)=>t.ht.Bo<i));this.Bm.splice(u,0,_);for(let t=u;t<this.Bm.length;++t)mn(this.Bm[t].pointData,t);return rn(this.Bm,u),this.$m(t,u,o)}Um(t,i){let s=this.Lm.get(t);void 0===s&&(s=[],this.Lm.set(t,s));const n=0!==s.length?s[s.length-1]:null;null===n||i.ht.Bo>n.ht.Bo?Ks(i)&&s.push(i):Ks(i)?s[s.length-1]=i:s.splice(-1,1),this.Vm.set(t,i.ht)}Wm(t,i){0!==i.length?(this.Lm.set(t,i.filter(Ks)),this.Vm.set(t,i[i.length-1].ht)):(this.Lm.delete(t),this.Vm.delete(t))}zm(){for(const t of this.Bm)0===t.pointData.Im.size&&this.Am.delete(t.ht.Bo)}jm(t){let i=-1;for(let s=0;s<this.Bm.length&&s<t.length;++s){const n=this.Bm[s],e=t[s];if(n.ht.Bo!==e.ht.Bo){i=s;break}e.Yo=n.Yo,mn(e.pointData,s)}if(-1===i&&this.Bm.length!==t.length&&(i=Math.min(this.Bm.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)mn(t[s].pointData,s);return rn(t,i),this.Bm=t,i}qm(){if(0===this.Lm.size)return null;let t=0;return this.Lm.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].bn))})),t}$m(t,i,s){const n={Ym:new Map,St:{O_:this.qm()}};if(-1!==i)this.Lm.forEach(((i,e)=>{n.Ym.set(e,{Te:i,Xm:e===t?s:void 0})})),this.Lm.has(t)||n.Ym.set(t,{Te:[],Xm:s}),n.St.Km=this.Bm,n.St.Zm=i;else{const i=this.Lm.get(t);n.Ym.set(t,{Te:i||[],Xm:s})}return n}}function mn(t,i){t.bn=i,t.Im.forEach((t=>{t.bn=i}))}function wn(t){return{value:t.Dt[3],time:t.Ko}}function bn(t){const i=wn(t);return void 0!==t.I&&(i.color=t.I),i}function gn(t){return{open:t.Dt[0],high:t.Dt[1],low:t.Dt[2],close:t.Dt[3],time:t.Ko}}const Mn={Area:wn,Line:bn,Baseline:wn,Histogram:bn,Bar:function(t){const i=gn(t);return void 0!==t.I&&(i.color=t.I),i},Candlestick:function(t){const i=gn(t),{I:s,Et:n,Jn:e}=t;return void 0!==s&&(i.color=s),void 0!==n&&(i.borderColor=n),void 0!==e&&(i.wickColor=e),i}};function Sn(t){return Mn[t]}const yn={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class kn{constructor(t){this.Fr=t}applyOptions(t){this.Fr.Hr(t)}options(){return this.Fr.F()}Gm(){return this.Fr}}class xn{constructor(t,i,s){this.sn=t,this.Jm=i,this.Qm=s}priceFormatter(){return this.sn.nl()}priceToCoordinate(t){const i=this.sn.xt();return null===i?null:this.sn.Pt().Tt(t,i.Dt)}coordinateToPrice(t){const i=this.sn.xt();return null===i?null:this.sn.Pt().Yi(t,i.Dt)}barsInLogicalRange(t){if(null===t)return null;const i=new ss(new Qi(t.from,t.to)).t_(),s=this.sn.fs();if(s.bi())return null;const n=s.uh(i.Xs(),1),e=s.uh(i.Ks(),-1),r=l(s.ah()),h=l(s.ds());if(null!==n&&null!==e&&n.bn>e.bn)return{barsBefore:t.from-r,barsAfter:h-t.to};const a={barsBefore:null===n||n.bn===r?t.from-r:n.bn-r,barsAfter:null===e||e.bn===h?h-t.to:h-e.bn};return null!==n&&null!==e&&(a.from=n.ht.Vo||n.ht.Bo,a.to=e.ht.Vo||e.ht.Bo),a}setData(t){this.sn.Kr(),this.Jm.tw(this.sn,t)}update(t){this.sn.Kr(),this.Jm.iw(this.sn,t)}dataByIndex(t,i){const s=this.sn.fs().uh(t,i);return null===s?null:Sn(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:on(t.time)})));this.sn.Uh(i)}markers(){return this.sn.qh().map((t=>{const{originalTime:i,time:s}=t,n=function(t,i){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(n=Object.getOwnPropertySymbols(t);e<n.length;e++)i.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(t,n[e])&&(s[n[e]]=t[n[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},n)}))}applyOptions(t){this.sn.Hr(t)}options(){return k(this.sn.F())}priceScale(){return this.Qm.priceScale(this.sn.Pt().al())}createPriceLine(t){const i=b(k(yn),t),s=this.sn.Yh(i);return new kn(s)}removePriceLine(t){this.sn.Xh(t.Gm())}seriesType(){return this.sn.Kr()}}class Cn extends xn{applyOptions(t){ds(t),super.applyOptions(t)}}const Tn={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#efefef",entireTextOnly:!1,visible:!1,ticksVisible:!0,scaleMargins:{bottom:.1,top:.2}},Pn={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:T,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},Dn={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:T},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Tn),leftPriceScale:Object.assign(Object.assign({},Tn),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Tn),{visible:!0}),nonPrimaryPriceScale:Object.assign(Object.assign({},Tn),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!0},watermark:Pn,localization:{locale:Ms?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},En={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},On={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},In={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Nn={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Rn={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},An={color:"#26a69a",base:0},Ln={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Vn{constructor(t,i){this.vf=t,this.sw=i}applyOptions(t){this.vf.$t().Bu(this.sw,t)}options(){return this.mi().F()}width(){return G(this.sw)?this.vf.gm(this.sw):0}mi(){return l(this.vf.$t().Fu(this.sw)).Pt}}class Bn{constructor(t,i){this.nw=new w,this.__=new w,this.Nv=new w,this.yi=t,this.za=t.St(),this.am=i,this.za.X_().l(this.ew.bind(this)),this.za.K_().l(this.rw.bind(this)),this.am.Wv().l(this.hw.bind(this))}S(){this.za.X_().v(this),this.za.K_().v(this),this.am.Wv().v(this),this.nw.S(),this.__.S(),this.Nv.S()}scrollPosition(){return this.za.L_()}scrollToPosition(t,i){i?this.za.Y_(t,1e3):this.yi.Ds(t)}scrollToRealTime(){this.za.q_()}getVisibleRange(){var t,i;const s=this.za.k_();return null===s?null:{from:null!==(t=s.from.Vo)&&void 0!==t?t:s.from.Bo,to:null!==(i=s.to.Vo)&&void 0!==i?i:s.to.Bo}}setVisibleRange(t){const i={from:on(t.from),to:on(t.to)},s=this.za.P_(i);this.yi.cc(s)}getVisibleLogicalRange(){const t=this.za.y_();return null===t?null:{from:t.Xs(),to:t.Ks()}}setVisibleLogicalRange(t){r(t.from<=t.to,"The from index cannot be after the to index."),this.yi.cc(t)}resetTimeScale(){this.yi.Ts()}fitContent(){this.yi.J_()}logicalToCoordinate(t){const i=this.yi.St();return i.bi()?null:i.It(t)}coordinateToLogical(t){return this.za.bi()?null:this.za.I_(t)}timeToCoordinate(t){const i=on(t),s=this.za._l(i,!1);return null===s?null:this.za.It(s)}coordinateToTime(t){var i;const s=this.yi.St(),n=s.I_(t),e=s.Xi(n);return null===e?null:null!==(i=e.Vo)&&void 0!==i?i:e.Bo}width(){return this.am.Of().Lt}height(){return this.am.Of().Vt}subscribeVisibleTimeRangeChange(t){this.nw.l(t)}unsubscribeVisibleTimeRangeChange(t){this.nw.p(t)}subscribeVisibleLogicalRangeChange(t){this.__.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.__.p(t)}subscribeSizeChange(t){this.Nv.l(t)}unsubscribeSizeChange(t){this.Nv.p(t)}applyOptions(t){this.za.Hr(t)}options(){return k(this.za.F())}ew(){this.nw.M()&&this.nw.m(this.getVisibleRange())}rw(){this.__.M()&&this.__.m(this.getVisibleLogicalRange())}hw(t){this.Nv.m(t.Lt,t.Vt)}}function Fn(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function zn(t){return function(t){if(y(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&y(t.handleScale.axisPressedMouseMove)){const i=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:i,price:i}}const i=t.handleScroll;y(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Wn{constructor(t,i){this.lw=new vn,this.aw=new Map,this.ow=new Map,this._w=new w,this.uw=new w;const s=void 0===i?k(Dn):b(k(Dn),zn(i));this.vf=new qs(t,s),this.vf._v().l((t=>{this._w.M()&&this._w.m(this.cw(t()))}),this),this.vf.$u().l((t=>{this.uw.M()&&this.uw.m(this.cw(t()))}),this);const n=this.vf.$t();this.dw=new Bn(n,this.vf.dm())}remove(){this.vf._v().v(this),this.vf.$u().v(this),this.dw.S(),this.vf.S(),this.aw.clear(),this.ow.clear(),this._w.S(),this.uw.S(),this.lw.S()}resize(t,i,s){this.vf.om(t,i,s)}addAreaSeries(t={}){Fn(t.priceFormat);const i=b(k(Ln),Nn,t),s=this.vf.$t()._c("Area",i),n=new xn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addBaselineSeries(t={}){Fn(t.priceFormat);const i=b(k(Ln),k(Rn),t),s=this.vf.$t()._c("Baseline",i),n=new xn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addBarSeries(t={}){Fn(t.priceFormat);const i=b(k(Ln),On,t),s=this.vf.$t()._c("Bar",i),n=new xn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addCandlestickSeries(t={}){ds(t),Fn(t.priceFormat);const i=b(k(Ln),En,t),s=this.vf.$t()._c("Candlestick",i),n=new Cn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addHistogramSeries(t={}){Fn(t.priceFormat);const i=b(k(Ln),An,t),s=this.vf.$t()._c("Histogram",i),n=new xn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addLineSeries(t={}){Fn(t.priceFormat);const i=b(k(Ln),In,t),s=this.vf.$t()._c("Line",i),n=new xn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}removeSeries(t){const i=h(this.aw.get(t)),s=this.lw.Yu(i);this.vf.$t().Yu(i),this.fw(s),this.aw.delete(t),this.ow.delete(i)}tw(t,i){this.fw(this.lw.Fm(t,i))}iw(t,i){this.fw(this.lw.Hm(t,i))}subscribeClick(t){this._w.l(t)}unsubscribeClick(t){this._w.p(t)}subscribeCrosshairMove(t){this.uw.l(t)}unsubscribeCrosshairMove(t){this.uw.p(t)}priceScale(t){return new Vn(this.vf,t)}timeScale(){return this.dw}applyOptions(t){this.vf.Hr(zn(t))}options(){return this.vf.F()}takeScreenshot(){return this.vf.vm()}removePane(t){this.vf.$t().qu(t)}swapPane(t,i){this.vf.$t().Xu(t,i)}getPaneElements(){return this.vf.wf().map((t=>t.Mv()))}fw(t){const i=this.vf.$t();i.ac(t.St.O_,t.St.Km,t.St.Zm),t.Ym.forEach(((t,i)=>i.G(t.Te,t.Xm))),i.R_()}pw(t){return h(this.ow.get(t))}cw(t){const i=new Map;t.Dm.forEach(((t,s)=>{const n=Sn(s.Kr())(t);r(function(t){return void 0!==t.open||void 0!==t.value}(n)),i.set(this.pw(s),n)}));const s=void 0===t.Pm?void 0:this.pw(t.Pm);return{time:t.ht,logical:t.bn,point:t.Tm,paneIndex:t.hc,hoveredSeries:s,hoveredMarkerId:t.Em,seriesData:i}}}function jn(t,i){let s;if(S(t)){const i=document.getElementById(t);r(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new Wn(s,i)}function $n(){return"4.0.0"}export{ls as ColorType,K as CrosshairMode,rs as LastPriceAnimationMode,s as LineStyle,i as LineType,bi as MismatchDirection,hs as PriceLineSource,Wi as PriceScaleMode,ns as TickMarkType,es as TrackingModeExitMode,jn as createChart,fs as isBusinessDay,ps as isUTCTimestamp,$n as version};
