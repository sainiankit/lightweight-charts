/*!
 * @license
 * TradingView Lightweight Charts v4.0.0
 * Copyright (c) 2022 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function s(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function n(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(n,i+e),t.stroke()}function e(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function r(t){if(void 0===t)throw new Error("Value is undefined");return t}function h(t){if(null===t)throw new Error("Value is null");return t}function l(t){return h(r(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));const a={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function o(t){return t<0?0:t>255?255:Math.round(t)||0}function _(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const u=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,c=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,d=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,f=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function p(t){(t=t.toLowerCase())in a&&(t=a[t]);{const i=f.exec(t)||d.exec(t);if(i)return[o(parseInt(i[1],10)),o(parseInt(i[2],10)),o(parseInt(i[3],10)),_(i.length<5?1:parseFloat(i[4]))]}{const i=c.exec(t);if(i)return[o(parseInt(i[1],16)),o(parseInt(i[2],16)),o(parseInt(i[3],16)),1]}{const i=u.exec(t);if(i)return[o(17*parseInt(i[1],16)),o(17*parseInt(i[2],16)),o(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function v(t){const i=p(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class m{constructor(){this.h=[]}l(t,i,s){const n={o:t,_:i,u:!0===s};this.h.push(n)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}M(){return this.h.length>0}S(){this.h=[]}}function w(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:w(t[i],s[i]));return t}function g(t){return"number"==typeof t&&isFinite(t)}function b(t){return"number"==typeof t&&t%1==0}function M(t){return"string"==typeof t}function S(t){return"boolean"==typeof t}function y(t){const i=t;if(!i||"object"!=typeof i)return i;let s,n,e;for(n in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(n)&&(e=i[n],s[n]=e&&"object"==typeof e?y(e):e);return s}function k(t){return null!==t}function x(t){return null===t?void 0:t}const T="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function C(t,i,s){return void 0===i&&(i=T),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class P{constructor(t){this.k={T:1,C:4,P:NaN,D:"",O:"",N:"",R:0,A:0,I:0,L:0,V:0},this.B=t}F(){const t=this.k,i=this.W(),s=this.j();return t.P===i&&t.O===s||(t.P=i,t.O=s,t.D=C(i,s),t.L=Math.floor(i/3.5),t.R=t.L,t.A=Math.max(Math.ceil(i/2-t.C/2),0),t.I=Math.ceil(i/2+t.C/2),t.V=Math.round(i/10)),t.N=this.$(),this.k}$(){return this.B.F().layout.textColor}W(){return this.B.F().layout.fontSize}j(){return this.B.F().layout.fontFamily}}class D{constructor(){this.H=[]}U(t){this.H=t}q(t,i,s,n){this.H.forEach((e=>{t.save(),e.q(t,i,s,n),t.restore()}))}}class E{q(t,i,s,n){t.save(),t.scale(i,i),this.Y(t,s,n),t.restore()}X(t,i,s,n){t.save(),t.scale(i,i),this.K(t,s,n),t.restore()}K(t,i,s){}}class O extends E{constructor(){super(...arguments),this.Z=null}G(t){this.Z=t}Y(t){if(null===this.Z||null===this.Z.J)return;const i=this.Z.J,s=this.Z,n=n=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.tt[e];t.moveTo(i.it,i.st),t.arc(i.it,i.st,n,0,2*Math.PI)}t.fill()};t.fillStyle=s.nt,n(s.et+2),t.fillStyle=s.rt,n(s.et)}}function N(){return{tt:[{it:0,st:0,ht:0,lt:0}],rt:"",nt:"",et:0,J:null}}const R={from:0,to:1};class A{constructor(t,i){this.ot=new D,this._t=[],this.ut=[],this.ct=new Map,this.B=t,this.dt=i,this.ot.U(this._t)}ft(t){const i=this.B.vt();i.length!==this._t.length&&(this.ut=i.map(N),this._t=this.ut.map((t=>{const i=new O;return i.G(t),i})),this.ot.U(this._t)),this.ct.clear()}wt(t,i,s,n){let e=this.ct.get(s);if(!e){e=this.gt(s,t),this.ct.set(s,e);const i=new D;return i.U(e),i}const r=new D;return r.U(e),r}gt(t,i){const s=this.B.vt().map(((t,i)=>[t,i])).filter((i=>t.bt().includes(i[0]))),n=this.dt.Mt(),e=this.B.St();return s.map((([t,s])=>{var r;const l=this.ut[s],a=t.yt(n);if(null!==a&&t.kt()){const s=h(t.xt());l.rt=a.Tt,l.et=a.et,l.tt[0].lt=a.lt,l.tt[0].st=t.Pt().Ct(a.lt,s.Dt),l.nt=null!==(r=a.Et)&&void 0!==r?r:this.B.Ot(l.tt[0].st/i),l.tt[0].ht=n,l.tt[0].it=e.Nt(n),l.J=R}else l.J=null;return this._t[s]}))}}class I{constructor(t){this.Rt=t}q(t,i,e,r){if(null===this.Rt)return;const h=this.Rt.At.kt,l=this.Rt.It.kt;if(!h&&!l)return;t.save();const a=Math.round(this.Rt.it*i),o=Math.round(this.Rt.st*i),_=Math.ceil(this.Rt.Lt*i),u=Math.ceil(this.Rt.Vt*i);t.lineCap="butt",h&&a>=0&&(t.lineWidth=Math.floor(this.Rt.At.Bt*i),t.strokeStyle=this.Rt.At.N,t.fillStyle=this.Rt.At.N,s(t,this.Rt.At.Ft),function(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,s),t.lineTo(i+e,n),t.stroke()}(t,a,0,u)),l&&o>=0&&(t.lineWidth=Math.floor(this.Rt.It.Bt*i),t.strokeStyle=this.Rt.It.N,t.fillStyle=this.Rt.It.N,s(t,this.Rt.It.Ft),n(t,o,0,_)),t.restore()}}class L{constructor(t){this.ct=new Map,this.zt={At:{Bt:1,Ft:0,N:"",kt:!1},It:{Bt:1,Ft:0,N:"",kt:!1},Lt:0,Vt:0,it:0,st:0},this.Wt=new I(this.zt),this.jt=t}ft(){this.ct.clear()}wt(t,i,s){return this.gt(s),this.Wt}gt(t){const i=this.jt.kt(),s=h(this.jt.Ht()).$t().F().crosshair,n=this.zt;n.It.kt=i&&this.jt.Ut(t),n.At.kt=i&&this.jt.qt(),n.It.Bt=s.horzLine.width,n.It.Ft=s.horzLine.style,n.It.N=s.horzLine.color,n.At.Bt=s.vertLine.width,n.At.Ft=s.vertLine.style,n.At.N=s.vertLine.color,n.Lt=t.Yt(),n.Vt=t.Xt(),n.it=this.jt.Kt(),n.st=this.jt.Zt()}}function V(t,i,s,n,e,r){t.fillRect(i+r,s,n-2*r,r),t.fillRect(i+r,s+e-r,n-2*r,r),t.fillRect(i,s,r,e),t.fillRect(i+n-r,s,r,e)}function B(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function F(t,i,s,n,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,s,n,e),t.restore()}function z(t,i,s,n,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,s,n,e),t.restore()}class W{constructor(t,i){this.G(t,i)}G(t,i){this.Rt=t,this.Gt=i}q(t,i,s,n,e,r){if(!this.Rt.kt)return;t.font=i.D;const h=this.Rt.Jt||!this.Rt.Qt?i.C:0,l=i.T,a=i.L,o=i.R,_=i.A,u=i.I,c=this.Rt.ti,d=Math.ceil(s.ii(t,c)),f=i.V,p=i.P+a+o,v=Math.ceil(.5*p),m=l+d+_+u+h;let w=this.Gt.si;this.Gt.ni&&(w=this.Gt.ni),w=Math.round(w);const g=w-v,b=g+p,M="right"===e,S=M?n:0,y=Math.ceil(n*r);let k,x,T=S;if(t.fillStyle=this.Gt.t,t.lineWidth=1,t.lineCap="butt",c){M?(T=S-m,k=S-h,x=T+u):(T=S+m,k=S+h,x=S+l+h+_);const i=Math.max(1,Math.floor(r)),s=Math.max(1,Math.floor(l*r)),n=M?y:0,e=Math.round(g*r),a=Math.round(T*r),d=Math.round(w*r)-Math.floor(.5*r),p=d+i+(d-e),v=Math.round(k*r);t.save(),t.beginPath(),t.moveTo(n,e),t.lineTo(a,e),t.lineTo(a,p),t.lineTo(n,p),t.fill(),t.fillStyle=this.Rt.Et,t.fillRect(M?y-s:0,e,s,p-e),this.Rt.Jt&&(t.fillStyle=this.Gt.N,t.fillRect(n,d,v-n,i)),t.textAlign="left",t.fillStyle=this.Gt.N,B(t,r,(()=>{t.fillText(c,x,b-o-f)})),t.restore()}}Xt(t,i){return this.Rt.kt?t.P+t.L+t.R:0}}class j{constructor(t){this.ei={si:0,N:"#FFF",t:"#000"},this.ri={ti:"",kt:!1,Jt:!0,Qt:!1,Et:""},this.hi={ti:"",kt:!1,Jt:!1,Qt:!0,Et:""},this.li=!0,this.ai=new(t||W)(this.ri,this.ei),this.oi=new(t||W)(this.hi,this.ei)}ti(){return this._i(),this.ri.ti}si(){return this._i(),this.ei.si}ft(){this.li=!0}Xt(t,i=!1){return Math.max(this.ai.Xt(t,i),this.oi.Xt(t,i))}ui(){return this.ei.ni||0}ci(t){this.ei.ni=t}di(){return this._i(),this.ri.kt||this.hi.kt}fi(){return this._i(),this.ri.kt}wt(t){return this._i(),this.ri.Jt=this.ri.Jt&&t.F().ticksVisible,this.hi.Jt=this.hi.Jt&&t.F().ticksVisible,this.ai.G(this.ri,this.ei),this.oi.G(this.hi,this.ei),this.ai}pi(){return this._i(),this.ai.G(this.ri,this.ei),this.oi.G(this.hi,this.ei),this.oi}_i(){this.li&&(this.ri.Jt=!0,this.hi.Jt=!1,this.vi(this.ri,this.hi,this.ei))}}class $ extends j{constructor(t,i,s){super(),this.jt=t,this.mi=i,this.wi=s}vi(t,i,s){t.kt=!1;const n=this.jt.F().horzLine;if(!n.labelVisible)return;const e=this.mi.xt();if(!this.jt.kt()||this.mi.gi()||null===e)return;const r=v(n.labelBackgroundColor);s.t=r.t,s.N=r.i;const h=this.wi(this.mi);s.si=h.si,t.ti=this.mi.bi(h.lt,e),t.kt=!0}}const H=/[1-9]/g;class U{constructor(){this.Rt=null}G(t){this.Rt=t}q(t,i,s){if(null===this.Rt||!1===this.Rt.kt||0===this.Rt.ti.length)return;t.font=i.D;const n=Math.round(i.Mi.ii(t,this.Rt.ti,H));if(n<=0)return;t.save();const e=i.Si,r=n+2*e,l=r/2,a=this.Rt.Yt;let o=this.Rt.si,_=Math.floor(o-l)+.5;_<0?(o+=Math.abs(0-_),_=Math.floor(o-l)+.5):_+r>a&&(o-=Math.abs(a-(_+r)),_=Math.floor(o-l)+.5);const u=_+r,c=0+i.T+i.L+i.P+i.R;t.fillStyle=this.Rt.t;const d=Math.round(_*s),f=Math.round(0*s),p=Math.round(u*s),v=Math.round(c*s);if(t.fillRect(d,f,p-d,v-f),this.Rt.Jt){const n=Math.round(this.Rt.si*s),e=f,r=Math.round((e+i.T+i.C)*s);t.fillStyle=this.Rt.N;const h=Math.max(1,Math.floor(s)),l=Math.floor(.5*s);t.fillRect(n-l,e,h,r-e)}const m=c-i.V-i.R;t.textAlign="left",t.fillStyle=this.Rt.N,B(t,s,(()=>{t.fillText(h(this.Rt).ti,_+e,m)})),t.restore()}}class q{constructor(t,i,s){this.li=!0,this.Wt=new U,this.zt={kt:!1,t:"#4c525e",N:"white",ti:"",Yt:0,si:NaN,Jt:!0},this.dt=t,this.yi=i,this.wi=s}ft(){this.li=!0}wt(){return this.li&&(this.gt(),this.li=!1),this.Wt.G(this.zt),this.Wt}gt(){const t=this.zt;t.kt=!1;const i=this.dt.F().vertLine;if(!i.labelVisible)return;const s=this.yi.St();if(s.gi())return;t.Yt=s.Yt();const n=this.wi();if(!n.ht)return;t.si=n.si;const e=s.ki(this.dt.Mt());t.ti=s.xi(h(e)),t.kt=!0;const r=v(i.labelBackgroundColor);t.t=r.t,t.N=r.i,t.Jt=s.F().ticksVisible}}class Y{constructor(){this.Ti=null,this.Ci=0}Pi(){return this.Ci}Di(t){this.Ci=t}Pt(){return this.Ti}Ei(t){this.Ti=t}Oi(t){return[]}Ni(){return[]}kt(){return!0}}var X;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(X||(X={}));class K extends Y{constructor(t,i){super(),this.Ri=null,this.Ai=NaN,this.Ii=0,this.Li=!0,this.Vi=new Map,this.Bi=!1,this.Fi=NaN,this.zi=NaN,this.Wi=NaN,this.ji=NaN,this.yi=t,this.$i=i,this.Hi=new A(t,this);this.Ui=((t,i)=>s=>{const n=i(),e=t();if(s===h(this.Ri).qi())return{lt:e,si:n};{const t=h(s.xt());return{lt:s.Yi(n,t),si:n}}})((()=>this.Ai),(()=>this.zi));const s=((t,i)=>()=>({ht:this.yi.St().Xi(t()),si:i()}))((()=>this.Ii),(()=>this.Kt()));this.Ki=new q(this,t,s),this.Zi=new L(this)}F(){return this.$i}Gi(t,i){this.Wi=t,this.ji=i}Ji(){this.Wi=NaN,this.ji=NaN}Qi(){return this.Wi}ts(){return this.ji}ss(t,i,s){this.Bi||(this.Bi=!0),this.Li=!0,this.ns(t,i,s)}Mt(){return this.Ii}Kt(){return this.Fi}Zt(){return this.zi}kt(){return this.Li}es(){this.Li=!1,this.rs(),this.Ai=NaN,this.Fi=NaN,this.zi=NaN,this.Ri=null,this.Ji()}hs(t){return null!==this.Ri?[this.Zi,this.Hi]:[]}Ut(t){return t===this.Ri&&this.$i.horzLine.visible}qt(){return this.$i.vertLine.visible}ls(t,i){this.Li&&this.Ri===t||this.Vi.clear();const s=[];return this.Ri===t&&s.push(this.os(this.Vi,i,this.Ui)),s}Ni(){return this.Li?[this.Ki]:[]}Ht(){return this.Ri}_s(){this.Zi.ft(),this.Vi.forEach((t=>t.ft())),this.Ki.ft(),this.Hi.ft()}us(t){return t&&!t.qi().gi()?t.qi():null}ns(t,i,s){this.cs(t,i,s)&&this._s()}cs(t,i,s){const n=this.Fi,e=this.zi,r=this.Ai,h=this.Ii,l=this.Ri,a=this.us(s);this.Ii=t,this.Fi=isNaN(t)?NaN:this.yi.St().Nt(t),this.Ri=s;const o=null!==a?a.xt():null;return null!==a&&null!==o?(this.Ai=i,this.zi=a.Ct(i,o)):(this.Ai=NaN,this.zi=NaN),n!==this.Fi||e!==this.zi||h!==this.Ii||r!==this.Ai||l!==this.Ri}rs(){const t=this.yi.vt().map((t=>t.fs().ds())).filter(k),i=0===t.length?null:Math.max(...t);this.Ii=null!==i?i:NaN}os(t,i,s){let n=t.get(i);return void 0===n&&(n=new $(this,i,s),t.set(i,n)),n}}function Z(t){return"left"===t||"right"===t}class G{constructor(t){this.ps=new Map,this.vs=[],this.ws=t}gs(t,i){const s=function(t,i){return void 0===t?i:{bs:Math.max(t.bs,i.bs),Ms:t.Ms||i.Ms}}(this.ps.get(t),i);this.ps.set(t,s)}Ss(){return this.ws}ys(t){const i=this.ps.get(t);return void 0===i?{bs:this.ws}:{bs:Math.max(this.ws,i.bs),Ms:i.Ms}}ks(){this.vs=[{xs:0}]}Ts(t){this.vs=[{xs:1,Dt:t}]}Cs(){this.vs=[{xs:4}]}Ps(t){this.vs.push({xs:2,Dt:t})}Ds(t){this.vs.push({xs:3,Dt:t})}Es(){return this.vs}Os(t){for(const i of t.vs)this.Ns(i);this.ws=Math.max(this.ws,t.ws),t.ps.forEach(((t,i)=>{this.gs(i,t)}))}Ns(t){switch(t.xs){case 0:this.ks();break;case 1:this.Ts(t.Dt);break;case 2:this.Ps(t.Dt);break;case 3:this.Ds(t.Dt);break;case 4:this.Cs()}}}const J=".";function Q(t,i){if(!g(t))return"n/a";if(!b(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class tt{constructor(t,i){if(i||(i=1),g(t)&&b(t)||(t=100),t<0)throw new TypeError("invalid base");this.mi=t,this.Rs=i,this.As()}format(t){const i=t<0?"âˆ’":"";return t=Math.abs(t),i+this.Is(t)}As(){if(this.Ls=0,this.mi>0&&this.Rs>0){let t=this.mi;for(;t>1;)t/=10,this.Ls++}}Is(t){const i=this.mi/this.Rs;let s=Math.floor(t),n="";const e=void 0!==this.Ls?this.Ls:NaN;if(i>1){let r=+(Math.round(t*i)-s*i).toFixed(this.Ls);r>=i&&(r-=i,s+=1),n=J+Q(+r.toFixed(this.Ls)*this.Rs,e)}else s=Math.round(s*i)/i,e>0&&(n=J+Q(0,e));return s.toFixed(0)+n}}class it extends tt{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class st{constructor(t){this.Vs=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.Bs(t):t<999995?i+this.Bs(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.Bs(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.Bs(t/1e9)+"B")}Bs(t){let i;const s=Math.pow(10,this.Vs);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.Vs).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function nt(t,i,s,n){if(0===i.length)return;const e=i[n.from].it,r=i[n.from].st;t.moveTo(e,r);for(let e=n.from+1;e<n.to;++e){const n=i[e];switch(s){case 0:t.lineTo(n.it,n.st);break;case 1:t.lineTo(n.it,i[e-1].st),t.lineTo(n.it,n.st);break;case 2:{const[s,r]=lt(i,e-1,e);t.bezierCurveTo(s.it,s.st,r.it,r.st,n.it,n.st);break}}}}const et=6;function rt(t,i){return{it:t.it-i.it,st:t.st-i.st}}function ht(t,i){return{it:t.it/i,st:t.st/i}}function lt(t,i,s){const n=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var r,h;return[(r=t[i],h=ht(rt(t[s],t[n]),et),{it:r.it+h.it,st:r.st+h.st}),rt(t[s],ht(rt(t[e],t[i]),et))]}class at extends E{constructor(){super(...arguments),this.Z=null}G(t){this.Z=t}Y(t){if(null!==this.Z&&0!==this.Z.tt.length&&null!==this.Z.J){if(t.lineCap="butt",t.lineJoin="round",t.lineWidth=this.Z.Bt,s(t,this.Z.Ft),t.lineWidth=1,t.beginPath(),1===this.Z.tt.length){const i=this.Z.tt[0],s=this.Z.Fs/2;t.moveTo(i.it-s,this.Z.zs),t.lineTo(i.it-s,i.st),t.lineTo(i.it+s,i.st),t.lineTo(i.it+s,this.Z.zs)}else t.moveTo(this.Z.tt[this.Z.J.from].it,this.Z.zs),t.lineTo(this.Z.tt[this.Z.J.from].it,this.Z.tt[this.Z.J.from].st),nt(t,this.Z.tt,this.Z.Ws,this.Z.J),this.Z.J.to>this.Z.J.from&&(t.lineTo(this.Z.tt[this.Z.J.to-1].it,this.Z.zs),t.lineTo(this.Z.tt[this.Z.J.from].it,this.Z.zs));t.closePath(),t.fillStyle=this.js(t),t.fill()}}}class ot extends at{js(t){const i=this.Z,s=t.createLinearGradient(0,0,0,i.$s);return s.addColorStop(0,i.Hs),s.addColorStop(1,i.Us),s}}class _t extends E{constructor(){super(...arguments),this.Z=null}G(t){this.Z=t}Y(t){if(null!==this.Z&&0!==this.Z.tt.length&&null!==this.Z.J)if(t.lineCap="butt",t.lineWidth=this.Z.Bt,s(t,this.Z.Ft),t.strokeStyle=this.qs(t),t.lineJoin="round",1===this.Z.tt.length){t.beginPath();const i=this.Z.tt[0];t.moveTo(i.it-this.Z.Fs/2,i.st),t.lineTo(i.it+this.Z.Fs/2,i.st),void 0!==i.N&&(t.strokeStyle=i.N),t.stroke()}else this.Ys(t,this.Z)}Ys(t,i){t.beginPath(),nt(t,i.tt,i.Ws,i.J),t.stroke()}}class ut extends _t{Ys(t,i){var s,n;const{tt:e,J:r,Ws:h,rt:l}=i;if(0===e.length||null===r)return;t.beginPath();const a=e[r.from];t.moveTo(a.it,a.st);let o=null!==(s=a.N)&&void 0!==s?s:l;t.strokeStyle=o;const _=i=>{t.stroke(),t.beginPath(),t.strokeStyle=i,o=i};for(let i=r.from+1;i<r.to;++i){const s=e[i],r=null!==(n=s.N)&&void 0!==n?n:l;switch(h){case 0:t.lineTo(s.it,s.st);break;case 1:t.lineTo(s.it,e[i-1].st),r!==o&&(_(r),t.lineTo(s.it,e[i-1].st)),t.lineTo(s.it,s.st);break;case 2:{const[n,r]=lt(e,i-1,i);t.bezierCurveTo(n.it,n.st,r.it,r.st,s.it,s.st);break}}1!==h&&r!==o&&(_(r),t.moveTo(s.it,s.st))}t.stroke()}qs(){return this.Z.rt}}function ct(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(t[h],i)?(n=h+1,r-=e+1):r=e}return n}function dt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(i,t[h])?r=e:(n=h+1,r-=e+1)}return n}function ft(t,i){return t.ht<i}function pt(t,i){return t<i.ht}function vt(t,i,s){const n=i.Xs(),e=i.Ks(),r=ct(t,n,ft),h=dt(t,e,pt);if(!s)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r].ht>=n&&(l=r-1),h>0&&h<t.length&&t[h-1].ht<=e&&(a=h+1),{from:l,to:a}}class mt{constructor(t,i,s){this.Zs=!0,this.Gs=!0,this.Js=!0,this.Qs=[],this.tn=null,this.sn=t,this.nn=i,this.en=s}ft(t){this.Zs=!0,"data"===t&&(this.Gs=!0),"options"===t&&(this.Js=!0)}rn(){this.Gs&&(this.hn(),this.Gs=!1),this.Zs&&(this.ln(),this.Zs=!1),this.Js&&(this.an(),this.Js=!1)}on(){this.tn=null}ln(){const t=this.sn.Pt(),i=this.nn.St();if(this.on(),i.gi()||t.gi())return;const s=i._n();if(null===s)return;if(0===this.sn.fs().un())return;const n=this.sn.xt();null!==n&&(this.tn=vt(this.Qs,s,this.en),this.cn(t,i,n.Dt))}}class wt extends mt{constructor(t,i){super(t,i,!0)}cn(t,i,s){i.dn(this.Qs,x(this.tn)),t.fn(this.Qs,s,x(this.tn))}pn(t,i){return{ht:t,lt:i,it:NaN,st:NaN}}an(){}hn(){const t=this.sn.vn();this.Qs=this.sn.fs().mn().map((i=>{const s=i.Dt[3];return this.wn(i.gn,s,t)}))}}class gt extends wt{constructor(t,i){super(t,i),this.Wt=new D,this.bn=new ot,this.Mn=new ut,this.Wt.U([this.bn,this.Mn])}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.F();return this.rn(),this.bn.G({Ws:s.lineType,tt:this.Qs,Ft:s.lineStyle,Bt:s.lineWidth,Hs:s.topColor,Us:s.bottomColor,zs:t,$s:t,J:this.tn,Fs:this.nn.St().Sn()}),this.Mn.G({Ws:s.lineType,tt:this.Qs,rt:s.lineColor,Ft:s.lineStyle,Bt:s.lineWidth,J:this.tn,Fs:this.nn.St().Sn()}),this.Wt}wn(t,i){return this.pn(t,i)}}class bt{constructor(){this.Rt=null,this.yn=0,this.kn=0}G(t){this.Rt=t}q(t,i,s,n){if(null===this.Rt||0===this.Rt.fs.length||null===this.Rt.J)return;if(this.yn=this.xn(i),this.yn>=2){Math.max(1,Math.floor(i))%2!=this.yn%2&&this.yn--}this.kn=this.Rt.Tn?Math.min(this.yn,Math.floor(i)):this.yn;let e=null;const r=this.kn<=this.yn&&this.Rt.Sn>=Math.floor(1.5*i);for(let s=this.Rt.J.from;s<this.Rt.J.to;++s){const n=this.Rt.fs[s];e!==n.N&&(t.fillStyle=n.N,e=n.N);const h=Math.floor(.5*this.kn),l=Math.round(n.it*i),a=l-h,o=this.kn,_=a+o-1,u=Math.min(n.Cn,n.Pn),c=Math.max(n.Cn,n.Pn),d=Math.round(u*i)-h,f=Math.round(c*i)+h,p=Math.max(f-d,this.kn);t.fillRect(a,d,o,p);const v=Math.ceil(1.5*this.yn);if(r){if(this.Rt.Dn){const s=l-v;let e=Math.max(d,Math.round(n.En*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(s,e,a-s,r-e+1)}const s=l+v;let e=Math.max(d,Math.round(n.On*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(_+1,e,s-_,r-e+1)}}}xn(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(h(this.Rt).Sn,t)))}}class Mt extends mt{constructor(t,i){super(t,i,!1)}cn(t,i,s){i.dn(this.Qs,x(this.tn)),t.Nn(this.Qs,s,x(this.tn))}Rn(t,i,s){return{ht:t,An:i.Dt[0],In:i.Dt[1],Ln:i.Dt[2],Vn:i.Dt[3],it:NaN,En:NaN,Cn:NaN,Pn:NaN,On:NaN}}hn(){const t=this.sn.vn();this.Qs=this.sn.fs().mn().map((i=>this.wn(i.gn,i,t)))}}class St extends Mt{constructor(){super(...arguments),this.Wt=new bt}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.F();this.rn();const n={fs:this.Qs,Sn:this.nn.St().Sn(),Dn:s.openVisible,Tn:s.thinBars,J:this.tn};return this.Wt.G(n),this.Wt}an(){this.Qs.forEach((t=>{t.N=this.sn.vn().Fn(t.ht).Bn}))}wn(t,i,s){return Object.assign(Object.assign({},this.Rn(t,i,s)),{N:s.Fn(t).Bn})}}function yt(t,i,s){return Math.min(Math.max(t,i),s)}function kt(t,i,s){return i-t<=s}function xt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Tt(t){const i=Math.ceil(t);return i%2!=0?i-1:i}function Ct(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Pt extends at{js(t){const i=this.Z,s=t.createLinearGradient(0,0,0,i.$s),n=yt(i.zs/i.$s,0,1);return s.addColorStop(0,i.zn),s.addColorStop(n,i.Wn),s.addColorStop(n,i.jn),s.addColorStop(1,i.$n),s}}class Dt extends _t{qs(t){const i=this.Z,s=t.createLinearGradient(0,0,0,i.$s),n=yt(i.zs/i.$s,0,1);return s.addColorStop(0,i.Hs),s.addColorStop(n,i.Hs),s.addColorStop(n,i.Us),s.addColorStop(1,i.Us),s}}class Et extends wt{constructor(t,i){super(t,i),this.Hn=new Pt,this.Un=new Dt,this.ot=new D,this.ot.U([this.Hn,this.Un])}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.xt();if(null===s)return null;const n=this.sn.F();this.rn();const e=this.sn.Pt().Ct(n.baseValue.price,s.Dt),r=this.nn.St().Sn();return this.Hn.G({tt:this.Qs,zn:n.topFillColor1,Wn:n.topFillColor2,jn:n.bottomFillColor1,$n:n.bottomFillColor2,Bt:n.lineWidth,Ft:n.lineStyle,Ws:n.lineType,zs:e,$s:t,J:this.tn,Fs:r}),this.Un.G({tt:this.Qs,Hs:n.topLineColor,Us:n.bottomLineColor,Bt:n.lineWidth,Ft:n.lineStyle,Ws:n.lineType,zs:e,$s:t,J:this.tn,Fs:r}),this.ot}wn(t,i){return this.pn(t,i)}}class Ot{constructor(){this.Rt=null,this.yn=0}G(t){this.Rt=t}q(t,i,s,n){if(null===this.Rt||0===this.Rt.fs.length||null===this.Rt.J)return;if(this.yn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),n=Math.floor(t*s*i),e=Math.floor(t*i),r=Math.min(n,e);return Math.max(Math.floor(i),r)}(this.Rt.Sn,i),this.yn>=2){Math.floor(i)%2!=this.yn%2&&this.yn--}const e=this.Rt.fs;this.Rt.qn&&this.Yn(t,e,this.Rt.J,i),this.Rt.Xn&&this.Kn(t,e,this.Rt.J,this.Rt.Sn,i);const r=this.Zn(i);(!this.Rt.Xn||this.yn>2*r)&&this.Gn(t,e,this.Rt.J,i)}Yn(t,i,s,n){if(null===this.Rt)return;let e="",r=Math.min(Math.floor(n),Math.floor(this.Rt.Sn*n));r=Math.max(Math.floor(n),Math.min(r,this.yn));const h=Math.floor(.5*r);let l=null;for(let a=s.from;a<s.to;a++){const s=i[a];s.Jn!==e&&(t.fillStyle=s.Jn,e=s.Jn);const o=Math.round(Math.min(s.En,s.On)*n),_=Math.round(Math.max(s.En,s.On)*n),u=Math.round(s.Cn*n),c=Math.round(s.Pn*n);let d=Math.round(n*s.it)-h;const f=d+r-1;null!==l&&(d=Math.max(l+1,d),d=Math.min(d,f));const p=f-d+1;t.fillRect(d,u,p,o-u),t.fillRect(d,_+1,p,c-_),l=f}}Zn(t){let i=Math.floor(1*t);this.yn<=2*i&&(i=Math.floor(.5*(this.yn-1)));const s=Math.max(Math.floor(t),i);return this.yn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}Kn(t,i,s,n,e){if(null===this.Rt)return;let r="";const h=this.Zn(e);let l=null;for(let n=s.from;n<s.to;n++){const s=i[n];s.Et!==r&&(t.fillStyle=s.Et,r=s.Et);let a=Math.round(s.it*e)-Math.floor(.5*this.yn);const o=a+this.yn-1,_=Math.round(Math.min(s.En,s.On)*e),u=Math.round(Math.max(s.En,s.On)*e);if(null!==l&&(a=Math.max(l+1,a),a=Math.min(a,o)),this.Rt.Sn*e>2*h)V(t,a,_,o-a+1,u-_+1,h);else{const i=o-a+1;t.fillRect(a,_,i,u-_+1)}l=o}}Gn(t,i,s,n){if(null===this.Rt)return;let e="";const r=this.Zn(n);for(let h=s.from;h<s.to;h++){const s=i[h];let l=Math.round(Math.min(s.En,s.On)*n),a=Math.round(Math.max(s.En,s.On)*n),o=Math.round(s.it*n)-Math.floor(.5*this.yn),_=o+this.yn-1;if(s.N!==e){const i=s.N;t.fillStyle=i,e=i}this.Rt.Xn&&(o+=r,l+=r,_-=r,a-=r),l>a||t.fillRect(o,l,_-o+1,a-l+1)}}}class Nt extends Mt{constructor(){super(...arguments),this.Wt=new Ot}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.F();this.rn();const n={fs:this.Qs,Sn:this.nn.St().Sn(),qn:s.wickVisible,Xn:s.borderVisible,J:this.tn};return this.Wt.G(n),this.Wt}an(){this.Qs.forEach((t=>{const i=this.sn.vn().Fn(t.ht);t.N=i.Bn,t.Jn=i.Qn,t.Et=i.te}))}wn(t,i,s){const n=s.Fn(t);return Object.assign(Object.assign({},this.Rn(t,i,s)),{N:n.Bn,Jn:n.Qn,Et:n.te})}}class Rt{constructor(){this.Rt=null,this.ie=[]}G(t){this.Rt=t,this.ie=[]}q(t,i,s,n){if(null===this.Rt||0===this.Rt.tt.length||null===this.Rt.J)return;this.ie.length||this.se(i);const e=Math.max(1,Math.floor(i)),r=Math.round(this.Rt.ne*i)-Math.floor(e/2),h=r+e;for(let s=this.Rt.J.from;s<this.Rt.J.to;s++){const n=this.Rt.tt[s],l=this.ie[s-this.Rt.J.from],a=Math.round(n.st*i);let o,_;t.fillStyle=n.N,a<=r?(o=a,_=h):(o=r,_=a-Math.floor(e/2)+e),t.fillRect(l.Xs,o,l.Ks-l.Xs+1,_-o)}}se(t){if(null===this.Rt||0===this.Rt.tt.length||null===this.Rt.J)return void(this.ie=[]);const i=Math.ceil(this.Rt.Sn*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Rt.Sn*t)-i;this.ie=new Array(this.Rt.J.to-this.Rt.J.from);for(let i=this.Rt.J.from;i<this.Rt.J.to;i++){const n=this.Rt.tt[i],e=Math.round(n.it*t);let r,h;if(s%2){const t=(s-1)/2;r=e-t,h=e+t}else{const t=s/2;r=e-t,h=e+t-1}this.ie[i-this.Rt.J.from]={Xs:r,Ks:h,ee:e,re:n.it*t,ht:n.ht}}for(let t=this.Rt.J.from+1;t<this.Rt.J.to;t++){const s=this.ie[t-this.Rt.J.from],n=this.ie[t-this.Rt.J.from-1];s.ht===n.ht+1&&(s.Xs-n.Ks!==i+1&&(n.ee>n.re?n.Ks=s.Xs-i-1:s.Xs=n.Ks+i+1))}let n=Math.ceil(this.Rt.Sn*t);for(let t=this.Rt.J.from;t<this.Rt.J.to;t++){const i=this.ie[t-this.Rt.J.from];i.Ks<i.Xs&&(i.Ks=i.Xs);const s=i.Ks-i.Xs+1;n=Math.min(s,n)}if(i>0&&n<4)for(let t=this.Rt.J.from;t<this.Rt.J.to;t++){const i=this.ie[t-this.Rt.J.from];i.Ks-i.Xs+1>n&&(i.ee>i.re?i.Ks-=1:i.Xs+=1)}}}function At(t){return{tt:[],Sn:t,ne:NaN,J:null}}function It(t,i,s){return{ht:t,lt:i,it:NaN,st:NaN,N:s}}class Lt extends mt{constructor(t,i){super(t,i,!1),this.ot=new D,this.he=At(0),this.Wt=new Rt}wt(t,i){return this.sn.kt()?(this.rn(),this.ot):null}hn(){const t=this.nn.St().Sn();this.he=At(t);let i=0,s=0;const n=this.sn.F().color;for(const t of this.sn.fs().mn()){const e=t.Dt[3],r=void 0!==t.N?t.N:n,h=It(t.gn,e,r);i++,i<this.he.tt.length?this.he.tt[i]=h:this.he.tt.push(h),this.Qs[s++]={ht:t.gn,it:0}}this.Wt.G(this.he),this.ot.U([this.Wt])}an(){}on(){super.on(),this.he.J=null}cn(t,i,s){if(null===this.tn)return;const n=i.Sn(),e=h(i._n()),r=t.Ct(this.sn.F().base,s);i.dn(this.he.tt),t.fn(this.he.tt,s),this.he.ne=r,this.he.J=vt(this.he.tt,e,!1),this.he.Sn=n,this.Wt.G(this.he)}}class Vt extends wt{constructor(t,i){super(t,i),this.Mn=new ut}wt(t,i){if(!this.sn.kt())return null;const s=this.sn.F();this.rn();const n={tt:this.Qs,rt:s.color,Ft:s.lineStyle,Ws:s.lineType,Bt:s.lineWidth,J:this.tn,Fs:this.nn.St().Sn()};return this.Mn.G(n),this.Mn}an(){this.Qs.forEach((t=>{t.N=this.sn.vn().Fn(t.ht).Bn}))}wn(t,i,s){const n=this.pn(t,i);return n.N=s.Fn(t).Bn,n}}const Bt=/[2-9]/g;class Ft{constructor(t=50){this.le=new Map,this.ae=0,this.oe=Array.from(new Array(t))}_e(){this.le.clear(),this.oe.fill(void 0)}ii(t,i,s){const n=s||Bt,e=String(i).replace(n,"0");let r=this.le.get(e);if(void 0===r){if(r=t.measureText(e).width,0===r&&0!==i.length)return 0;const s=this.oe[this.ae];void 0!==s&&this.le.delete(s),this.oe[this.ae]=e,this.ae=(this.ae+1)%this.oe.length,this.le.set(e,r)}return r}}class zt{constructor(t){this.ue=null,this.k=null,this.ce="right",this.de=0,this.fe=t}pe(t,i,s,n){this.ue=t,this.k=i,this.de=s,this.ce=n}q(t,i){null!==this.k&&null!==this.ue&&this.ue.q(t,this.k,this.fe,this.de,this.ce,i)}}class Wt{constructor(t,i,s){this.ve=t,this.fe=new Ft(50),this.me=i,this.B=s,this.W=-1,this.Wt=new zt(this.fe)}wt(t,i){const s=this.B.we(this.me);if(null===s)return null;const n=s.ge(this.me)?s.be():this.me.Pt();if(null===n)return null;const e=s.Me(n);if("overlay"===e)return null;const r=this.B.Se();return r.P!==this.W&&(this.W=r.P,this.fe._e()),this.Wt.pe(this.ve.pi(),r,i,e),this.Wt}}class jt{constructor(){this.Rt=null}G(t){this.Rt=t}q(t,i,e,r){if(null===this.Rt)return;if(!1===this.Rt.kt)return;const h=Math.round(this.Rt.st*i);if(h<0||h>Math.ceil(this.Rt.Xt*i))return;const l=Math.ceil(this.Rt.Yt*i);t.lineCap="butt",t.strokeStyle=this.Rt.N,t.lineWidth=Math.floor(this.Rt.Bt*i),s(t,this.Rt.Ft),n(t,h,0,l)}}class $t{constructor(t){this.ye={Yt:0,Xt:0,st:0,N:"rgba(0, 0, 0, 0)",Bt:1,Ft:0,kt:!1},this.ke=new jt,this.li=!0,this.sn=t,this.nn=t.$t(),this.ke.G(this.ye)}ft(){this.li=!0}wt(t,i){return this.sn.kt()?(this.li&&(this.xe(t,i),this.li=!1),this.ke):null}}class Ht extends $t{constructor(t){super(t)}xe(t,i){this.ye.kt=!1;const s=this.sn.Pt(),n=s.Te().Te;if(2!==n&&3!==n)return;const e=this.sn.F();if(!e.baseLineVisible||!this.sn.kt())return;const r=this.sn.xt();null!==r&&(this.ye.kt=!0,this.ye.st=s.Ct(r.Dt,r.Dt),this.ye.Yt=i,this.ye.Xt=t,this.ye.N=e.baseLineColor,this.ye.Bt=e.baseLineWidth,this.ye.Ft=e.baseLineStyle)}}class Ut{constructor(){this.Rt=null}G(t){this.Rt=t}Ce(){return this.Rt}q(t,i,s,n){const e=this.Rt;if(null===e)return;t.save();const r=Math.max(1,Math.floor(i)),h=r%2/2,l=Math.round(e.re.x*i)+h,a=e.re.y*i;t.fillStyle=e.Pe,t.beginPath();const o=Math.max(2,1.5*e.De)*i;t.arc(l,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=e.Ee,t.beginPath(),t.arc(l,a,e.et*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=e.Oe,t.beginPath(),t.arc(l,a,e.et*i+r/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const qt=[{Ne:0,Re:.25,Ae:4,Ie:10,Le:.25,Ve:0,Be:.4,Fe:.8},{Ne:.25,Re:.525,Ae:10,Ie:14,Le:0,Ve:0,Be:.8,Fe:0},{Ne:.525,Re:1,Ae:14,Ie:14,Le:0,Ve:0,Be:0,Fe:0}];function Yt(t,i,s,n){return function(t,i){if("transparent"===t)return t;const s=p(t),n=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*n})`}(t,s+(n-s)*i)}function Xt(t,i){const s=t%2600/2600;let n;for(const t of qt)if(s>=t.Ne&&s<=t.Re){n=t;break}e(void 0!==n,"Last price animation internal logic error");const r=(s-n.Ne)/(n.Re-n.Ne);return{Ee:Yt(i,r,n.Le,n.Ve),Oe:Yt(i,r,n.Be,n.Fe),et:(h=r,l=n.Ae,a=n.Ie,l+(a-l)*h)};var h,l,a}class Kt{constructor(t){this.Wt=new Ut,this.li=!0,this.ze=!0,this.We=performance.now(),this.je=this.We-1,this.$e=t}He(){this.je=this.We-1,this.ft()}Ue(){if(this.ft(),2===this.$e.F().lastPriceAnimation){const t=performance.now(),i=this.je-t;if(i>0)return void(i<650&&(this.je+=2600));this.We=t,this.je=t+2600}}ft(){this.li=!0}qe(){this.ze=!0}kt(){return 0!==this.$e.F().lastPriceAnimation}Ye(){switch(this.$e.F().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.je}}wt(t,i){return this.li?(this.gt(t,i),this.li=!1,this.ze=!1):this.ze&&(this.Xe(),this.ze=!1),this.Wt}gt(t,i){this.Wt.G(null);const s=this.$e.$t().St(),n=s._n(),e=this.$e.xt();if(null===n||null===e)return;const r=this.$e.Ke(!0);if(r.Ze||!n.Ge(r.gn))return;const h={x:s.Nt(r.gn),y:this.$e.Pt().Ct(r.lt,e.Dt)},l=r.N,a=this.$e.F().lineWidth,o=Xt(this.Je(),l);this.Wt.G({Pe:l,De:a,Ee:o.Ee,Oe:o.Oe,et:o.et,re:h})}Xe(){const t=this.Wt.Ce();if(null!==t){const i=Xt(this.Je(),t.Pe);t.Ee=i.Ee,t.Oe=i.Oe,t.et=i.et}}Je(){return this.Ye()?performance.now()-this.We:2599}}function Zt(t,i){return Ct(Math.min(Math.max(t,12),30)*i)}function Gt(t,i){switch(t){case"arrowDown":case"arrowUp":return Zt(i,1);case"circle":return Zt(i,.8);case"square":return Zt(i,.7)}}function Jt(t){return Tt(Zt(t,1))}function Qt(t){return Math.max(Zt(t,.1),3)}function ti(t,i,s,n,e){const r=Gt("square",s),h=(r-1)/2,l=t-h,a=i-h;return n>=l&&n<=l+r&&e>=a&&e<=a+r}function ii(t,i,s,n,e){const r=(Gt("arrowUp",e)-1)/2,h=(Ct(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-r,n),i.lineTo(s,n-r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n+r),i.lineTo(s-h,n+r),i.lineTo(s-h,n)):(i.moveTo(s-r,n),i.lineTo(s,n+r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n-r),i.lineTo(s-h,n-r),i.lineTo(s-h,n)),i.fill()}function si(t,i,s,n,e,r){return ti(i,s,n,e,r)}class ni extends E{constructor(){super(...arguments),this.Rt=null,this.fe=new Ft,this.W=-1,this.j="",this.Qe=""}G(t){this.Rt=t}pe(t,i){this.W===t&&this.j===i||(this.W=t,this.j=i,this.Qe=C(t,i),this.fe._e())}tr(t,i){if(null===this.Rt||null===this.Rt.J)return null;for(let s=this.Rt.J.from;s<this.Rt.J.to;s++){const n=this.Rt.tt[s];if(ri(n,t,i))return{ir:n.sr,nr:n.nr}}return null}Y(t,i,s){if(null!==this.Rt&&null!==this.Rt.J){t.textBaseline="middle",t.font=this.Qe;for(let i=this.Rt.J.from;i<this.Rt.J.to;i++){const s=this.Rt.tt[i];void 0!==s.ti&&(s.ti.Yt=this.fe.ii(t,s.ti.er),s.ti.Xt=this.W),ei(s,t)}}}}function ei(t,i){i.fillStyle=t.N,void 0!==t.ti&&function(t,i,s,n){t.fillText(i,s,n)}(i,t.ti.er,t.it-t.ti.Yt/2,t.ti.st),function(t,i){if(0===t.un)return;switch(t.rr){case"arrowDown":return void ii(!1,i,t.it,t.st,t.un);case"arrowUp":return void ii(!0,i,t.it,t.st,t.un);case"circle":return void function(t,i,s,n){const e=(Gt("circle",n)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.it,t.st,t.un);case"square":return void function(t,i,s,n){const e=Gt("square",n),r=(e-1)/2,h=i-r,l=s-r;t.fillRect(h,l,e,e)}(i,t.it,t.st,t.un)}t.rr}(t,i)}function ri(t,i,s){return!(void 0===t.ti||!function(t,i,s,n,e,r){const h=n/2;return e>=t&&e<=t+s&&r>=i-h&&r<=i+h}(t.it,t.ti.st,t.ti.Yt,t.ti.Xt,i,s))||function(t,i,s){if(0===t.un)return!1;switch(t.rr){case"arrowDown":case"arrowUp":return si(0,t.it,t.st,t.un,i,s);case"circle":return function(t,i,s,n,e){const r=2+Gt("circle",s)/2,h=t-n,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.it,t.st,t.un,i,s);case"square":return ti(t.it,t.st,t.un,i,s)}}(t,i,s)}function hi(t,i,s,n,e,r,h,l,a){const o=g(s)?s:s.Vn,_=g(s)?s:s.In,u=g(s)?s:s.Ln,c=g(i.size)?Math.max(i.size,0):1,d=Jt(l.Sn())*c,f=d/2;switch(t.un=d,i.position){case"inBar":return t.st=h.Ct(o,a),void(void 0!==t.ti&&(t.ti.st=t.st+f+r+.6*e));case"aboveBar":return t.st=h.Ct(_,a)-f-n.hr,void 0!==t.ti&&(t.ti.st=t.st-f-.6*e,n.hr+=1.2*e),void(n.hr+=d+r);case"belowBar":return t.st=h.Ct(u,a)+f+n.lr,void 0!==t.ti&&(t.ti.st=t.st+f+r+.6*e,n.lr+=1.2*e),void(n.lr+=d+r)}i.position}class li{constructor(t,i){this.li=!0,this.ar=!0,this._r=!0,this.ur=null,this.Wt=new ni,this.$e=t,this.yi=i,this.Rt={tt:[],J:null}}ft(t){this.li=!0,this._r=!0,"data"===t&&(this.ar=!0)}wt(t,i,s,n){if(!this.$e.kt())return null;this.li&&this.rn();const e=this.yi.F().layout;return this.Wt.pe(e.fontSize,e.fontFamily),this.Wt.G(this.Rt),this.Wt}cr(){if(this._r){if(this.$e.dr().length>0){const t=this.yi.St().Sn(),i=Qt(t),s=1.5*Jt(t)+2*i;this.ur={above:s,below:s}}else this.ur=null;this._r=!1}return this.ur}rn(){const t=this.$e.Pt(),i=this.yi.St(),s=this.$e.dr();this.ar&&(this.Rt.tt=s.map((t=>({ht:t.time,it:0,st:0,un:0,rr:t.shape,N:t.color,sr:t.internalId,nr:t.id,ti:void 0}))),this.ar=!1);const n=this.yi.F().layout;this.Rt.J=null;const e=i._n();if(null===e)return;const r=this.$e.xt();if(null===r)return;if(0===this.Rt.tt.length)return;let h=NaN;const l=Qt(i.Sn()),a={hr:l,lr:l};this.Rt.J=vt(this.Rt.tt,e,!0);for(let e=this.Rt.J.from;e<this.Rt.J.to;e++){const o=s[e];o.time!==h&&(a.hr=l,a.lr=l,h=o.time);const _=this.Rt.tt[e];_.it=i.Nt(o.time),void 0!==o.text&&o.text.length>0&&(_.ti={er:o.text,st:0,Yt:0,Xt:0});const u=this.$e.pr(o.time);null!==u&&hi(_,o,u,a,n.fontSize,l,t,i,r.Dt)}this.li=!1}}class ai extends $t{constructor(t){super(t)}xe(t,i){const s=this.ye;s.kt=!1;const n=this.sn.F();if(!n.priceLineVisible||!this.sn.kt())return;const e=this.sn.Ke(0===n.priceLineSource);e.Ze||(s.kt=!0,s.st=e.si,s.N=this.sn.vr(e.N),s.Yt=i,s.Xt=t,s.Bt=n.priceLineWidth,s.Ft=n.priceLineStyle)}}class oi extends j{constructor(t){super(),this.jt=t}vi(t,i,s){t.kt=!1,i.kt=!1;const n=this.jt;if(!n.kt())return;const e=n.F(),r=e.lastValueVisible,h=""!==n.mr(),l=0===e.seriesLastValueMode,a=n.Ke(!1);if(a.Ze)return;r&&(t.ti=this.wr(a,r,l),t.kt=0!==t.ti.length),(h||l)&&(i.ti=this.gr(a,r,h,l),i.kt=i.ti.length>0);const o=n.vr(a.N),_=v(o);s.t=_.t,s.N=_.i,s.si=a.si,i.Et=n.$t().Ot(a.si/n.Pt().Xt()),t.Et=o}gr(t,i,s,n){let e="";const r=this.jt.mr();return s&&0!==r.length&&(e+=`${r} `),i&&n&&(e+=this.jt.Pt().br()?t.Mr:t.Sr),e.trim()}wr(t,i,s){return i?s?this.jt.Pt().br()?t.Sr:t.Mr:t.ti:""}}class _i{constructor(t,i){this.yr=t,this.kr=i}Tr(t){return null!==t&&(this.yr===t.yr&&this.kr===t.kr)}Cr(){return new _i(this.yr,this.kr)}Pr(){return this.yr}Dr(){return this.kr}Er(){return this.kr-this.yr}gi(){return this.kr===this.yr||Number.isNaN(this.kr)||Number.isNaN(this.yr)}Os(t){return null===t?this:new _i(Math.min(this.Pr(),t.Pr()),Math.max(this.Dr(),t.Dr()))}Or(t){if(!g(t))return;if(0===this.kr-this.yr)return;const i=.5*(this.kr+this.yr);let s=this.kr-i,n=this.yr-i;s*=t,n*=t,this.kr=i+s,this.yr=i+n}Nr(t){g(t)&&(this.kr+=t,this.yr+=t)}Rr(){return{minValue:this.yr,maxValue:this.kr}}static Ar(t){return null===t?null:new _i(t.minValue,t.maxValue)}}class ui{constructor(t,i){this.Ir=t,this.Lr=i||null}Vr(){return this.Ir}Br(){return this.Lr}Rr(){return null===this.Ir?null:{priceRange:this.Ir.Rr(),margins:this.Lr||void 0}}static Ar(t){return null===t?null:new ui(_i.Ar(t.priceRange),t.margins)}}class ci extends $t{constructor(t,i){super(t),this.Fr=i}xe(t,i){const s=this.ye;s.kt=!1;const n=this.Fr.F();if(!this.sn.kt()||!n.lineVisible)return;const e=this.Fr.zr();null!==e&&(s.kt=!0,s.st=e,s.N=n.color,s.Yt=i,s.Xt=t,s.Bt=n.lineWidth,s.Ft=n.lineStyle)}}class di extends j{constructor(t,i){super(),this.$e=t,this.Fr=i}vi(t,i,s){t.kt=!1,i.kt=!1;const n=this.Fr.F(),e=n.axisLabelVisible,r=""!==n.title,h=this.$e;if(!e||!h.kt())return;const l=this.Fr.zr();if(null===l)return;r&&(i.ti=n.title,i.kt=!0),i.Et=h.$t().Ot(l/h.Pt().Xt()),t.ti=this.Wr(n.price),t.kt=!0;const a=v(n.color);s.t=a.t,s.N=a.i,s.si=l}Wr(t){const i=this.$e.xt();return null===i?"":this.$e.Pt().bi(t,i.Dt)}}class fi{constructor(t,i){this.$e=t,this.$i=i,this.jr=new ci(t,this),this.ve=new di(t,this),this.$r=new Wt(this.ve,t,t.$t())}Hr(t){w(this.$i,t),this.ft(),this.$e.$t().Ur()}F(){return this.$i}qr(){return this.jr}Yr(){return this.$r}Xr(){return this.ve}ft(){this.jr.ft(),this.ve.ft()}zr(){const t=this.$e,i=t.Pt();if(t.$t().St().gi()||i.gi())return null;const s=t.xt();return null===s?null:i.Ct(this.$i.price,s.Dt)}}class pi extends Y{constructor(t){super(),this.yi=t}$t(){return this.yi}}const vi={Bn:"",te:"",Qn:""};class mi{constructor(t){this.$e=t}Fn(t,i){const s=this.$e.Kr(),n=this.$e.F();switch(s){case"Line":return this.Zr(n,t,i);case"Area":return this.Gr(n);case"Baseline":return this.Jr(n,t,i);case"Bar":return this.Qr(n,t,i);case"Candlestick":return this.th(n,t,i);case"Histogram":return this.ih(n,t,i)}throw new Error("Unknown chart style")}Qr(t,i,s){const n=Object.assign({},vi),e=t.upColor,r=t.downColor,a=e,o=r,_=h(this.sh(i,s)),u=l(_.Dt[0])<=l(_.Dt[3]);return void 0!==_.N?(n.Bn=_.N,n.te=_.N):(n.Bn=u?e:r,n.te=u?a:o),n}th(t,i,s){var n,e,r;const a=Object.assign({},vi),o=t.upColor,_=t.downColor,u=t.borderUpColor,c=t.borderDownColor,d=t.wickUpColor,f=t.wickDownColor,p=h(this.sh(i,s)),v=l(p.Dt[0])<=l(p.Dt[3]);return a.Bn=null!==(n=p.N)&&void 0!==n?n:v?o:_,a.te=null!==(e=p.Et)&&void 0!==e?e:v?u:c,a.Qn=null!==(r=p.Jn)&&void 0!==r?r:v?d:f,a}Gr(t){return Object.assign(Object.assign({},vi),{Bn:t.lineColor})}Jr(t,i,s){const n=h(this.sh(i,s)).Dt[3]>=t.baseValue.price;return Object.assign(Object.assign({},vi),{Bn:n?t.topLineColor:t.bottomLineColor})}Zr(t,i,s){var n;const e=h(this.sh(i,s));return Object.assign(Object.assign({},vi),{Bn:null!==(n=e.N)&&void 0!==n?n:t.color})}ih(t,i,s){const n=Object.assign({},vi),e=h(this.sh(i,s));return n.Bn=void 0!==e.N?e.N:t.color,n}sh(t,i){return void 0!==i?i.Dt:this.$e.fs().nh(t)}}var wi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(wi||(wi={}));const gi=30;class bi{constructor(){this.eh=[],this.rh=new Map,this.hh=new Map}lh(){return this.un()>0?this.eh[this.eh.length-1]:null}ah(){return this.un()>0?this.oh(0):null}ds(){return this.un()>0?this.oh(this.eh.length-1):null}un(){return this.eh.length}gi(){return 0===this.un()}Ge(t){return null!==this._h(t,0)}nh(t){return this.uh(t)}uh(t,i=0){const s=this._h(t,i);return null===s?null:Object.assign(Object.assign({},this.dh(s)),{gn:this.oh(s)})}mn(){return this.eh}fh(t,i,s){if(this.gi())return null;let n=null;for(const e of s){n=Mi(n,this.ph(t,i,e))}return n}G(t){this.hh.clear(),this.rh.clear(),this.eh=t}oh(t){return this.eh[t].gn}dh(t){return this.eh[t]}_h(t,i){const s=this.mh(t);if(null===s&&0!==i)switch(i){case-1:return this.wh(t);case 1:return this.gh(t);default:throw new TypeError("Unknown search mode")}return s}wh(t){let i=this.bh(t);return i>0&&(i-=1),i!==this.eh.length&&this.oh(i)<t?i:null}gh(t){const i=this.Mh(t);return i!==this.eh.length&&t<this.oh(i)?i:null}mh(t){const i=this.bh(t);return i===this.eh.length||t<this.eh[i].gn?null:i}bh(t){return ct(this.eh,t,((t,i)=>t.gn<i))}Mh(t){return dt(this.eh,t,((t,i)=>i.gn>t))}Sh(t,i,s){let n=null;for(let e=t;e<i;e++){const t=this.eh[e].Dt[s];Number.isNaN(t)||(null===n?n={yh:t,kh:t}:(t<n.yh&&(n.yh=t),t>n.kh&&(n.kh=t)))}return n}ph(t,i,s){if(this.gi())return null;let n=null;const e=h(this.ah()),r=h(this.ds()),l=Math.max(t,e),a=Math.min(i,r),o=Math.ceil(l/gi)*gi,_=Math.max(o,Math.floor(a/gi)*gi);{const t=this.bh(l),e=this.Mh(Math.min(a,o,i));n=Mi(n,this.Sh(t,e,s))}let u=this.rh.get(s);void 0===u&&(u=new Map,this.rh.set(s,u));for(let t=Math.max(o+1,l);t<_;t+=gi){const i=Math.floor(t/gi);let e=u.get(i);if(void 0===e){const t=this.bh(i*gi),n=this.Mh((i+1)*gi-1);e=this.Sh(t,n,s),u.set(i,e)}n=Mi(n,e)}{const t=this.bh(_),i=this.Mh(a);n=Mi(n,this.Sh(t,i,s))}return n}}function Mi(t,i){if(null===t)return i;if(null===i)return t;return{yh:Math.min(t.yh,i.yh),kh:Math.max(t.kh,i.kh)}}class Si extends pi{constructor(t,i,s){super(t),this.Rt=new bi,this.jr=new ai(this),this.xh=[],this.Th=new Ht(this),this.Ch=null,this.Ph=null,this.Dh=[],this.Eh=[],this.Oh=null,this.$i=i,this.Nh=s;const n=new oi(this);this.Vi=[n],this.$r=new Wt(n,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.Ch=new Kt(this)),this.Rh(),this.Ah()}S(){null!==this.Oh&&clearTimeout(this.Oh)}vr(t){return this.$i.priceLineColor||t}Ke(t){const i={Ze:!0},s=this.Pt();if(this.$t().St().gi()||s.gi()||this.Rt.gi())return i;const n=this.$t().St()._n(),e=this.xt();if(null===n||null===e)return i;let r,h;if(t){const t=this.Rt.lh();if(null===t)return i;r=t,h=t.gn}else{const t=this.Rt.uh(n.Ks(),-1);if(null===t)return i;if(r=this.Rt.nh(t.gn),null===r)return i;h=t.gn}const l=r.Dt[3],a=this.vn().Fn(h,{Dt:r}),o=s.Ct(l,e.Dt);return{Ze:!1,lt:l,ti:s.bi(l,e.Dt),Mr:s.Ih(l),Sr:s.Lh(l,e.Dt),N:a.Bn,si:o,gn:h}}vn(){return null!==this.Ph||(this.Ph=new mi(this)),this.Ph}F(){return this.$i}Hr(t){var i;const s=t.priceScaleId;void 0!==s&&s!==this.$i.priceScaleId&&this.$t().Vh(this,s);const n=null!==(i=this.$i.pane)&&void 0!==i?i:0;w(this.$i,t),void 0!==t.priceFormat&&(this.Rh(),this.$t().Bh()),t.pane&&n!==t.pane&&this.$t().Fh(this,n,t.pane),this.$t().zh(this),this.$t().Wh(),this.Zi.ft("options")}G(t,i){this.Rt.G(t),this.jh(),this.Zi.ft("data"),this.Hi.ft("data"),null!==this.Ch&&(i&&i.$h?this.Ch.Ue():0===t.length&&this.Ch.He());const s=this.$t().we(this);this.$t().Hh(s),this.$t().zh(this),this.$t().Wh(),this.$t().Ur()}Uh(t){this.Dh=t,this.jh();const i=this.$t().we(this);this.Hi.ft("data"),this.$t().Hh(i),this.$t().zh(this),this.$t().Wh(),this.$t().Ur()}qh(){return this.Dh}dr(){return this.Eh}Yh(t){const i=new fi(this,t);return this.xh.push(i),this.$t().zh(this),i}Xh(t){const i=this.xh.indexOf(t);-1!==i&&this.xh.splice(i,1),this.$t().zh(this)}Kr(){return this.Nh}xt(){const t=this.Kh();return null===t?null:{Dt:t.Dt[3],Zh:t.ht}}Kh(){const t=this.$t().St()._n();if(null===t)return null;const i=t.Xs();return this.Rt.uh(i,1)}fs(){return this.Rt}pr(t){const i=this.Rt.nh(t);return null===i?null:"Bar"===this.Nh||"Candlestick"===this.Nh?{An:i.Dt[0],In:i.Dt[1],Ln:i.Dt[2],Vn:i.Dt[3]}:i.Dt[3]}Gh(t){const i=this.Ch;return null!==i&&i.kt()?(null===this.Oh&&i.Ye()&&(this.Oh=setTimeout((()=>{this.Oh=null,this.$t().Jh()}),0)),i.qe(),[i]):[]}hs(){const t=[];this.Qh()||t.push(this.Th),t.push(this.Zi,this.jr,this.Hi);const i=this.xh.map((t=>t.qr()));return t.push(...i),t}Oi(t){return[this.$r,...this.xh.map((t=>t.Yr()))]}ls(t,i){if(i!==this.Ti&&!this.Qh())return[];const s=[...this.Vi];for(const t of this.xh)s.push(t.Xr());return s}tl(t,i){if(void 0!==this.$i.autoscaleInfoProvider){const s=this.$i.autoscaleInfoProvider((()=>{const s=this.il(t,i);return null===s?null:s.Rr()}));return ui.Ar(s)}return this.il(t,i)}sl(){return this.$i.priceFormat.minMove}nl(){return this.el}_s(){var t;this.Zi.ft(),this.Hi.ft();for(const t of this.Vi)t.ft();for(const t of this.xh)t.ft();this.jr.ft(),this.Th.ft(),null===(t=this.Ch)||void 0===t||t.ft()}Pt(){return h(super.Pt())}yt(t){if(!(("Line"===this.Nh||"Area"===this.Nh||"Baseline"===this.Nh)&&this.$i.crosshairMarkerVisible))return null;const i=this.Rt.nh(t);if(null===i)return null;return{lt:i.Dt[3],et:this.rl(),Et:this.hl(),Tt:this.ll(t)}}mr(){return this.$i.title}kt(){return this.$i.visible}Qh(){return!Z(this.Pt().al())}il(t,i){if(!b(t)||!b(i)||this.Rt.gi())return null;const s="Line"===this.Nh||"Area"===this.Nh||"Baseline"===this.Nh||"Histogram"===this.Nh?[3]:[2,1],n=this.Rt.fh(t,i,s);let e=null!==n?new _i(n.yh,n.kh):null;if("Histogram"===this.Kr()){const t=this.$i.base,i=new _i(t,t);e=null!==e?e.Os(i):i}return new ui(e,this.Hi.cr())}rl(){switch(this.Nh){case"Line":case"Area":case"Baseline":return this.$i.crosshairMarkerRadius}return 0}hl(){switch(this.Nh){case"Line":case"Area":case"Baseline":{const t=this.$i.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}ll(t){switch(this.Nh){case"Line":case"Area":case"Baseline":{const t=this.$i.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.vn().Fn(t).Bn}Rh(){switch(this.$i.priceFormat.type){case"custom":this.el={format:this.$i.priceFormat.formatter};break;case"volume":this.el=new st(this.$i.priceFormat.precision);break;case"percent":this.el=new it(this.$i.priceFormat.precision);break;default:{const t=Math.pow(10,this.$i.priceFormat.precision);this.el=new tt(t,this.$i.priceFormat.minMove*t)}}null!==this.Ti&&this.Ti.ol()}jh(){const t=this.$t().St();if(t.gi()||0===this.Rt.un())return void(this.Eh=[]);const i=h(this.Rt.ah());this.Eh=this.Dh.map(((s,n)=>{const e=h(t._l(s.time,!0)),r=e<i?1:-1;return{time:h(this.Rt.uh(e,r)).gn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:n,text:s.text,size:s.size}}))}Ah(){switch(this.Hi=new li(this,this.$t()),this.Nh){case"Bar":this.Zi=new St(this,this.$t());break;case"Candlestick":this.Zi=new Nt(this,this.$t());break;case"Line":this.Zi=new Vt(this,this.$t());break;case"Area":this.Zi=new gt(this,this.$t());break;case"Baseline":this.Zi=new Et(this,this.$t());break;case"Histogram":this.Zi=new Lt(this,this.$t());break;default:throw Error("Unknown chart style assigned: "+this.Nh)}}}class yi{constructor(t){this.$i=t}ul(t,i,s){let n=t;if(0===this.$i.mode)return n;const e=s.qi(),r=e.xt();if(null===r)return n;const h=e.Ct(t,r),a=s.bt().filter((t=>t instanceof Si)).reduce(((t,n)=>{if(s.ge(n)||!n.kt())return t;const e=n.Pt(),r=n.fs();if(e.gi()||!r.Ge(i))return t;const h=r.nh(i);if(null===h)return t;const a=l(n.xt());return t.concat([e.Ct(h.Dt[3],a.Dt)])}),[]);if(0===a.length)return n;a.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const o=a[0];return n=e.Yi(o,r),n}}class ki{constructor(){this.Rt=null}G(t){this.Rt=t}q(t,i,n,e){if(null===this.Rt)return;const r=Math.max(1,Math.floor(i));t.lineWidth=r;const l=Math.ceil(this.Rt.Vt*i),a=Math.ceil(this.Rt.Lt*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const n=h(this.Rt);if(n.cl){t.strokeStyle=n.dl,s(t,n.fl),t.beginPath();for(const s of n.pl){const n=Math.round(s.vl*i);t.moveTo(n,-r),t.lineTo(n,l+r)}t.stroke()}if(n.ml){t.strokeStyle=n.wl,s(t,n.gl),t.beginPath();for(const s of n.bl){const n=Math.round(s.vl*i);t.moveTo(-r,n),t.lineTo(a+r,n)}t.stroke()}}))}}class xi{constructor(t){this.Wt=new ki,this.li=!0,this.Ri=t}ft(){this.li=!0}wt(t,i){if(this.li){const s=this.Ri.$t().F().grid,n={Vt:t,Lt:i,ml:s.horzLines.visible,cl:s.vertLines.visible,wl:s.horzLines.color,dl:s.vertLines.color,gl:s.horzLines.style,fl:s.vertLines.style,bl:this.Ri.qi().Ml(),pl:this.Ri.$t().St().Ml()||[]};this.Wt.G(n),this.li=!1}return this.Wt}}class Ti{constructor(t){this.Zi=new xi(t)}qr(){return this.Zi}}const Ci={Sl:4,yl:1e-4};function Pi(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Di(t,i){const s=Pi(t.Pr(),i),n=Pi(t.Dr(),i);return new _i(s,n)}function Ei(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Oi(t,i){const s=Ei(t.Pr(),i),n=Ei(t.Dr(),i);return new _i(s,n)}function Ni(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=xt(s+i.yl)+i.Sl;return t<0?-n:n}function Ri(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Math.pow(10,s-i.Sl)-i.yl;return t<0?-n:n}function Ai(t,i){if(null===t)return null;const s=Ni(t.Pr(),i),n=Ni(t.Dr(),i);return new _i(s,n)}function Ii(t,i){if(null===t)return null;const s=Ri(t.Pr(),i),n=Ri(t.Dr(),i);return new _i(s,n)}function Li(t){if(null===t)return Ci;const i=Math.abs(t.Dr()-t.Pr());if(i>=1||i<1e-15)return Ci;const s=Math.ceil(Math.abs(Math.log10(i))),n=Ci.Sl+s;return{Sl:n,yl:1/Math.pow(10,n)}}class Vi{constructor(t,i){if(this.kl=t,this.xl=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.kl))this.Tl=[2,2.5,2];else{this.Tl=[];for(let t=this.kl;1!==t;){if(t%2==0)this.Tl.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.Tl.push(2,2.5),t/=5}if(this.Tl.length>100)throw new Error("something wrong with base")}}}Cl(t,i,s){const n=0===this.kl?0:1/this.kl;let e=Math.pow(10,Math.max(0,Math.ceil(xt(t-i)))),r=0,h=this.xl[0];for(;;){const t=kt(e,n,1e-14)&&e>n+1e-14,i=kt(e,s*h,1e-14),l=kt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.xl[++r%this.xl.length]}if(e<=n+1e-14&&(e=n),e=Math.max(1,e),this.Tl.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.Tl[0];kt(e,s*h,1e-14)&&e>n+1e-14;)e/=h,h=this.Tl[++r%this.Tl.length];var l,a,o;return e}}class Bi{constructor(t,i,s,n){this.Pl=[],this.mi=t,this.kl=i,this.Dl=s,this.El=n}Cl(t,i){if(t<i)throw new Error("high < low");const s=this.mi.Xt(),n=(t-i)*this.Ol()/s,e=new Vi(this.kl,[2,2.5,2]),r=new Vi(this.kl,[2,2,2.5]),h=new Vi(this.kl,[2.5,2,2]),l=[];return l.push(e.Cl(t,i,n),r.Cl(t,i,n),h.Cl(t,i,n)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}Nl(){const t=this.mi,i=t.xt();if(null===i)return void(this.Pl=[]);const s=t.Xt(),n=this.Dl(s-1,i),e=this.Dl(0,i),r=this.mi.F().entireTextOnly?this.Rl()/2:0,h=r,l=s-1-r,a=Math.max(n,e),o=Math.min(n,e);if(a===o)return void(this.Pl=[]);let _=this.Cl(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let s=a-u;s>o;s-=_){const n=this.El(s,i,!0);null!==d&&Math.abs(n-d)<this.Ol()||(n<h||n>l||(f<this.Pl.length?(this.Pl[f].vl=n,this.Pl[f].Al=t.Il(s)):this.Pl.push({vl:n,Al:t.Il(s)}),f++,d=n,t.Ll()&&(_=this.Cl(s*c,o))))}this.Pl.length=f}Ml(){return this.Pl}Rl(){return this.mi.P()}Ol(){return Math.ceil(2.5*this.Rl())}}function Fi(t){return t.slice().sort(((t,i)=>h(t.Pi())-h(i.Pi())))}var zi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(zi||(zi={}));const Wi=new it,ji=new tt(100,1);class $i{constructor(t,i,s,n){this.Vl=0,this.Bl=null,this.Ir=null,this.Fl=null,this.zl={Wl:!1,jl:null},this.$l=0,this.Hl=0,this.Ul=new m,this.ql=new m,this.Yl=[],this.Xl=null,this.Kl=null,this.Zl=null,this.Gl=null,this.el=ji,this.Jl=Li(null),this.Ql=t,this.$i=i,this.ta=s,this.ia=n,this.sa=new Bi(this,100,this.na.bind(this),this.ea.bind(this))}al(){return this.Ql}F(){return this.$i}Hr(t){if(w(this.$i,t),this.ol(),void 0!==t.mode&&this.ra({Te:t.mode}),void 0!==t.scaleMargins){const i=r(t.scaleMargins.top),s=r(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.ha(),this.Kl=null}}la(){return this.$i.autoScale}Ll(){return 1===this.$i.mode}br(){return 2===this.$i.mode}aa(){return 3===this.$i.mode}Te(){return{Ms:this.$i.autoScale,oa:this.$i.invertScale,Te:this.$i.mode}}ra(t){const i=this.Te();let s=null;void 0!==t.Ms&&(this.$i.autoScale=t.Ms),void 0!==t.Te&&(this.$i.mode=t.Te,2!==t.Te&&3!==t.Te||(this.$i.autoScale=!0),this.zl.Wl=!1),1===i.Te&&t.Te!==i.Te&&(!function(t,i){if(null===t)return!1;const s=Ri(t.Pr(),i),n=Ri(t.Dr(),i);return isFinite(s)&&isFinite(n)}(this.Ir,this.Jl)?this.$i.autoScale=!0:(s=Ii(this.Ir,this.Jl),null!==s&&this._a(s))),1===t.Te&&t.Te!==i.Te&&(s=Ai(this.Ir,this.Jl),null!==s&&this._a(s));const n=i.Te!==this.$i.mode;n&&(2===i.Te||this.br())&&this.ol(),n&&(3===i.Te||this.aa())&&this.ol(),void 0!==t.oa&&i.oa!==t.oa&&(this.$i.invertScale=t.oa,this.ua()),this.ql.m(i,this.Te())}ca(){return this.ql}P(){return this.ta.fontSize}Xt(){return this.Vl}da(t){this.Vl!==t&&(this.Vl=t,this.ha(),this.Kl=null)}fa(){if(this.Bl)return this.Bl;const t=this.Xt()-this.pa()-this.va();return this.Bl=t,t}Vr(){return this.ma(),this.Ir}_a(t,i){const s=this.Ir;(i||null===s&&null!==t||null!==s&&!s.Tr(t))&&(this.Kl=null,this.Ir=t)}gi(){return this.ma(),0===this.Vl||!this.Ir||this.Ir.gi()}wa(t){return this.oa()?t:this.Xt()-1-t}Ct(t,i){return this.br()?t=Pi(t,i):this.aa()&&(t=Ei(t,i)),this.ea(t,i)}fn(t,i,s){this.ma();const n=this.va(),e=h(this.Vr()),r=e.Pr(),l=e.Dr(),a=this.fa()-1,o=this.oa(),_=a/(l-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.ga();for(let s=u;s<c;s++){const e=t[s],h=e.lt;if(isNaN(h))continue;let l=h;null!==d&&(l=d(e.lt,i));const a=n+_*(l-r),u=o?a:this.Vl-1-a;e.st=u}}Nn(t,i,s){this.ma();const n=this.va(),e=h(this.Vr()),r=e.Pr(),l=e.Dr(),a=this.fa()-1,o=this.oa(),_=a/(l-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.ga();for(let s=u;s<c;s++){const e=t[s];let h=e.An,l=e.In,a=e.Ln,u=e.Vn;null!==d&&(h=d(e.An,i),l=d(e.In,i),a=d(e.Ln,i),u=d(e.Vn,i));let c=n+_*(h-r),f=o?c:this.Vl-1-c;e.En=f,c=n+_*(l-r),f=o?c:this.Vl-1-c,e.Cn=f,c=n+_*(a-r),f=o?c:this.Vl-1-c,e.Pn=f,c=n+_*(u-r),f=o?c:this.Vl-1-c,e.On=f}}Yi(t,i){const s=this.na(t,i);return this.ba(s,i)}ba(t,i){let s=t;return this.br()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.aa()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}bt(){return this.Yl}Ma(){if(this.Xl)return this.Xl;let t=[];for(let i=0;i<this.Yl.length;i++){const s=this.Yl[i];null===s.Pi()&&s.Di(i+1),t.push(s)}return t=Fi(t),this.Xl=t,this.Xl}Sa(t){-1===this.Yl.indexOf(t)&&(this.Yl.push(t),this.ol(),this.ya())}ka(t){const i=this.Yl.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.Yl.splice(i,1),0===this.Yl.length&&(this.ra({Ms:!0}),this._a(null)),this.ol(),this.ya()}xt(){let t=null;for(const i of this.Yl){const s=i.xt();null!==s&&((null===t||s.Zh<t.Zh)&&(t=s))}return null===t?null:t.Dt}oa(){return this.$i.invertScale}Ml(){const t=null===this.xt();if(null!==this.Kl&&(t||this.Kl.xa===t))return this.Kl.Ml;this.sa.Nl();const i=this.sa.Ml();return this.Kl={Ml:i,xa:t},this.Ul.m(),i}Ta(){return this.Ul}Ca(t){this.br()||this.aa()||null===this.Zl&&null===this.Fl&&(this.gi()||(this.Zl=this.Vl-t,this.Fl=h(this.Vr()).Cr()))}Pa(t){if(this.br()||this.aa())return;if(null===this.Zl)return;this.ra({Ms:!1}),(t=this.Vl-t)<0&&(t=0);let i=(this.Zl+.2*(this.Vl-1))/(t+.2*(this.Vl-1));const s=h(this.Fl).Cr();i=Math.max(i,.1),s.Or(i),this._a(s)}Da(){this.br()||this.aa()||(this.Zl=null,this.Fl=null)}Ea(t){this.la()||null===this.Gl&&null===this.Fl&&(this.gi()||(this.Gl=t,this.Fl=h(this.Vr()).Cr()))}Oa(t){if(this.la())return;if(null===this.Gl)return;const i=h(this.Vr()).Er()/(this.fa()-1);let s=t-this.Gl;this.oa()&&(s*=-1);const n=s*i,e=h(this.Fl).Cr();e.Nr(n),this._a(e,!0),this.Kl=null}Na(){this.la()||null!==this.Gl&&(this.Gl=null,this.Fl=null)}nl(){return this.el||this.ol(),this.el}bi(t,i){switch(this.$i.mode){case 2:return this.nl().format(Pi(t,i));case 3:return this.nl().format(Ei(t,i));default:return this.Wr(t)}}Il(t){switch(this.$i.mode){case 2:case 3:return this.nl().format(t);default:return this.Wr(t)}}Ih(t){return this.Wr(t,h(this.Ra()).nl())}Lh(t,i){return t=Pi(t,i),Wi.format(t)}Aa(){return this.Yl}Ia(t){this.zl={jl:t,Wl:!1}}_s(){this.Yl.forEach((t=>t._s()))}ol(){this.Kl=null;const t=this.Ra();let i=100;null!==t&&(i=Math.round(1/t.sl())),this.el=ji,this.br()?(this.el=Wi,i=100):this.aa()?(this.el=new tt(100,1),i=100):null!==t&&(this.el=t.nl()),this.sa=new Bi(this,i,this.na.bind(this),this.ea.bind(this)),this.sa.Nl()}ya(){this.Xl=null}Ra(){return this.Yl[0]||null}pa(){return this.oa()?this.$i.scaleMargins.bottom*this.Xt()+this.Hl:this.$i.scaleMargins.top*this.Xt()+this.$l}va(){return this.oa()?this.$i.scaleMargins.top*this.Xt()+this.$l:this.$i.scaleMargins.bottom*this.Xt()+this.Hl}ma(){this.zl.Wl||(this.zl.Wl=!0,this.La())}ha(){this.Bl=null}ea(t,i){if(this.ma(),this.gi())return 0;t=this.Ll()&&t?Ni(t,this.Jl):t;const s=h(this.Vr()),n=this.va()+(this.fa()-1)*(t-s.Pr())/s.Er();return this.wa(n)}na(t,i){if(this.ma(),this.gi())return 0;const s=this.wa(t),n=h(this.Vr()),e=n.Pr()+n.Er()*((s-this.va())/(this.fa()-1));return this.Ll()?Ri(e,this.Jl):e}ua(){this.Kl=null,this.sa.Nl()}La(){const t=this.zl.jl;if(null===t)return;let i=null;const s=this.Aa();let n=0,e=0;for(const r of s){if(!r.kt())continue;const s=r.xt();if(null===s)continue;const l=r.tl(t.Xs(),t.Ks());let a=l&&l.Vr();if(null!==a){switch(this.$i.mode){case 1:a=Ai(a,this.Jl);break;case 2:a=Di(a,s.Dt);break;case 3:a=Oi(a,s.Dt)}if(i=null===i?a:i.Os(h(a)),null!==l){const t=l.Br();null!==t&&(n=Math.max(n,t.above),e=Math.max(n,t.below))}}}if(n===this.$l&&e===this.Hl||(this.$l=n,this.Hl=e,this.Kl=null,this.ha()),null!==i){if(i.Pr()===i.Dr()){const t=this.Ra(),s=5*(null===t||this.br()||this.aa()?1:t.sl());this.Ll()&&(i=Ii(i,this.Jl)),i=new _i(i.Pr()-s,i.Dr()+s),this.Ll()&&(i=Ai(i,this.Jl))}if(this.Ll()){const t=Ii(i,this.Jl),s=Li(t);if(r=s,l=this.Jl,r.Sl!==l.Sl||r.yl!==l.yl){const n=null!==this.Fl?Ii(this.Fl,this.Jl):null;this.Jl=s,i=Ai(t,s),null!==n&&(this.Fl=Ai(n,s))}}this._a(i)}else null===this.Ir&&(this._a(new _i(-.5,.5)),this.Jl=Li(null));var r,l;this.zl.Wl=!0}ga(){return this.br()?Pi:this.aa()?Ei:this.Ll()?t=>Ni(t,this.Jl):null}Wr(t,i){return void 0===this.ia.priceFormatter?(void 0===i&&(i=this.nl()),i.format(t)):this.ia.priceFormatter(t)}}class Hi{constructor(t,i,s=0){this.Yl=[],this.Va=new Map,this.Vl=0,this.de=0,this.Ba=1e3,this.Xl=null,this.Fa=new m,this.za=t,this.yi=i,this.Wa=new Ti(this);const n=i.F();this.ja=this.$a("left",n.leftPriceScale),this.Ha=0===s?this.$a("right",n.rightPriceScale):this.$a("non-primary",n.nonPrimaryPriceScale),this.ja.ca().l(this.Ua.bind(this,this.ja),this),this.Ha.ca().l(this.Ua.bind(this,this.Ha),this),this.qa(n)}qa(t){if(t.leftPriceScale&&this.ja.Hr(t.leftPriceScale),"right"===this.Ha.al()&&t.rightPriceScale&&this.Ha.Hr(t.rightPriceScale),"non-primary"===this.Ha.al()&&t.nonPrimaryPriceScale&&this.Ha.Hr(t.nonPrimaryPriceScale),t.localization&&(this.ja.ol(),this.Ha.ol()),t.overlayPriceScales){const i=Array.from(this.Va.values());for(const s of i){const i=h(s[0].Pt());i.Hr(t.overlayPriceScales),t.localization&&i.ol()}}}Ya(t){switch(t){case"left":return this.ja;case"right":return this.Ha}return this.Va.has(t)?r(this.Va.get(t))[0].Pt():null}S(){this.$t().Xa().v(this),this.ja.ca().v(this),this.Ha.ca().v(this),this.Yl.forEach((t=>{t.S&&t.S()})),this.Fa.m()}Ka(){return this.Ba}Za(t){this.Ba=t}$t(){return this.yi}Yt(){return this.de}Xt(){return this.Vl}Ga(t){this.de=t,this.Ja()}da(t){this.Vl=t,this.ja.da(t),this.Ha.da(t),this.Yl.forEach((i=>{if(this.ge(i)){const s=i.Pt();null!==s&&s.da(t)}})),this.Ja()}bt(){return this.Yl}ge(t){const i=t.Pt();return null===i||this.ja!==i&&this.Ha!==i}Sa(t,i,s){const n=void 0!==s?s:this.io().Qa+1;this.so(t,i,n)}ka(t){const i=this.Yl.indexOf(t);e(-1!==i,"removeDataSource: invalid data source"),this.Yl.splice(i,1);const s=h(t.Pt()).al();if(this.Va.has(s)){const i=r(this.Va.get(s)),n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.Va.delete(s))}const n=t.Pt();n&&n.bt().indexOf(t)>=0&&n.ka(t),null!==n&&(n.ya(),this.no(n)),this.Xl=null}Me(t){return t===this.ja?"left":t===this.Ha?"right":"overlay"}eo(){return this.ja}ro(){return this.Ha}ho(t,i){t.Ca(i)}lo(t,i){t.Pa(i),this.Ja()}ao(t){t.Da()}oo(t,i){t.Ea(i)}_o(t,i){t.Oa(i),this.Ja()}uo(t){t.Na()}Ja(){this.Yl.forEach((t=>{t._s()}))}qi(){let t=null;return this.yi.F().rightPriceScale.visible&&0!==this.Ha.bt().length?t=this.Ha:this.yi.F().leftPriceScale.visible&&0!==this.ja.bt().length?t=this.ja:0!==this.Yl.length&&(t=this.Yl[0].Pt()),null===t&&(t=this.Ha),t}be(){let t=null;return this.yi.F().rightPriceScale.visible?t=this.Ha:this.yi.F().leftPriceScale.visible&&(t=this.ja),t}no(t){null!==t&&t.la()&&this.co(t)}do(t){const i=this.za._n();t.ra({Ms:!0}),null!==i&&t.Ia(i),this.Ja()}fo(){this.co(this.ja),this.co(this.Ha)}po(){this.no(this.ja),this.no(this.Ha),this.Yl.forEach((t=>{this.ge(t)&&this.no(t.Pt())})),this.Ja(),this.yi.Ur()}Ma(){return null===this.Xl&&(this.Xl=Fi(this.Yl)),this.Xl}vo(){return this.Fa}mo(){return this.Wa}co(t){const i=t.Aa();if(i&&i.length>0&&!this.za.gi()){const i=this.za._n();null!==i&&t.Ia(i)}t._s()}io(){const t=this.Ma();if(0===t.length)return{wo:0,Qa:0};let i=0,s=0;for(let n=0;n<t.length;n++){const e=t[n].Pi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{wo:i,Qa:s}}so(t,i,s){let n=this.Ya(i);if(null===n&&(n=this.$a(i,this.yi.F().overlayPriceScales)),this.Yl.push(t),!Z(i)){const s=this.Va.get(i)||[];s.push(t),this.Va.set(i,s)}n.Sa(t),t.Ei(n),t.Di(s),this.no(n),this.Xl=null}Ua(t,i,s){i.Te!==s.Te&&this.co(t)}$a(t,i){const s=Object.assign({visible:!0,autoScale:!0},y(i)),n=new $i(t,s,this.yi.F().layout,this.yi.F().localization);return n.da(this.Xt()),n}}const Ui=t=>t.getUTCFullYear();function qi(t,i,s){return i.replace(/yyyy/g,(t=>Q(Ui(t),4))(t)).replace(/yy/g,(t=>Q(Ui(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>Q((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>Q((t=>t.getUTCDate())(t),2))(t))}class Yi{constructor(t="yyyy-MM-dd",i="default"){this.bo=t,this.Mo=i}So(t){return qi(t,this.bo,this.Mo)}}class Xi{constructor(t){this.yo=t||"%h:%m:%s"}So(t){return this.yo.replace("%h",Q(t.getUTCHours(),2)).replace("%m",Q(t.getUTCMinutes(),2)).replace("%s",Q(t.getUTCSeconds(),2))}}const Ki={ko:"yyyy-MM-dd",xo:"%h:%m:%s",To:" ",Co:"default"};class Zi{constructor(t={}){const i=Object.assign(Object.assign({},Ki),t);this.Po=new Yi(i.ko,i.Co),this.Do=new Xi(i.xo),this.Eo=i.To}So(t){return`${this.Po.So(t)}${this.Eo}${this.Do.So(t)}`}}class Gi{constructor(t,i=50){this.Oo=0,this.No=1,this.Ro=1,this.le=new Map,this.Ao=new Map,this.Io=t,this.Lo=i}So(t){const i=t.ht,s=void 0===i.Vo?new Date(1e3*i.Bo).getTime():new Date(Date.UTC(i.Vo.year,i.Vo.month-1,i.Vo.day)).getTime(),n=this.le.get(s);if(void 0!==n)return n.Fo;if(this.Oo===this.Lo){const t=this.Ao.get(this.Ro);this.Ao.delete(this.Ro),this.le.delete(r(t)),this.Ro++,this.Oo--}const e=this.Io(t);return this.le.set(s,{Fo:e,zo:this.No}),this.Ao.set(this.No,s),this.Oo++,this.No++,e}}class Ji{constructor(t,i){e(t<=i,"right should be >= left"),this.Wo=t,this.jo=i}Xs(){return this.Wo}Ks(){return this.jo}$o(){return this.jo-this.Wo+1}Ge(t){return this.Wo<=t&&t<=this.jo}Tr(t){return this.Wo===t.Xs()&&this.jo===t.Ks()}}function Qi(t,i){return null===t||null===i?t===i:t.Tr(i)}class ts{constructor(){this.Ho=new Map,this.le=null}Uo(t,i){this.qo(i),this.le=null;for(let s=i;s<t.length;++s){const i=t[s];let n=this.Ho.get(i.Yo);void 0===n&&(n=[],this.Ho.set(i.Yo,n)),n.push({gn:s,ht:i.ht,Xo:i.Yo,Ko:i.Ko})}}Zo(t,i){const s=Math.ceil(i/t);return null!==this.le&&this.le.Go===s||(this.le={Ml:this.Jo(s),Go:s}),this.le.Ml}qo(t){if(0===t)return void this.Ho.clear();const i=[];this.Ho.forEach(((s,n)=>{t<=s[0].gn?i.push(n):s.splice(ct(s,t,(i=>i.gn<t)),1/0)}));for(const t of i)this.Ho.delete(t)}Jo(t){let i=[];for(const s of Array.from(this.Ho.keys()).sort(((t,i)=>i-t))){if(!this.Ho.get(s))continue;const n=i;i=[];const e=n.length;let h=0;const l=r(this.Ho.get(s)),a=l.length;let o=1/0,_=-1/0;for(let s=0;s<a;s++){const r=l[s],a=r.gn;for(;h<e;){const t=n[h],s=t.gn;if(!(s<a)){o=s;break}h++,i.push(t),_=s,o=1/0}o-a>=t&&a-_>=t&&(i.push(r),_=a)}for(;h<e;h++)i.push(n[h])}return i}}class is{constructor(t){this.Qo=t}t_(){return null===this.Qo?null:new Ji(Math.floor(this.Qo.Xs()),Math.ceil(this.Qo.Ks()))}i_(){return this.Qo}static s_(){return new is(null)}}var ss,ns,es,rs,hs;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(ss||(ss={}));class ls{constructor(t,i,s){this.de=0,this.n_=null,this.e_=[],this.Gl=null,this.Zl=null,this.r_=new ts,this.h_=new Map,this.l_=is.s_(),this.a_=!0,this.o_=new m,this.__=new m,this.u_=new m,this.c_=null,this.d_=null,this.f_=[],this.$i=i,this.ia=s,this.p_=i.rightOffset,this.v_=i.barSpacing,this.yi=t,this.m_()}F(){return this.$i}w_(t){w(this.ia,t),this.g_(),this.m_()}Hr(t,i){var s;w(this.$i,t),this.$i.fixLeftEdge&&this.b_(),this.$i.fixRightEdge&&this.M_(),void 0!==t.barSpacing&&this.yi.Ps(t.barSpacing),void 0!==t.rightOffset&&this.yi.Ds(t.rightOffset),void 0!==t.minBarSpacing&&this.yi.Ps(null!==(s=t.barSpacing)&&void 0!==s?s:this.v_),this.g_(),this.m_(),this.u_.m()}Xi(t){var i,s;return null!==(s=null===(i=this.e_[t])||void 0===i?void 0:i.ht)&&void 0!==s?s:null}ki(t){var i;return null!==(i=this.e_[t])&&void 0!==i?i:null}_l(t,i){if(this.e_.length<1)return null;if(t.Bo>this.e_[this.e_.length-1].ht.Bo)return i?this.e_.length-1:null;const s=ct(this.e_,t.Bo,((t,i)=>t.ht.Bo<i));return t.Bo<this.e_[s].ht.Bo?i?s:null:s}gi(){return 0===this.de||0===this.e_.length||null===this.n_}_n(){return this.S_(),this.l_.t_()}y_(){return this.S_(),this.l_.i_()}k_(){const t=this._n();if(null===t)return null;const i={from:t.Xs(),to:t.Ks()};return this.x_(i)}x_(t){const i=Math.round(t.from),s=Math.round(t.to),n=h(this.T_()),e=h(this.C_());return{from:h(this.Xi(Math.max(n,i))),to:h(this.Xi(Math.min(e,s)))}}P_(t){return{from:h(this._l(t.from,!0)),to:h(this._l(t.to,!0))}}Yt(){return this.de}Ga(t){if(!isFinite(t)||t<=0)return;if(this.de===t)return;const i=this.y_(),s=this.de;if(this.de=t,this.a_=!0,this.$i.lockVisibleTimeRangeOnResize&&0!==s){const i=this.v_*t/s;this.v_=i}if(this.$i.fixLeftEdge&&null!==i&&i.Xs()<=0){const i=s-t;this.p_-=Math.round(i/this.v_)+1,this.a_=!0}this.D_(),this.E_()}Nt(t){if(this.gi()||!b(t))return 0;const i=this.O_()+this.p_-t;return this.de-(i+.5)*this.v_-1}dn(t,i){const s=this.O_(),n=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=n;i<e;i++){const n=t[i].ht,e=s+this.p_-n,r=this.de-(e+.5)*this.v_-1;t[i].it=r}}N_(t){return Math.ceil(this.R_(t))}Ds(t){this.a_=!0,this.p_=t,this.E_(),this.yi.A_(),this.yi.Ur()}Sn(){return this.v_}Ps(t){this.I_(t),this.E_(),this.yi.A_(),this.yi.Ur()}L_(){return this.p_}Ml(){if(this.gi())return null;if(null!==this.d_)return this.d_;const t=this.v_,i=5*(this.yi.F().layout.fontSize+4),s=Math.round(i/t),n=h(this._n()),e=Math.max(n.Xs(),n.Xs()-s),r=Math.max(n.Ks(),n.Ks()-s),l=this.r_.Zo(t,i),a=this.T_()+s,o=this.C_()-s,_=this.V_(),u=this.$i.fixLeftEdge||_,c=this.$i.fixRightEdge||_;let d=0;for(const t of l){if(!(e<=t.gn&&t.gn<=r))continue;let s;d<this.f_.length?(s=this.f_[d],s.vl=this.Nt(t.gn),s.Al=this.B_(t),s.Xo=t.Xo):(s={F_:!1,vl:this.Nt(t.gn),Al:this.B_(t),Xo:t.Xo},this.f_.push(s)),this.v_>i/2&&!_?s.F_=!1:s.F_=u&&t.gn<=a||c&&t.gn>=o,d++}return this.f_.length=d,this.d_=this.f_,this.f_}z_(){this.a_=!0,this.Ps(this.$i.barSpacing),this.Ds(this.$i.rightOffset)}W_(t){this.a_=!0,this.n_=t,this.E_(),this.b_()}j_(t,i){const s=this.R_(t),n=this.Sn(),e=n+i*(n/10);this.Ps(e),this.$i.rightBarStaysOnScroll||this.Ds(this.L_()+(s-this.R_(t)))}Ca(t){this.Gl&&this.Na(),null===this.Zl&&null===this.c_&&(this.gi()||(this.Zl=t,this.H_()))}Pa(t){if(null===this.c_)return;const i=yt(this.de-t,0,this.de),s=yt(this.de-h(this.Zl),0,this.de);0!==i&&0!==s&&this.Ps(this.c_.Sn*i/s)}Da(){null!==this.Zl&&(this.Zl=null,this.U_())}Ea(t){null===this.Gl&&null===this.c_&&(this.gi()||(this.Gl=t,this.H_()))}Oa(t){if(null===this.Gl)return;const i=(this.Gl-t)/this.Sn();this.p_=h(this.c_).L_+i,this.a_=!0,this.E_()}Na(){null!==this.Gl&&(this.Gl=null,this.U_())}q_(){this.Y_(this.$i.rightOffset)}Y_(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.p_,n=performance.now(),e=()=>{const r=(performance.now()-n)/i,h=r>=1,l=h?t:s+(t-s)*r;this.Ds(l),h||setTimeout(e,20)};e()}ft(t,i){this.a_=!0,this.e_=t,this.r_.Uo(t,i),this.E_()}X_(){return this.o_}K_(){return this.__}Z_(){return this.u_}O_(){return this.n_||0}G_(t){const i=t.$o();this.I_(this.de/i),this.p_=t.Ks()-this.O_(),this.E_(),this.a_=!0,this.yi.A_(),this.yi.Ur()}J_(){const t=this.T_(),i=this.C_();null!==t&&null!==i&&this.G_(new Ji(t,i+this.$i.rightOffset))}Q_(t){const i=new Ji(t.from,t.to);this.G_(i)}xi(t){return void 0!==this.ia.timeFormatter?this.ia.timeFormatter(t.Ko):this.tu.So(new Date(1e3*t.ht.Bo))}V_(){const{handleScroll:t,handleScale:i}=this.yi.F();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}T_(){return 0===this.e_.length?null:0}C_(){return 0===this.e_.length?null:this.e_.length-1}iu(t){return(this.de-1-t)/this.v_}R_(t){const i=this.iu(t),s=this.O_()+this.p_-i;return Math.round(1e6*s)/1e6}I_(t){const i=this.v_;this.v_=t,this.D_(),i!==this.v_&&(this.a_=!0,this.su())}S_(){if(!this.a_)return;if(this.a_=!1,this.gi())return void this.nu(is.s_());const t=this.O_(),i=this.de/this.v_,s=this.p_+t,n=new Ji(s-i+1,s);this.nu(new is(n))}D_(){const t=this.eu();if(this.v_<t&&(this.v_=t,this.a_=!0),0!==this.de){const t=.5*this.de;this.v_>t&&(this.v_=t,this.a_=!0)}}eu(){return this.$i.fixLeftEdge&&this.$i.fixRightEdge&&0!==this.e_.length?this.de/this.e_.length:this.$i.minBarSpacing}E_(){const t=this.ru();this.p_>t&&(this.p_=t,this.a_=!0);const i=this.hu();null!==i&&this.p_<i&&(this.p_=i,this.a_=!0)}hu(){const t=this.T_(),i=this.n_;if(null===t||null===i)return null;return t-i-1+(this.$i.fixLeftEdge?this.de/this.v_:Math.min(2,this.e_.length))}ru(){return this.$i.fixRightEdge?0:this.de/this.v_-Math.min(2,this.e_.length)}H_(){this.c_={Sn:this.Sn(),L_:this.L_()}}U_(){this.c_=null}B_(t){let i=this.h_.get(t.Xo);return void 0===i&&(i=new Gi((t=>this.lu(t))),this.h_.set(t.Xo,i)),i.So(t)}lu(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.Xo,this.$i.timeVisible,this.$i.secondsVisible);return void 0!==this.$i.tickMarkFormatter?this.$i.tickMarkFormatter(t.Ko,i,this.ia.locale):function(t,i,s){const n={};switch(i){case 0:n.year="numeric";break;case 1:n.month="short";break;case 2:n.day="numeric";break;case 3:n.hour12=!1,n.hour="2-digit",n.minute="2-digit";break;case 4:n.hour12=!1,n.hour="2-digit",n.minute="2-digit",n.second="2-digit"}const e=void 0===t.Vo?new Date(1e3*t.Bo):new Date(Date.UTC(t.Vo.year,t.Vo.month-1,t.Vo.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,n)}(t.ht,i,this.ia.locale)}nu(t){const i=this.l_;this.l_=t,Qi(i.t_(),this.l_.t_())||this.o_.m(),Qi(i.i_(),this.l_.i_())||this.__.m(),this.su()}su(){this.d_=null}g_(){this.su(),this.h_.clear()}m_(){const t=this.ia.dateFormat;this.$i.timeVisible?this.tu=new Zi({ko:t,xo:this.$i.secondsVisible?"%h:%m:%s":"%h:%m",To:"   ",Co:this.ia.locale}):this.tu=new Yi(t,this.ia.locale)}b_(){if(!this.$i.fixLeftEdge)return;const t=this.T_();if(null===t)return;const i=this._n();if(null===i)return;const s=i.Xs()-t;if(s<0){const t=this.p_-s-1;this.Ds(t)}this.D_()}M_(){this.E_(),this.D_()}}class as extends E{constructor(t){super(),this.au=new Map,this.Rt=t}Y(t){}K(t){if(!this.Rt.kt)return;t.save();let i=0;for(const s of this.Rt.ou){if(0===s.ti.length)continue;t.font=s.D;const n=this._u(t,s.ti);n>this.Rt.Yt?s.j_=this.Rt.Yt/n:s.j_=1,i+=s.uu*s.j_}let s=0;switch(this.Rt.cu){case"top":s=0;break;case"center":s=Math.max((this.Rt.Xt-i)/2,0);break;case"bottom":s=Math.max(this.Rt.Xt-i,0)}t.fillStyle=this.Rt.N;for(const i of this.Rt.ou){t.save();let n=0;switch(this.Rt.du){case"left":t.textAlign="left",n=i.uu/2;break;case"center":t.textAlign="center",n=this.Rt.Yt/2;break;case"right":t.textAlign="right",n=this.Rt.Yt-1-i.uu/2}t.translate(n,s),t.textBaseline="top",t.font=i.D,t.scale(i.j_,i.j_),t.fillText(i.ti,0,i.fu),t.restore(),s+=i.uu*i.j_}t.restore()}_u(t,i){const s=this.pu(t.font);let n=s.get(i);return void 0===n&&(n=t.measureText(i).width,s.set(i,n)),n}pu(t){let i=this.au.get(t);return void 0===i&&(i=new Map,this.au.set(t,i)),i}}class os{constructor(t){this.li=!0,this.zt={kt:!1,N:"",Xt:0,Yt:0,ou:[],cu:"center",du:"center"},this.Wt=new as(this.zt),this.jt=t}ft(){this.li=!0}wt(t,i){return this.li&&(this.gt(t,i),this.li=!1),this.Wt}gt(t,i){const s=this.jt.F(),n=this.zt;n.kt=s.visible,n.kt&&(n.N=s.color,n.Yt=i,n.Xt=t,n.du=s.horzAlign,n.cu=s.vertAlign,n.ou=[{ti:s.text,D:C(s.fontSize,s.fontFamily,s.fontStyle),uu:1.2*s.fontSize,fu:0,j_:0}])}}class _s extends Y{constructor(t,i){super(),this.$i=i,this.Zi=new os(this)}ls(){return[]}hs(){return[this.Zi]}F(){return this.$i}_s(){this.Zi.ft()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(ns||(ns={}));class us{constructor(t,i){this.vu=[],this.mu=new Map,this.wu=[],this.de=0,this.gu=null,this.bu=null,this.Mu=new m,this.Su=new m,this.yu=!1,this.ku=null,this.xu=t,this.$i=i,this.Tu=new P(this),this.za=new ls(this,i.timeScale,this.$i.localization),this.dt=new K(this,i.crosshair),this.Cu=new yi(i.crosshair),this.Pu=new _s(this,i.watermark),this.Du(),this.vu[0].Za(2e3),this.Eu=this.Ou(0),this.Nu=this.Ou(1)}Bh(){this.Ru(new G(3))}Ur(){this.Ru(new G(2))}Jh(){this.Ru(new G(1))}zh(t){const i=this.Au(t);this.Ru(i)}Iu(){return this.bu}Lu(t){const i=this.bu;this.bu=t,null!==i&&this.zh(i.Vu),null!==t&&this.zh(t.Vu)}F(){return this.$i}Hr(t){w(this.$i,t),this.vu.forEach((i=>i.qa(t))),void 0!==t.timeScale&&this.za.Hr(t.timeScale),void 0!==t.localization&&this.za.w_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Mu.m(),this.Eu=this.Ou(0),this.Nu=this.Ou(1),this.Bh()}Bu(t,i){if("left"===t)return void this.Hr({leftPriceScale:i});if("right"===t)return void this.Hr({rightPriceScale:i});const s=this.Fu(t);null!==s&&(s.Pt.Hr(i),this.Mu.m())}Fu(t){for(const i of this.vu){const s=i.Ya(t);if(null!==s)return{Ht:i,Pt:s}}return null}St(){return this.za}zu(){return this.vu}Wu(){return this.Pu}ju(){return this.dt}$u(){return this.Su}Hu(t,i){t.da(i),this.A_()}Ga(t){this.de=t,this.za.Ga(this.de),this.vu.forEach((i=>i.Ga(t))),this.A_()}Du(t){if(void 0!==t)if(t>this.vu.length)for(let i=this.vu.length;i<t;i++)this.Du(i);else if(t<this.vu.length)return this.vu[t];const i=void 0===t?this.vu.length-1+1:t,s=new Hi(this.za,this,i);void 0!==t?this.vu.splice(t,0,s):this.vu.push(s),this.Uu();const n=new G(3);return n.gs(i,{bs:0,Ms:!0}),this.Ru(n),s}qu(t){if(0===t)return;if(this.vu[t].Ma().forEach((t=>{t instanceof Si&&this.Yu(t)})),this.yu=!0,t!==this.vu.length-1)for(let i=t+1;i<this.vu.length;i++){this.vu[i].Ma().forEach((t=>{t instanceof Si&&t.Hr({pane:i-1})}))}this.vu.splice(t,1),this.yu=!1,this.Uu();const i=new G(3);this.Ru(i)}Xu(t,i){const s=this.vu[t],n=this.vu[i];this.yu=!0,s.Ma().forEach((t=>{t instanceof Si&&t.Hr({pane:i})})),n.Ma().forEach((i=>{i instanceof Si&&i.Hr({pane:t})})),this.vu[t]=n,this.vu[i]=s,this.yu=!1,this.Uu(),this.Ru(new G(3))}ho(t,i,s){t.ho(i,s)}lo(t,i,s){t.lo(i,s),this.Wh(),this.Ru(this.Ku(t,2))}ao(t,i){t.ao(i),this.Ru(this.Ku(t,2))}oo(t,i,s){i.la()||t.oo(i,s)}_o(t,i,s){i.la()||(t._o(i,s),this.Wh(),this.Ru(this.Ku(t,2)))}uo(t,i){i.la()||(t.uo(i),this.Ru(this.Ku(t,2)))}do(t,i){t.do(i),this.Ru(this.Ku(t,2))}Zu(t){this.za.Ca(t)}Gu(t,i){const s=this.St();if(s.gi()||0===i)return;const n=s.Yt();t=Math.max(1,Math.min(t,n)),s.j_(t,i),this.A_()}Ju(t){this.Qu(0),this.tc(t),this.ic()}sc(t){this.za.Pa(t),this.A_()}nc(){this.za.Da(),this.Ur()}Qu(t){this.gu=t,this.za.Ea(t)}tc(t){let i=!1;return null!==this.gu&&Math.abs(t-this.gu)>20&&(this.gu=null,i=!0),this.za.Oa(t),this.A_(),i}ic(){this.za.Na(),this.Ur(),this.gu=null}vt(){return this.wu}ec(t,i,s){this.dt.Gi(t,i);let n=NaN,e=this.za.N_(t);const r=this.za._n();null!==r&&(e=Math.min(Math.max(r.Xs(),e),r.Ks()));const h=s.qi(),l=h.xt();null!==l&&(n=h.Yi(i,l)),n=this.Cu.ul(n,e,s),this.dt.ss(e,n,s),this.Jh();const a=this.rc(s);this.Su.m(this.dt.Mt(),{x:t,y:i,hc:a})}lc(){this.ju().es(),this.Jh(),this.Su.m(null,null)}Wh(){const t=this.dt.Ht();if(null!==t){const i=this.dt.Qi(),s=this.dt.ts();this.ec(i,s,t)}this.dt._s()}ac(t,i,s){const n=this.za.Xi(0);void 0!==i&&void 0!==s&&this.za.ft(i,s);const e=this.za.Xi(0),r=this.za.O_(),h=this.za._n();if(null!==h&&null!==n&&null!==e){const i=h.Ge(r),s=n.Bo>e.Bo,l=null!==t&&t>r&&!s,a=i&&this.za.F().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-r;this.za.Ds(this.za.L_()-i)}}this.za.W_(t)}Hh(t){null!==t&&t.po()}we(t){const i=this.vu.find((i=>i.Ma().includes(t)));return void 0===i?null:i}A_(){this.Pu._s(),this.vu.forEach((t=>t.po())),this.Wh()}S(){this.vu.forEach((t=>t.S())),this.vu.length=0,this.$i.localization.priceFormatter=void 0,this.$i.localization.timeFormatter=void 0}oc(){return this.Tu}Se(){return this.Tu.F()}Xa(){return this.Mu}_c(t,i){const s=i.pane||0;this.vu.length-1<=s&&this.Du(s);const n=this.vu[s],e=this.uc(i,t,n);return this.wu.push(e),1===this.wu.length?this.Bh():this.Ur(),e}Yu(t){const i=this.we(t),s=this.wu.indexOf(t);e(-1!==s,"Series not found"),this.wu.splice(s,1),h(i).ka(t),t.S&&t.S()}Vh(t,i){const s=h(this.we(t));s.ka(t);const n=this.Fu(i);if(null===n){const n=t.Pi();s.Sa(t,i,n)}else{const e=n.Ht===s?t.Pi():void 0;n.Ht.Sa(t,i,e)}}J_(){const t=new G(2);t.ks(),this.Ru(t)}cc(t){const i=new G(2);i.Ts(t),this.Ru(i)}Cs(){const t=new G(2);t.Cs(),this.Ru(t)}Ps(t){const i=new G(2);i.Ps(t),this.Ru(i)}Ds(t){const i=new G(2);i.Ds(t),this.Ru(i)}dc(){return this.$i.rightPriceScale.visible?"right":"left"}Fh(t,i,s){if(s===i||this.yu)return;t.F().pane!==s&&t.Hr({pane:s});const n=this.we(t);null==n||n.ka(t);const e=this.Du(s);this.fc(t,e)}vc(){return this.Nu}mc(){return this.Eu}Ot(t){const i=this.Nu,s=this.Eu;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.ku||this.ku.Hs!==s||this.ku.Us!==i)this.ku={Hs:s,Us:i,wc:new Map};else{const i=this.ku.wc.get(t);if(void 0!==i)return i}const n=function(t,i,s){const[n,e,r,h]=p(t),[l,a,u,c]=p(i),d=[o(n+s*(l-n)),o(e+s*(a-e)),o(r+s*(u-r)),_(h+s*(c-h))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(s,i,t/100);return this.ku.wc.set(t,n),n}rc(t){var i;return null!==(i=this.mu.get(t))&&void 0!==i?i:0}Ku(t,i){const s=new G(i);if(null!==t){const n=this.vu.indexOf(t);s.gs(n,{bs:i})}return s}Au(t,i){return void 0===i&&(i=2),this.Ku(this.we(t),i)}Ru(t){this.xu&&this.xu(t),this.vu.forEach((t=>t.mo().qr().ft()))}uc(t,i,s){const n=new Si(this,t,i);return this.fc(n,s),n}fc(t,i){const s=t.F().priceScaleId,n=void 0!==s?s:this.dc();i.Sa(t,n),Z(n)||t.Hr(t.F())}Ou(t){const i=this.$i.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}Uu(){this.mu.clear();for(let t=0;t<this.vu.length;t++)this.mu.set(this.vu[t],t)}}function cs(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function ds(t){return!g(t)&&!M(t)}function fs(t){return g(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(es||(es={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(rs||(rs={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(hs||(hs={}));var ps={allowDownsampling:!0};var vs=function(){function t(t,i){var s=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return s._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}();class ms{constructor(t,i){this.Lt=t,this.Vt=i}Tr(t){return this.Lt===t.Lt&&this.Vt===t.Vt}}function ws(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function gs(t){const i=h(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function bs(t,i){const s=t.createElement("canvas"),n=ws(s);return s.style.width=`${i.Lt}px`,s.style.height=`${i.Vt}px`,s.width=i.Lt*n,s.height=i.Vt*n,s}function Ms(t,i){const s=h(t.ownerDocument).createElement("canvas");t.appendChild(s);const n=function(t,i){return void 0===i&&(i=ps),new vs(t,i)}(s,{allowDownsampling:!1});return n.resizeCanvas({width:i.Lt,height:i.Vt}),n}const Ss="undefined"!=typeof window;function ys(){return!!Ss&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function ks(){return!!Ss&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function xs(t){Ss&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class Ts{constructor(t,i,s){this.gc=0,this.bc=null,this.Mc={it:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.Sc=0,this.yc=null,this.kc={it:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.xc=null,this.Tc=!1,this.Cc=null,this.Pc=null,this.Dc=!1,this.Ec=!1,this.Oc=!1,this.Nc=null,this.Rc=null,this.Ac=null,this.Ic=null,this.Lc=null,this.Vc=null,this.Bc=null,this.Fc=0,this.zc=!1,this.Wc=!1,this.jc=!1,this.$c=0,this.Hc=null,this.Uc=!ks(),this.qc=t=>{this.Yc(t)},this.Xc=t=>{if(this.Kc(t)){const i=this.Zc(t);if(++this.Sc,this.yc&&this.Sc>1){const{Gc:s}=this.Jc(Ds(t),this.kc);s<30&&!this.Oc&&this.Qc(i,this.sd.td),this.nd()}}else{const i=this.Zc(t);if(++this.gc,this.bc&&this.gc>1){const{Gc:s}=this.Jc(Ds(t),this.Mc);s<5&&!this.Ec&&this.ed(i,this.sd.rd),this.hd()}}},this.ld=t,this.sd=i,this.$i=s,this.ad()}S(){null!==this.Nc&&(this.Nc(),this.Nc=null),null!==this.Rc&&(this.Rc(),this.Rc=null),null!==this.Ic&&(this.Ic(),this.Ic=null),null!==this.Lc&&(this.Lc(),this.Lc=null),null!==this.Vc&&(this.Vc(),this.Vc=null),null!==this.Ac&&(this.Ac(),this.Ac=null),this.od(),this.hd()}_d(t){this.Ic&&this.Ic();const i=this.ud.bind(this);if(this.Ic=()=>{this.ld.removeEventListener("mousemove",i)},this.ld.addEventListener("mousemove",i),this.Kc(t))return;const s=this.Zc(t);this.ed(s,this.sd.dd),this.Uc=!0}hd(){null!==this.bc&&clearTimeout(this.bc),this.gc=0,this.bc=null,this.Mc={it:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}nd(){null!==this.yc&&clearTimeout(this.yc),this.Sc=0,this.yc=null,this.kc={it:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}ud(t){if(this.jc||null!==this.Pc)return;if(this.Kc(t))return;const i=this.Zc(t);this.ed(i,this.sd.fd),this.Uc=!0}pd(t){const i=Os(t.changedTouches,h(this.Hc));if(null===i)return;if(this.$c=Es(t),null!==this.Bc)return;if(this.Wc)return;this.zc=!0;const s=this.Jc(Ds(i),h(this.Pc)),{vd:n,md:e,Gc:r}=s;if(this.Dc||!(r<5)){if(!this.Dc){const t=.5*n,i=e>=t&&!this.$i.wd(),s=t>e&&!this.$i.gd();i||s||(this.Wc=!0),this.Dc=!0,this.Oc=!0,this.od(),this.nd()}if(!this.Wc){const s=this.Zc(t,i);this.Qc(s,this.sd.bd),Ps(t)}}}Md(t){if(0!==t.button)return;const i=this.Jc(Ds(t),h(this.Cc)),{Gc:s}=i;if(s>=5&&(this.Ec=!0,this.hd()),this.Ec){const i=this.Zc(t);this.ed(i,this.sd.Sd)}}Jc(t,i){const s=Math.abs(i.it-t.it),n=Math.abs(i.st-t.st);return{vd:s,md:n,Gc:s+n}}yd(t){let i=Os(t.changedTouches,h(this.Hc));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Hc=null,this.$c=Es(t),this.od(),this.Pc=null,this.Vc&&(this.Vc(),this.Vc=null);const s=this.Zc(t,i);if(this.Qc(s,this.sd.kd),++this.Sc,this.yc&&this.Sc>1){const{Gc:t}=this.Jc(Ds(i),this.kc);t<30&&!this.Oc&&this.Qc(s,this.sd.td),this.nd()}else this.Oc||(this.Qc(s,this.sd.xd),this.sd.xd&&Ps(t));0===this.Sc&&Ps(t),0===t.touches.length&&this.Tc&&(this.Tc=!1,Ps(t))}Yc(t){if(0!==t.button)return;const i=this.Zc(t);if(this.Cc=null,this.jc=!1,this.Lc&&(this.Lc(),this.Lc=null),ys()){this.ld.ownerDocument.documentElement.removeEventListener("mouseleave",this.qc)}if(!this.Kc(t))if(this.ed(i,this.sd.Td),++this.gc,this.bc&&this.gc>1){const{Gc:s}=this.Jc(Ds(t),this.Mc);s<5&&!this.Ec&&this.ed(i,this.sd.rd),this.hd()}else this.Ec||this.ed(i,this.sd.Cd)}od(){null!==this.xc&&(clearTimeout(this.xc),this.xc=null)}Pd(t){if(null!==this.Hc)return;const i=t.changedTouches[0];this.Hc=i.identifier,this.$c=Es(t);const s=this.ld.ownerDocument.documentElement;this.Oc=!1,this.Dc=!1,this.Wc=!1,this.Pc=Ds(i),this.Vc&&(this.Vc(),this.Vc=null);{const i=this.pd.bind(this),n=this.yd.bind(this);this.Vc=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",n)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",n,{passive:!1}),this.od(),this.xc=setTimeout(this.Dd.bind(this,t),240)}const n=this.Zc(t,i);this.Qc(n,this.sd.Ed),this.yc||(this.Sc=0,this.yc=setTimeout(this.nd.bind(this),500),this.kc=Ds(i))}Od(t){if(0!==t.button)return;const i=this.ld.ownerDocument.documentElement;ys()&&i.addEventListener("mouseleave",this.qc),this.Ec=!1,this.Cc=Ds(t),this.Lc&&(this.Lc(),this.Lc=null);{const t=this.Md.bind(this),s=this.Yc.bind(this);this.Lc=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.jc=!0,this.Kc(t))return;const s=this.Zc(t);this.ed(s,this.sd.Nd),this.bc||(this.gc=0,this.bc=setTimeout(this.hd.bind(this),500),this.Mc=Ds(t))}ad(){this.ld.addEventListener("mouseenter",this._d.bind(this)),this.ld.addEventListener("touchcancel",this.od.bind(this));{const t=this.ld.ownerDocument,i=t=>{this.sd.Rd&&(t.target&&this.ld.contains(t.target)||this.sd.Rd())};this.Rc=()=>{t.removeEventListener("touchstart",i)},this.Nc=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}ks()&&(this.Ac=()=>{this.ld.removeEventListener("dblclick",this.Xc)},this.ld.addEventListener("dblclick",this.Xc)),this.ld.addEventListener("mouseleave",this.Ad.bind(this)),this.ld.addEventListener("touchstart",this.Pd.bind(this),{passive:!0}),xs(this.ld),this.ld.addEventListener("mousedown",this.Od.bind(this)),this.Id(),this.ld.addEventListener("touchmove",(()=>{}),{passive:!1})}Id(){void 0===this.sd.Ld&&void 0===this.sd.Vd&&void 0===this.sd.Bd||(this.ld.addEventListener("touchstart",(t=>this.Fd(t.touches)),{passive:!0}),this.ld.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.Bc&&void 0!==this.sd.Vd){const i=Cs(t.touches[0],t.touches[1])/this.Fc;this.sd.Vd(this.Bc,i),Ps(t)}}),{passive:!1}),this.ld.addEventListener("touchend",(t=>{this.Fd(t.touches)})))}Fd(t){1===t.length&&(this.zc=!1),2!==t.length||this.zc||this.Tc?this.zd():this.Wd(t)}Wd(t){const i=this.ld.getBoundingClientRect()||{left:0,top:0};this.Bc={it:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,st:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Fc=Cs(t[0],t[1]),void 0!==this.sd.Ld&&this.sd.Ld(),this.od()}zd(){null!==this.Bc&&(this.Bc=null,void 0!==this.sd.Bd&&this.sd.Bd())}Ad(t){if(this.Ic&&this.Ic(),this.Kc(t))return;if(!this.Uc)return;const i=this.Zc(t);this.ed(i,this.sd.jd),this.Uc=!ks()}Dd(t){const i=Os(t.touches,h(this.Hc));if(null===i)return;const s=this.Zc(t,i);this.Qc(s,this.sd.$d),this.Oc=!0,this.Tc=!0}Kc(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Es(t)<this.$c+500}Qc(t,i){i&&i.call(this.sd,t)}ed(t,i){i&&i.call(this.sd,t)}Zc(t,i){const s=i||t,n=this.ld.getBoundingClientRect()||{left:0,top:0};return{Hd:s.clientX,Ud:s.clientY,qd:s.pageX,Yd:s.pageY,Xd:s.screenX,Kd:s.screenY,Zd:s.clientX-n.left,Gd:s.clientY-n.top,Jd:t.ctrlKey,Qd:t.altKey,tf:t.shiftKey,if:t.metaKey,sf:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,nf:t.type,ef:s.target,rf:t.view,hf:()=>{"touchstart"!==t.type&&Ps(t)}}}}function Cs(t,i){const s=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(s*s+n*n)}function Ps(t){t.cancelable&&t.preventDefault()}function Ds(t){return{it:t.pageX,st:t.pageY}}function Es(t){return t.timeStamp||performance.now()}function Os(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Ns{constructor(t,i,s,n){if(this.lf=0,this.af=0,this._f=0,this.uf=0,this.cf=0,this.df=0,this.ff=0,this.pf=!1,this.vf=t,this.mf=t.wf()[i],this.gf=t.wf()[s],this.bf=document.createElement("tr"),this.bf.style.height="1px",this.Mf=document.createElement("td"),this.Mf.style.position="relative",this.Mf.style.padding="0",this.Mf.style.margin="0",this.Mf.setAttribute("colspan","3"),this.Sf(),this.bf.appendChild(this.Mf),n)this.yf=null,this.kf=null;else{this.yf=document.createElement("div"),this.yf.style.position="absolute",this.yf.style.zIndex="50",this.yf.style.top="-4px",this.yf.style.height="9px",this.yf.style.width="100%",this.yf.style.backgroundColor="",this.yf.style.cursor="row-resize",this.Mf.appendChild(this.yf);const t={dd:this.xf.bind(this),jd:this.Tf.bind(this),Nd:this.Cf.bind(this),Ed:this.Cf.bind(this),Sd:this.Pf.bind(this),bd:this.Pf.bind(this),Td:this.Df.bind(this),kd:this.Df.bind(this)};this.kf=new Ts(this.yf,t,{wd:()=>!1,gd:()=>!0})}}S(){null!==this.kf&&this.kf.S()}Ef(){return this.bf}Of(){return new ms(this.mf.Of().Lt,1)}Nf(){const t=this.Of(),i=bs(document,t),s=gs(i);return s.fillStyle=this.vf.F().timeScale.borderColor,s.fillRect(0,0,t.Lt,t.Vt),i}ft(){this.Sf()}Sf(){this.Mf.style.background=this.vf.F().timeScale.borderColor}xf(t){null!==this.yf&&(this.yf.style.backgroundColor="hsla(225,8%,72%,.2)")}Tf(t){null===this.yf||this.pf||(this.yf.style.backgroundColor="")}Cf(t){this.lf=t.Yd,this.af=0,this._f=this.mf.Of().Vt+this.gf.Of().Vt,this.uf=this.mf.Ka()+this.gf.Ka(),this.cf=30,this.df=this._f-this.cf,this.ff=this.uf/this._f,this.pf=!0}Pf(t){this.af=t.Yd-this.lf;const i=this.mf.Of().Vt,s=yt(i+this.af,this.cf,this.df)*this.ff,n=this.uf-s;this.mf.Za(s),this.gf.Za(n),this.vf.Rf(),this.mf.Of().Vt!==i&&(this.lf=t.Yd),this.vf.$t().Bh()}Df(t){this.lf=0,this.af=0,this._f=0,this.uf=0,this.cf=0,this.df=0,this.ff=0,this.pf=!1,this.Tf(t)}}function Rs(t,i){return t.Af-i.Af}function As(t,i,s){const n=(t.Af-i.Af)/(t.ht-i.ht);return Math.sign(n)*Math.min(Math.abs(n),s)}class Is{constructor(t,i,s,n){this.If=null,this.Lf=null,this.Vf=null,this.Bf=null,this.Ff=null,this.zf=0,this.Wf=0,this.jf=!1,this.$f=t,this.Hf=i,this.Uf=s,this.Rs=n}qf(t,i){if(null!==this.If){if(this.If.ht===i)return void(this.If.Af=t);if(Math.abs(this.If.Af-t)<this.Rs)return}this.Bf=this.Vf,this.Vf=this.Lf,this.Lf=this.If,this.If={ht:i,Af:t}}Ne(t,i){if(null===this.If||null===this.Lf)return;if(i-this.If.ht>50)return;let s=0;const n=As(this.If,this.Lf,this.Hf),e=Rs(this.If,this.Lf),r=[n],h=[e];if(s+=e,null!==this.Vf){const t=As(this.Lf,this.Vf,this.Hf);if(Math.sign(t)===Math.sign(n)){const i=Rs(this.Lf,this.Vf);if(r.push(t),h.push(i),s+=i,null!==this.Bf){const t=As(this.Vf,this.Bf,this.Hf);if(Math.sign(t)===Math.sign(n)){const i=Rs(this.Vf,this.Bf);r.push(t),h.push(i),s+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/s*r[t];Math.abs(l)<this.$f||(this.Ff={Af:t,ht:i},this.Wf=l,this.zf=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.Uf))}Yf(t){const i=h(this.Ff),s=t-i.ht;return i.Af+this.Wf*(Math.pow(this.Uf,s)-1)/Math.log(this.Uf)}Xf(t){return null===this.Ff||this.Kf(t)===this.zf}Zf(){return this.jf}Gf(){this.jf=!0}Kf(t){const i=t-h(this.Ff).ht;return Math.min(i,this.zf)}}class Ls{constructor(t,i,s,n){this.fe=new Ft(200),this.W=0,this.Jf="",this.Qe="",this.oe=[],this.Qf=new Map,this.W=t,this.Jf=i,this.Qe=C(t,s,n)}S(){this.fe._e(),this.oe=[],this.Qf.clear()}tp(t,i,s,n,e){const r=this.ip(t,i);if("left"!==e){const i=ws(t.canvas);s-=Math.floor(r.sp*i)}n-=Math.floor(r.Xt/2),t.drawImage(r.np,s,n,r.Yt,r.Xt)}ip(t,i){let s;if(this.Qf.has(i))s=r(this.Qf.get(i));else{if(this.oe.length>=200){const t=r(this.oe.shift());this.Qf.delete(t)}const n=ws(t.canvas),e=Math.ceil(this.W/4.5),h=Math.round(this.W/10),l=Math.ceil(this.fe.ii(t,i)),a=Tt(Math.round(l+2*e)),o=Tt(this.W+2*e),_=bs(document,new ms(a,o));s={ti:i,sp:Math.round(Math.max(1,l)),Yt:Math.ceil(a*n),Xt:Math.ceil(o*n),np:_},0!==l&&(this.oe.push(s.ti),this.Qf.set(s.ti,s)),B(t=gs(s.np),n,(()=>{t.font=this.Qe,t.fillStyle=this.Jf,t.fillText(i,0,o-e-h)}))}return s}}class Vs{constructor(t,i,s,n){this.mi=null,this.ep=null,this.rp=!1,this.hp=new Ft(50),this.lp=new Ls(11,"#000"),this.Jf=null,this.Qe=null,this.ap=0,this.op=!1,this._p=()=>{this.up(this.Tu.F()),this.op||this.Ri.cp().$t().Ur()},this.dp=()=>{this.op||this.Ri.cp().$t().Ur()},this.Ri=t,this.$i=i,this.Tu=s,this.fp="left"===n,this.Mf=document.createElement("div"),this.Mf.style.height="100%",this.Mf.style.overflow="hidden",this.Mf.style.width="25px",this.Mf.style.left="0",this.Mf.style.position="relative",this.pp=Ms(this.Mf,new ms(16,16)),this.pp.subscribeCanvasConfigured(this._p);const e=this.pp.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.vp=Ms(this.Mf,new ms(16,16)),this.vp.subscribeCanvasConfigured(this.dp);const r=this.vp.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const h={Nd:this.Cf.bind(this),Ed:this.Cf.bind(this),Sd:this.Pf.bind(this),bd:this.Pf.bind(this),Rd:this.mp.bind(this),Td:this.Df.bind(this),kd:this.Df.bind(this),rd:this.wp.bind(this),td:this.wp.bind(this),dd:this.gp.bind(this),jd:this.Tf.bind(this)};this.kf=new Ts(this.vp.canvas,h,{wd:()=>!1,gd:()=>!0})}S(){this.kf.S(),this.vp.unsubscribeCanvasConfigured(this.dp),this.vp.destroy(),this.pp.unsubscribeCanvasConfigured(this._p),this.pp.destroy(),null!==this.mi&&this.mi.Ta().v(this),this.mi=null,this.lp.S()}Ef(){return this.Mf}rt(){return h(this.mi).F().borderColor}bp(){return this.$i.textColor}P(){return this.$i.fontSize}Mp(){return C(this.P(),this.$i.fontFamily)}Sp(){const t=this.Tu.F(),i=this.Jf!==t.N,s=this.Qe!==t.D;return(i||s)&&(this.up(t),this.Jf=t.N),s&&(this.hp._e(),this.Qe=t.D),t}yp(){if(null===this.mi)return 0;let t=0;const i=this.Sp(),s=gs(this.pp.canvas),n=this.mi.Ml();s.font=this.Mp(),n.length>0&&(t=Math.max(this.hp.ii(s,n[0].Al),this.hp.ii(s,n[n.length-1].Al)));const e=this.kp();for(let i=e.length;i--;){const n=this.hp.ii(s,e[i].ti());n>t&&(t=n)}const r=this.mi.xt();if(null!==r&&null!==this.ep){const i=this.mi.Yi(1,r),n=this.mi.Yi(this.ep.Vt-2,r);t=Math.max(t,this.hp.ii(s,this.mi.bi(Math.floor(Math.min(i,n))+.11111111111111,r)),this.hp.ii(s,this.mi.bi(Math.ceil(Math.max(i,n))-.11111111111111,r)))}const h=t||34;let l=Math.ceil(i.T+i.C+i.A+i.I+h);return l+=l%2,l}xp(t){if(t.Lt<0||t.Vt<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.ep&&this.ep.Tr(t)||(this.ep=t,this.op=!0,this.pp.resizeCanvas({width:t.Lt,height:t.Vt}),this.vp.resizeCanvas({width:t.Lt,height:t.Vt}),this.op=!1,this.Mf.style.width=t.Lt+"px",this.Mf.style.height=t.Vt+"px",this.Mf.style.minWidth=t.Lt+"px")}Tp(){return h(this.ep).Lt}Ei(t){this.mi!==t&&(null!==this.mi&&this.mi.Ta().v(this),this.mi=t,t.Ta().l(this.Ul.bind(this),this))}Pt(){return this.mi}_e(){const t=this.Ri.Cp();this.Ri.cp().$t().do(t,h(this.Pt()))}Pp(t){if(null===this.ep)return;if(1!==t){const t=gs(this.pp.canvas);this.Dp(),this.Ep(t,this.pp.pixelRatio),this.Kn(t,this.pp.pixelRatio),this.Op(t,this.pp.pixelRatio),this.Np(t,this.pp.pixelRatio)}const i=gs(this.vp.canvas),s=this.ep.Lt,n=this.ep.Vt;B(i,this.vp.pixelRatio,(()=>{i.clearRect(0,0,s,n)})),this.Rp(i,this.vp.pixelRatio)}Nf(){return this.pp.canvas}ft(){var t;null===(t=this.mi)||void 0===t||t.Ml()}Cf(t){if(null===this.mi||this.mi.gi()||!this.Ri.cp().F().handleScale.axisPressedMouseMove.price)return;const i=this.Ri.cp().$t(),s=this.Ri.Cp();this.rp=!0,i.ho(s,this.mi,t.Gd)}Pf(t){if(null===this.mi||!this.Ri.cp().F().handleScale.axisPressedMouseMove.price)return;const i=this.Ri.cp().$t(),s=this.Ri.Cp(),n=this.mi;i.lo(s,n,t.Gd)}mp(){if(null===this.mi||!this.Ri.cp().F().handleScale.axisPressedMouseMove.price)return;const t=this.Ri.cp().$t(),i=this.Ri.Cp(),s=this.mi;this.rp&&(this.rp=!1,t.ao(i,s))}Df(t){if(null===this.mi||!this.Ri.cp().F().handleScale.axisPressedMouseMove.price)return;const i=this.Ri.cp().$t(),s=this.Ri.Cp();this.rp=!1,i.ao(s,this.mi)}wp(t){this.Ri.cp().F().handleScale.axisDoubleClickReset&&this._e()}gp(t){if(null===this.mi)return;!this.Ri.cp().$t().F().handleScale.axisPressedMouseMove.price||this.mi.br()||this.mi.aa()||this.Ap(1)}Tf(t){this.Ap(0)}kp(){const t=[],i=null===this.mi?void 0:this.mi;return(s=>{for(let n=0;n<s.length;++n){const e=s[n].ls(this.Ri.Cp(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.Ri.Cp().Ma()),t}Ep(t,i){if(null===this.ep)return;const s=this.ep.Lt,n=this.ep.Vt;B(t,i,(()=>{const i=this.Ri.Cp().$t(),e=i.mc(),r=i.vc();e===r?F(t,0,0,s,n,e):z(t,0,0,s,n,e,r)}))}Kn(t,i){if(null===this.ep||null===this.mi||!this.mi.F().borderVisible)return;t.save(),t.fillStyle=this.rt();const s=Math.max(1,Math.floor(this.Sp().T*i));let n;n=this.fp?Math.floor(this.ep.Lt*i)-s:0,t.fillRect(n,0,s,Math.ceil(this.ep.Vt*i)),t.restore()}Op(t,i){if(null===this.ep||null===this.mi)return;const s=this.mi.Ml();t.save(),t.strokeStyle=this.rt(),t.font=this.Mp(),t.fillStyle=this.rt();const n=this.Sp(),e=this.fp?Math.floor((this.ep.Lt-n.C)*i-n.T*i):Math.floor(n.T*i),r=this.fp?Math.round(e-n.A*i):Math.round(e+n.C*i+n.A*i),h=this.fp?"right":"left",l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i),o=this.mi.F();if(o.borderVisible&&o.ticksVisible){const r=Math.round(n.C*i);t.beginPath();for(const n of s)t.rect(e,Math.round(n.vl*i)-a,r,l);t.fill()}t.fillStyle=this.bp();for(const n of s)this.lp.tp(t,n.Al,r,Math.round(n.vl*i),h);t.restore()}Dp(){if(null===this.ep||null===this.mi)return;let t=this.ep.Vt/2;const i=[],s=this.mi.Ma().slice(),n=this.Ri.Cp(),e=this.Sp();this.mi===n.be()&&this.Ri.Cp().Ma().forEach((t=>{n.ge(t)&&s.push(t)}));const r=this.mi.bt()[0],h=this.mi;s.forEach((s=>{const e=s.ls(n,h);e.forEach((t=>{t.ci(null),t.di()&&i.push(t)})),r===s&&e.length>0&&(t=e[0].si())}));const l=i.filter((i=>i.si()<=t)),a=i.filter((i=>i.si()>t));l.sort(((t,i)=>i.si()-t.si())),l.length&&a.length&&a.push(l[0]),a.sort(((t,i)=>t.si()-i.si())),i.forEach((t=>t.ci(t.si())));if(this.mi.F().alignLabels){for(let t=1;t<l.length;t++){const i=l[t],s=l[t-1],n=s.Xt(e,!1),r=i.si(),h=s.ui();r>h-n&&i.ci(h-n)}for(let t=1;t<a.length;t++){const i=a[t],s=a[t-1],n=s.Xt(e,!0),r=i.si(),h=s.ui();r<h+n&&i.ci(h+n)}}}Np(t,i){if(null===this.ep)return;t.save();const s=this.ep,n=this.kp(),e=this.Sp(),r=this.fp?"right":"left";n.forEach((n=>{if(n.fi()){const l=n.wt(h(this.mi));t.save(),l.q(t,e,this.hp,s.Lt,r,i),t.restore()}})),t.restore()}Rp(t,i){if(null===this.ep||null===this.mi)return;t.save();const s=this.ep,n=this.Ri.cp().$t(),e=[],r=this.Ri.Cp(),l=n.ju().ls(r,this.mi);l.length&&e.push(l);const a=this.Sp(),o=this.fp?"right":"left";e.forEach((n=>{n.forEach((n=>{t.save(),n.wt(h(this.mi)).q(t,a,this.hp,s.Lt,o,i),t.restore()}))})),t.restore()}Ap(t){this.Mf.style.cursor=1===t?"ns-resize":"default"}Ul(){const t=this.yp();this.ap<t&&this.Ri.cp().$t().Bh(),this.ap=t}up(t){this.lp.S(),this.lp=new Ls(t.P,t.N,t.O)}}function Bs(t,i,s,n,e){t.X&&t.X(i,s,n,e)}function Fs(t,i,s,n,e){t.q(i,s,n,e)}function zs(t,i){return t.hs(i)}function Ws(t,i){return t.Oi(i)}function js(t,i){return void 0!==t.Gh?t.Gh(i):[]}class $s{constructor(t,i){this.ep=new ms(0,0),this.Ip=null,this.Lp=null,this.Vp=null,this.Bp=!1,this.Fp=new m,this.zp=0,this.Wp=!1,this.jp=null,this.$p=!1,this.Hp=null,this.Up=null,this.op=!1,this._p=()=>{this.op||null===this.qp||this.yi().Ur()},this.dp=()=>{this.op||null===this.qp||this.yi().Ur()},this.Yp=t,this.qp=i,this.qp.vo().l(this.Xp.bind(this),this,!0),this.Kp=document.createElement("td"),this.Kp.style.padding="0",this.Kp.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Zp=document.createElement("td"),this.Zp.style.padding="0",this.Gp=document.createElement("td"),this.Gp.style.padding="0",this.Kp.appendChild(s),this.pp=Ms(s,new ms(16,16)),this.pp.subscribeCanvasConfigured(this._p);const n=this.pp.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.vp=Ms(s,new ms(16,16)),this.vp.subscribeCanvasConfigured(this.dp);const e=this.vp.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.bf=document.createElement("tr"),this.bf.appendChild(this.Zp),this.bf.appendChild(this.Kp),this.bf.appendChild(this.Gp),this.Jp(),this.kf=new Ts(this.vp.canvas,this,{wd:()=>null===this.jp&&!this.Yp.F().handleScroll.vertTouchDrag,gd:()=>null===this.jp&&!this.Yp.F().handleScroll.horzTouchDrag})}S(){null!==this.Ip&&this.Ip.S(),null!==this.Lp&&this.Lp.S(),this.vp.unsubscribeCanvasConfigured(this.dp),this.vp.destroy(),this.pp.unsubscribeCanvasConfigured(this._p),this.pp.destroy(),null!==this.qp&&this.qp.vo().v(this),this.kf.S()}Cp(){return h(this.qp)}Qp(t){null!==this.qp&&this.qp.vo().v(this),this.qp=t,null!==this.qp&&this.qp.vo().l($s.prototype.Xp.bind(this),this,!0),this.Jp()}cp(){return this.Yp}Ef(){return this.bf}Jp(){if(null!==this.qp&&(this.tv(),0!==this.yi().vt().length)){if(null!==this.Ip){const t=this.qp.eo();this.Ip.Ei(h(t))}if(null!==this.Lp){const t=this.qp.ro();this.Lp.Ei(h(t))}}}iv(){null!==this.Ip&&this.Ip.ft(),null!==this.Lp&&this.Lp.ft()}Ka(){return null!==this.qp?this.qp.Ka():0}Za(t){this.qp&&this.qp.Za(t)}dd(t){if(!this.qp)return;this.sv();const i=t.Zd,s=t.Gd;this.nv(i,s)}Nd(t){this.sv(),this.ev(),this.nv(t.Zd,t.Gd)}fd(t){if(!this.qp)return;this.sv();const i=t.Zd,s=t.Gd;this.nv(i,s);const n=this.tr(i,s);this.yi().Lu(n&&{Vu:n.Vu,rv:n.rv})}Cd(t){if(null===this.qp)return;this.sv();const i=t.Zd,s=t.Gd;if(this.Fp.M()){const t=this.yi().ju().Mt(),n=this.yi().rc(h(this.qp));this.Fp.m(t,{x:i,y:s,hc:n})}}Sd(t){this.sv(),this.hv(t),this.nv(t.Zd,t.Gd)}Td(t){null!==this.qp&&(this.sv(),this.Wp=!1,this.lv(t))}$d(t){if(this.Wp=!0,null===this.jp){const i={x:t.Zd,y:t.Gd};this.av(i,i)}}jd(t){null!==this.qp&&(this.sv(),this.qp.$t().Lu(null),this.ov())}_v(){return this.Fp}Ld(){this.zp=1,this.uv()}Vd(t,i){if(!this.Yp.F().handleScale.pinch)return;const s=5*(i-this.zp);this.zp=i,this.yi().Gu(t.it,s)}Ed(t){if(this.Wp=!1,this.$p=null!==this.jp,this.ev(),null!==this.jp){const i=this.yi().ju();this.Hp={x:i.Kt(),y:i.Zt()},this.jp={x:t.Zd,y:t.Gd}}}bd(t){if(null===this.qp)return;const i=t.Zd,s=t.Gd;if(null===this.jp)this.hv(t);else{this.$p=!1;const t=h(this.Hp),n=t.x+(i-this.jp.x),e=t.y+(s-this.jp.y);this.nv(n,e)}}kd(t){0===this.cp().F().trackingMode.exitMode&&(this.$p=!0),this.cv(),this.lv(t)}tr(t,i){const s=this.qp;if(null===s)return null;const n=s.Ma();for(const e of n){const n=this.dv(e.hs(s),t,i);if(null!==n)return{Vu:e,rf:n.rf,rv:n.rv}}return null}fv(t,i){h("left"===i?this.Ip:this.Lp).xp(new ms(t,this.ep.Vt))}Of(){return this.ep}xp(t){if(t.Lt<0||t.Vt<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.ep.Tr(t)||(this.ep=t,this.op=!0,this.pp.resizeCanvas({width:t.Lt,height:t.Vt}),this.vp.resizeCanvas({width:t.Lt,height:t.Vt}),this.op=!1,this.Kp.style.width=t.Lt+"px",this.Kp.style.height=t.Vt+"px")}pv(){const t=h(this.qp);t.no(t.eo()),t.no(t.ro());for(const i of t.bt())if(t.ge(i)){const s=i.Pt();null!==s&&t.no(s),i._s()}}Nf(){return this.pp.canvas}Pp(t){if(0===t)return;if(null===this.qp)return;if(t>1&&this.pv(),null!==this.Ip&&this.Ip.Pp(t),null!==this.Lp&&this.Lp.Pp(t),1!==t){const t=gs(this.pp.canvas);t.save(),this.Ep(t,this.pp.pixelRatio),this.qp&&(this.vv(t,this.pp.pixelRatio),this.mv(t,this.pp.pixelRatio),this.wv(t,this.pp.pixelRatio,zs),this.wv(t,this.pp.pixelRatio,Ws)),t.restore()}const i=gs(this.vp.canvas);i.clearRect(0,0,Math.ceil(this.ep.Lt*this.vp.pixelRatio),Math.ceil(this.ep.Vt*this.vp.pixelRatio)),this.wv(i,this.pp.pixelRatio,js),this.gv(i,this.vp.pixelRatio)}bv(){return this.Ip}Mv(){return this.Kp}Sv(){return this.Lp}Xp(){null!==this.qp&&this.qp.vo().v(this),this.qp=null}Ep(t,i){B(t,i,(()=>{const i=this.yi(),s=i.mc(),n=i.vc();s===n?F(t,0,0,this.ep.Lt,this.ep.Vt,n):z(t,0,0,this.ep.Lt,this.ep.Vt,s,n)}))}vv(t,i){const s=h(this.qp),n=s.mo().qr().wt(s.Xt(),s.Yt(),s);null!==n&&(t.save(),n.q(t,i,!1),t.restore())}mv(t,i){const s=this.yi().Wu();this.yv(t,i,zs,Bs,s),this.yv(t,i,zs,Fs,s)}gv(t,i){this.yv(t,i,zs,Fs,this.yi().ju())}wv(t,i,s){const n=h(this.qp).Ma();for(const e of n)this.yv(t,i,s,Bs,e);for(const e of n)this.yv(t,i,s,Fs,e)}yv(t,i,s,n,e){const r=h(this.qp),l=s(e,r),a=r.Xt(),o=r.Yt(),_=r.$t().Iu(),u=null!==_&&_.Vu===e,c=null!==_&&u&&void 0!==_.rv?_.rv.ir:void 0;for(const s of l){const e=s.wt(a,o,r);null!==e&&(t.save(),n(e,t,i,u,c),t.restore())}}dv(t,i,s){const n=h(this.qp);for(const e of t){const t=e.wt(this.ep.Vt,this.ep.Lt,n);if(null!==t&&t.tr){const n=t.tr(i,s);if(null!==n)return{rf:e,rv:n}}}return null}tv(){if(null===this.qp)return;const t=this.Yp,i=this.qp.eo().F().visible,s=this.qp.ro().F().visible;i||null===this.Ip||(this.Zp.removeChild(this.Ip.Ef()),this.Ip.S(),this.Ip=null),s||null===this.Lp||(this.Gp.removeChild(this.Lp.Ef()),this.Lp.S(),this.Lp=null);const n=t.$t().oc();i&&null===this.Ip&&(this.Ip=new Vs(this,t.F().layout,n,"left"),this.Zp.appendChild(this.Ip.Ef())),s&&null===this.Lp&&(this.Lp=new Vs(this,t.F().layout,n,"right"),this.Gp.appendChild(this.Lp.Ef()))}kv(t){return t.sf&&this.Wp||null!==this.jp}xv(t){return Math.max(0,Math.min(t,this.ep.Lt-1))}Tv(t){return Math.max(0,Math.min(t,this.ep.Vt-1))}nv(t,i){this.yi().ec(this.xv(t),this.Tv(i),h(this.qp))}ov(){this.yi().lc()}cv(){this.$p&&(this.jp=null,this.ov())}av(t,i){this.jp=t,this.$p=!1,this.nv(i.x,i.y);const s=this.yi().ju();this.Hp={x:s.Kt(),y:s.Zt()}}yi(){return this.Yp.$t()}Cv(){const t=this.yi(),i=this.Cp(),s=i.qi();t.uo(i,s),t.ic(),this.Vp=null,this.Bp=!1}lv(t){if(!this.Bp)return;const i=performance.now();if(null!==this.Up&&this.Up.Ne(t.Zd,i),null===this.Up||this.Up.Xf(i))return void this.Cv();const s=this.yi(),n=s.St(),e=this.Up,r=()=>{if(e.Zf())return;const t=performance.now();let i=e.Xf(t);if(!e.Zf()){const r=n.L_();s.tc(e.Yf(t)),r===n.L_()&&(i=!0,this.Up=null)}i?this.Cv():requestAnimationFrame(r)};requestAnimationFrame(r)}sv(){this.jp=null}ev(){if(!this.qp)return;if(this.uv(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)h(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.qp.qi().gi()&&this.yi().St().gi()}hv(t){if(null===this.qp)return;const i=this.yi();if(i.St().gi())return;const s=this.Yp.F(),n=s.handleScroll,e=s.kineticScroll;if((!n.pressedMouseMove||t.sf)&&(!n.horzTouchDrag&&!n.vertTouchDrag||!t.sf))return;const r=this.qp.qi(),h=performance.now();null!==this.Vp||this.kv(t)||(this.Vp={x:t.Hd,y:t.Ud,Bo:h,Zd:t.Zd,Gd:t.Gd}),null!==this.Up&&this.Up.qf(t.Zd,h),null===this.Vp||this.Bp||this.Vp.x===t.Hd&&this.Vp.y===t.Ud||(null===this.Up&&(t.sf&&e.touch||!t.sf&&e.mouse)&&(this.Up=new Is(.2,7,.997,15),this.Up.qf(this.Vp.Zd,this.Vp.Bo),this.Up.qf(t.Zd,h)),r.gi()||i.oo(this.qp,r,t.Gd),i.Qu(t.Zd),this.Bp=!0),this.Bp&&(r.gi()||i._o(this.qp,r,t.Gd),i.tc(t.Zd))}uv(){const t=performance.now(),i=null===this.Up||this.Up.Xf(t);null!==this.Up&&(i||this.Cv()),null!==this.Up&&(this.Up.Gf(),this.Up=null)}}class Hs{constructor(t,i,s,n,e){this.li=!0,this.ep=new ms(0,0),this._p=()=>this.Pp(3),this.fp="left"===t,this.Tu=s.oc,this.$i=i,this.Pv=n,this.Dv=e,this.Mf=document.createElement("div"),this.Mf.style.width="25px",this.Mf.style.height="100%",this.Mf.style.overflow="hidden",this.pp=Ms(this.Mf,new ms(16,16)),this.pp.subscribeCanvasConfigured(this._p)}S(){this.pp.unsubscribeCanvasConfigured(this._p),this.pp.destroy()}Ef(){return this.Mf}Of(){return this.ep}xp(t){if(t.Lt<0||t.Vt<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.ep.Tr(t)||(this.ep=t,this.pp.resizeCanvas({width:t.Lt,height:t.Vt}),this.Mf.style.width=`${t.Lt}px`,this.Mf.style.minWidth=`${t.Lt}px`,this.Mf.style.height=`${t.Vt}px`,this.li=!0)}Pp(t){if(t<3&&!this.li)return;if(0===this.ep.Lt||0===this.ep.Vt)return;this.li=!1;const i=gs(this.pp.canvas);this.Ep(i,this.pp.pixelRatio),this.Kn(i,this.pp.pixelRatio)}Nf(){return this.pp.canvas}Kn(t,i){if(!this.Pv())return;const s=this.ep.Lt;t.save(),t.fillStyle=this.$i.timeScale.borderColor;const n=Math.floor(this.Tu.F().T*i),e=this.fp?Math.round(s*i)-n:0;t.fillRect(e,0,n,n),t.restore()}Ep(t,i){B(t,i,(()=>{F(t,0,0,this.ep.Lt,this.ep.Vt,this.Dv())}))}}function Us(t,i){return t.Xo>i.Xo?t:i}class qs{constructor(t){this.Ev=null,this.Ov=null,this.k=null,this.Nv=!1,this.ep=new ms(0,0),this.Rv=new m,this.hp=new Ft(5),this.op=!1,this._p=()=>{this.op||this.Yp.$t().Ur()},this.dp=()=>{this.op||this.Yp.$t().Ur()},this.Yp=t,this.$i=t.F().layout,this.Av=document.createElement("tr"),this.Iv=document.createElement("td"),this.Iv.style.padding="0",this.Lv=document.createElement("td"),this.Lv.style.padding="0",this.Mf=document.createElement("td"),this.Mf.style.height="25px",this.Mf.style.padding="0",this.Vv=document.createElement("div"),this.Vv.style.width="100%",this.Vv.style.height="100%",this.Vv.style.position="relative",this.Vv.style.overflow="hidden",this.Mf.appendChild(this.Vv),this.pp=Ms(this.Vv,new ms(16,16)),this.pp.subscribeCanvasConfigured(this._p);const i=this.pp.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.vp=Ms(this.Vv,new ms(16,16)),this.vp.subscribeCanvasConfigured(this.dp);const s=this.vp.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Av.appendChild(this.Iv),this.Av.appendChild(this.Mf),this.Av.appendChild(this.Lv),this.Bv(),this.Yp.$t().Xa().l(this.Bv.bind(this),this),this.kf=new Ts(this.vp.canvas,this,{wd:()=>!0,gd:()=>!1})}S(){this.kf.S(),null!==this.Ev&&this.Ev.S(),null!==this.Ov&&this.Ov.S(),this.vp.unsubscribeCanvasConfigured(this.dp),this.vp.destroy(),this.pp.unsubscribeCanvasConfigured(this._p),this.pp.destroy()}Ef(){return this.Av}Fv(){return this.Ev}zv(){return this.Ov}Nd(t){if(this.Nv)return;this.Nv=!0;const i=this.Yp.$t();!i.St().gi()&&this.Yp.F().handleScale.axisPressedMouseMove.time&&i.Zu(t.Zd)}Ed(t){this.Nd(t)}Rd(){const t=this.Yp.$t();!t.St().gi()&&this.Nv&&(this.Nv=!1,this.Yp.F().handleScale.axisPressedMouseMove.time&&t.nc())}Sd(t){const i=this.Yp.$t();!i.St().gi()&&this.Yp.F().handleScale.axisPressedMouseMove.time&&i.sc(t.Zd)}bd(t){this.Sd(t)}Td(){this.Nv=!1;const t=this.Yp.$t();t.St().gi()&&!this.Yp.F().handleScale.axisPressedMouseMove.time||t.nc()}kd(){this.Td()}rd(){this.Yp.F().handleScale.axisDoubleClickReset&&this.Yp.$t().Cs()}td(){this.rd()}dd(){this.Yp.$t().F().handleScale.axisPressedMouseMove.time&&this.Ap(1)}jd(){this.Ap(0)}Of(){return this.ep}Wv(){return this.Rv}jv(t,i,s){this.ep&&this.ep.Tr(t)||(this.ep=t,this.op=!0,this.pp.resizeCanvas({width:t.Lt,height:t.Vt}),this.vp.resizeCanvas({width:t.Lt,height:t.Vt}),this.op=!1,this.Mf.style.width=t.Lt+"px",this.Mf.style.height=t.Vt+"px",this.Rv.m(t)),null!==this.Ev&&this.Ev.xp(new ms(i,t.Vt)),null!==this.Ov&&this.Ov.xp(new ms(s,t.Vt))}$v(){const t=this.Hv();return Math.ceil(t.T+t.C+t.P+t.L+t.R)}ft(){this.Yp.$t().St().Ml()}Nf(){return this.pp.canvas}Pp(t){if(0===t)return;if(1!==t){const i=gs(this.pp.canvas);this.Ep(i,this.pp.pixelRatio),this.Kn(i,this.pp.pixelRatio),this.Op(i,this.pp.pixelRatio),null!==this.Ev&&this.Ev.Pp(t),null!==this.Ov&&this.Ov.Pp(t)}const i=gs(this.vp.canvas),s=this.vp.pixelRatio;i.clearRect(0,0,Math.ceil(this.ep.Lt*s),Math.ceil(this.ep.Vt*s)),this.Uv([this.Yp.$t().ju()],i,s)}Ep(t,i){B(t,i,(()=>{F(t,0,0,this.ep.Lt,this.ep.Vt,this.Yp.$t().vc())}))}Kn(t,i){if(this.Yp.F().timeScale.borderVisible){t.save(),t.fillStyle=this.qv();const s=Math.max(1,Math.floor(this.Hv().T*i));t.fillRect(0,0,Math.ceil(this.ep.Lt*i),s),t.restore()}}Op(t,i){const s=this.Yp.$t().St(),n=s.Ml();if(!n||0===n.length)return;let e=n.reduce(Us,n[0]).Xo;e>30&&e<50&&(e=30),t.save(),t.strokeStyle=this.qv();const r=this.Hv(),h=r.T+r.C+r.L+r.P-r.V;t.textAlign="center",t.fillStyle=this.qv();const l=Math.floor(this.Hv().T*i),a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i),_=s.F();if(_.borderVisible&&_.ticksVisible){t.beginPath();const s=Math.round(r.C*i);for(let e=n.length;e--;){const r=Math.round(n[e].vl*i);t.rect(r-o,l,a,s)}t.fill()}t.fillStyle=this.$(),B(t,i,(()=>{t.font=this.Yv();for(const i of n)if(i.Xo<e){const s=i.F_?this.Xv(t,i.vl,i.Al):i.vl;t.fillText(i.Al,s,h)}t.font=this.Kv();for(const i of n)if(i.Xo>=e){const s=i.F_?this.Xv(t,i.vl,i.Al):i.vl;t.fillText(i.Al,s,h)}})),t.restore()}Xv(t,i,s){const n=this.hp.ii(t,s),e=n/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+n>this.ep.Lt&&(i-=Math.abs(this.ep.Lt-(r+n))),i}Uv(t,i,s){const n=this.Hv();for(const e of t)for(const t of e.Ni())i.save(),t.wt().q(i,n,s),i.restore()}qv(){return this.Yp.F().timeScale.borderColor}$(){return this.$i.textColor}W(){return this.$i.fontSize}Yv(){return C(this.W(),this.$i.fontFamily)}Kv(){return C(this.W(),this.$i.fontFamily,"bold")}Hv(){null===this.k&&(this.k={T:1,V:NaN,L:NaN,R:NaN,Si:NaN,C:3,P:NaN,D:"",Mi:new Ft});const t=this.k,i=this.Yv();if(t.D!==i){const s=this.W();t.P=s,t.D=i,t.L=Math.ceil(s/2.5),t.R=t.L,t.Si=Math.ceil(s/2),t.V=Math.round(this.W()/5),t.Mi._e()}return this.k}Ap(t){this.Mf.style.cursor=1===t?"ew-resize":"default"}Bv(){const t=this.Yp.$t(),i=t.F();i.leftPriceScale.visible||null===this.Ev||(this.Iv.removeChild(this.Ev.Ef()),this.Ev.S(),this.Ev=null),i.rightPriceScale.visible||null===this.Ov||(this.Lv.removeChild(this.Ov.Ef()),this.Ov.S(),this.Ov=null);const s={oc:this.Yp.$t().oc()},n=()=>i.leftPriceScale.borderVisible&&t.St().F().borderVisible,e=()=>t.vc();i.leftPriceScale.visible&&null===this.Ev&&(this.Ev=new Hs("left",i,s,n,e),this.Iv.appendChild(this.Ev.Ef())),i.rightPriceScale.visible&&null===this.Ov&&(this.Ov=new Hs("right",i,s,n,e),this.Lv.appendChild(this.Ov.Ef()))}}class Ys{constructor(t,i){var s;this.Zv=[],this.Gv=[],this.Jv=0,this.Vl=0,this.de=0,this.Qv=0,this.tm=0,this.im=null,this.sm=!1,this.Fp=new m,this.Su=new m,this.$i=i,this.Av=document.createElement("div"),this.Av.classList.add("tv-lightweight-charts"),this.Av.style.overflow="hidden",this.Av.style.width="100%",this.Av.style.height="100%",(s=this.Av).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.nm=document.createElement("table"),this.nm.setAttribute("cellspacing","0"),this.Av.appendChild(this.nm),this.rm=this.hm.bind(this),this.Av.addEventListener("wheel",this.rm,{passive:!1}),this.yi=new us(this.xu.bind(this),this.$i),this.$t().$u().l(this.lm.bind(this),this),this.am=new qs(this),this.nm.appendChild(this.am.Ef());let n=this.$i.width,e=this.$i.height;if(0===n||0===e){const i=t.getBoundingClientRect();0===n&&(n=Math.floor(i.width),n-=n%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.om(n,e),this._m(),t.appendChild(this.Av),this.um(),this.yi.St().Z_().l(this.yi.Bh.bind(this.yi),this),this.yi.Xa().l(this.yi.Bh.bind(this.yi),this)}$t(){return this.yi}F(){return this.$i}wf(){return this.Zv}dm(){return this.am}S(){this.Av.removeEventListener("wheel",this.rm),0!==this.Jv&&window.cancelAnimationFrame(this.Jv),this.yi.$u().v(this),this.yi.St().Z_().v(this),this.yi.Xa().v(this),this.yi.S();for(const t of this.Zv)this.nm.removeChild(t.Ef()),t._v().v(this),t.S();this.Zv=[];for(const t of this.Gv)this.fm(t);this.Gv=[],h(this.am).S(),null!==this.Av.parentElement&&this.Av.parentElement.removeChild(this.Av),this.Su.S(),this.Fp.S()}om(t,i,s=!1){if(this.Vl===i&&this.de===t)return;this.Vl=i,this.de=t;const n=i+"px",e=t+"px";h(this.Av).style.height=n,h(this.Av).style.width=e,this.nm.style.height=n,this.nm.style.width=e,s?this.pm(new G(3)):this.yi.Bh()}Pp(t){void 0===t&&(t=new G(3));for(let i=0;i<this.Zv.length;i++)this.Zv[i].Pp(t.ys(i).bs);this.$i.timeScale.visible&&this.am.Pp(t.Ss())}Hr(t){this.yi.Hr(t),this.um();const i=t.width||this.de,s=t.height||this.Vl;this.om(i,s)}_v(){return this.Fp}$u(){return this.Su}vm(){null!==this.im&&(this.pm(this.im),this.im=null);const t=this.Zv[0],i=bs(document,new ms(this.de,this.Vl)),s=gs(i),n=ws(i);return B(s,n,(()=>{let i=0,n=0;const e=t=>{for(let e=0;e<this.Zv.length;e++){const r=this.Zv[e],l=r.Of().Vt,a=h("left"===t?r.bv():r.Sv()),o=a.Nf();if(s.drawImage(o,i,n,a.Tp(),l),n+=l,e<this.Zv.length-1){const t=this.Gv[e],r=t.Of(),h=t.Nf();s.drawImage(h,i,n,r.Lt,r.Vt),n+=r.Vt}}};this.wm()&&(e("left"),i=h(t.bv()).Tp()),n=0;for(let t=0;t<this.Zv.length;t++){const e=this.Zv[t],r=e.Of(),h=e.Nf();if(s.drawImage(h,i,n,r.Lt,r.Vt),n+=r.Vt,t<this.Zv.length-1){const e=this.Gv[t],r=e.Of(),h=e.Nf();s.drawImage(h,i,n,r.Lt,r.Vt),n+=r.Vt}}i+=t.Of().Lt,this.gm()&&(n=0,e("right"));const r=t=>{const e=h("left"===t?this.am.Fv():this.am.zv()),r=e.Of(),l=e.Nf();s.drawImage(l,i,n,r.Lt,r.Vt)};if(this.$i.timeScale.visible){i=0,this.wm()&&(r("left"),i=h(t.bv()).Tp());const e=this.am.Of(),l=this.am.Nf();s.drawImage(l,i,n,e.Lt,e.Vt),this.gm()&&(i+=t.Of().Lt,r("right"),s.restore())}})),i}bm(t){if("left"===t&&!this.wm())return 0;if("right"===t&&!this.gm())return 0;if(0===this.Zv.length)return 0;return h("left"===t?this.Zv[0].bv():this.Zv[0].Sv()).Tp()}Rf(){this.Mm()}Mm(){var t;let i=0,s=0,n=0;for(const t of this.Zv)this.wm()&&(s=Math.max(s,h(t.bv()).yp())),this.gm()&&(n=Math.max(n,h(t.Sv()).yp())),i+=t.Ka();const e=this.de,r=this.Vl,l=Math.max(e-s-n,0),a=1*this.Gv.length,o=this.$i.timeScale.visible;let _=o?this.am.$v():0;_%2&&(_+=1);const u=a+_,c=r<u?0:r-u,d=c/i;let f=0;const p=(null===(t=document.body.ownerDocument.defaultView)||void 0===t?void 0:t.devicePixelRatio)||1;for(let t=0;t<this.Zv.length;++t){const i=this.Zv[t];i.Qp(this.yi.zu()[t]);let e=0,r=0;r=t===this.Zv.length-1?Math.ceil((c-f)*p)/p:Math.round(i.Ka()*d*p)/p,e=Math.max(r,2),f+=e,i.xp(new ms(l,e)),this.wm()&&i.fv(s,"left"),this.gm()&&i.fv(n,"right"),i.Cp()&&this.yi.Hu(i.Cp(),e)}this.am.jv(new ms(o?l:0,_),o?s:0,o?n:0),this.yi.Ga(l),this.Qv!==s&&(this.Qv=s),this.tm!==n&&(this.tm=n)}hm(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.$i.handleScroll.mouseWheel||0!==s&&this.$i.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.$i.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),n=t.clientX-this.Av.getBoundingClientRect().left;this.$t().Gu(n,i)}0!==i&&this.$i.handleScroll.mouseWheel&&this.$t().Ju(-80*i)}}pm(t){var i;const s=t.Ss();3===s&&this.Sm(),3!==s&&2!==s||(this.ym(t),this.km(t),this.am.ft(),this.Zv.forEach((t=>{t.iv()})),3===(null===(i=this.im)||void 0===i?void 0:i.Ss())&&(this.im.Os(t),this.Sm(),this.ym(this.im),this.km(this.im),t=this.im,this.im=null)),this.Pp(t)}km(t){const i=t.Es();for(const t of i)this.Ns(t)}ym(t){const i=this.yi.zu();for(let s=0;s<i.length;s++)t.ys(s).Ms&&i[s].fo()}Ns(t){const i=this.yi.St();switch(t.xs){case 0:i.J_();break;case 1:i.Q_(t.Dt);break;case 2:i.Ps(t.Dt);break;case 3:i.Ds(t.Dt);break;case 4:i.z_()}}xu(t){null!==this.im?this.im.Os(t):this.im=t,this.sm||(this.sm=!0,this.Jv=window.requestAnimationFrame((()=>{if(this.sm=!1,this.Jv=0,null!==this.im){const t=this.im;this.im=null,this.pm(t)}})))}Sm(){this._m()}fm(t){this.nm.removeChild(t.Ef()),t.S()}_m(){const t=this.yi.zu(),i=t.length,s=this.Zv.length;for(let t=i;t<s;t++){const t=r(this.Zv.pop());this.nm.removeChild(t.Ef()),t._v().v(this),t.S();const i=this.Gv.pop();void 0!==i&&this.fm(i)}for(let n=s;n<i;n++){const i=new $s(this,t[n]);if(i._v().l(this.xm.bind(this),this),this.Zv.push(i),n>0){const t=new Ns(this,n-1,n,!1);this.Gv.push(t),this.nm.insertBefore(t.Ef(),this.am.Ef())}this.nm.insertBefore(i.Ef(),this.am.Ef())}for(let s=0;s<i;s++){const i=t[s],n=this.Zv[s];n.Cp()!==i?n.Qp(i):n.Jp()}this.um(),this.Mm()}Tm(t,i){var s,n;const e=new Map;if(null!==t){this.yi.vt().forEach((i=>{const s=i.fs().uh(t);null!==s&&e.set(i,s)}))}let r;if(null!==t){const i=null===(s=this.yi.St().ki(t))||void 0===s?void 0:s.Ko;void 0!==i&&(r=i)}const h=this.$t().Iu(),l=null!==h&&h.Vu instanceof Si?h.Vu:void 0,a=null!==h&&void 0!==h.rv?h.rv.nr:void 0;return{ht:r,gn:null!=t?t:void 0,Cm:null!=i?i:void 0,hc:null!==(n=null==i?void 0:i.hc)&&void 0!==n?n:void 0,Pm:l,Dm:e,Em:a}}xm(t,i){this.Fp.m((()=>this.Tm(t,i)))}lm(t,i){this.Su.m((()=>this.Tm(t,i)))}um(){const t=this.$i.timeScale.visible?"":"none";this.am.Ef().style.display=t}wm(){return this.Zv[0].Cp().eo().F().visible}gm(){return this.Zv[0].Cp().ro().F().visible}}function Xs(t,i,s,n){const e=s.value;return{gn:i,ht:t,Dt:[e,e,e,e],Ko:n}}function Ks(t,i,s,n){const e=s.value,r={gn:i,ht:t,Dt:[e,e,e,e],Ko:n};return"color"in s&&void 0!==s.color&&(r.N=s.color),r}function Zs(t){return void 0!==t.Dt}function Gs(t){return(i,s,n,e)=>{return void 0===(r=n).open&&void 0===r.value?{ht:i,gn:s,Ko:e}:t(i,s,n,e);var r}}const Js={Candlestick:Gs((function(t,i,s,n){const e={gn:i,ht:t,Dt:[s.open,s.high,s.low,s.close],Ko:n};return"color"in s&&void 0!==s.color&&(e.N=s.color),"borderColor"in s&&void 0!==s.borderColor&&(e.Et=s.borderColor),"wickColor"in s&&void 0!==s.wickColor&&(e.Jn=s.wickColor),e})),Bar:Gs((function(t,i,s,n){const e={gn:i,ht:t,Dt:[s.open,s.high,s.low,s.close],Ko:n};return"color"in s&&void 0!==s.color&&(e.N=s.color),e})),Area:Gs(Xs),Baseline:Gs(Xs),Histogram:Gs(Ks),Line:Gs(Ks)};function Qs(t){return Js[t]}function tn(t){return 60*t*60*1e3}function sn(t){return 60*t*1e3}const nn=[{Om:(en=1,1e3*en),Xo:10},{Om:sn(1),Xo:20},{Om:sn(5),Xo:21},{Om:sn(30),Xo:22},{Om:tn(1),Xo:30},{Om:tn(3),Xo:31},{Om:tn(6),Xo:32},{Om:tn(12),Xo:33}];var en;function rn(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=nn.length-1;s>=0;--s)if(Math.floor(i.getTime()/nn[s].Om)!==Math.floor(t.getTime()/nn[s].Om))return nn[s].Xo;return 0}function hn(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].ht.Bo,n=null!==s?new Date(1e3*s):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.ht.Bo);null!==n&&(i.Yo=rn(h,n)),e+=i.ht.Bo-(s||i.ht.Bo),s=i.ht.Bo,n=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].ht.Bo-i));t[0].Yo=rn(new Date(1e3*t[0].ht.Bo),s)}}function ln(t){if(!ds(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{Bo:Math.round(i.getTime()/1e3),Vo:t}}function an(t){if(!fs(t))throw new Error("time must be of type isUTCTimestamp");return{Bo:t}}function on(t){return 0===t.length?null:ds(t[0].time)?ln:an}function _n(t){return fs(t)?an(t):ds(t)?ln(t):ln(un(t))}function un(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function cn(t){M(t.time)&&(t.time=un(t.time))}function dn(t){return{gn:0,Nm:new Map,Zh:t}}function fn(t){if(void 0!==t&&0!==t.length)return{Rm:t[0].ht.Bo,Am:t[t.length-1].ht.Bo}}function pn(t){let i;return t.forEach((t=>{void 0===i&&(i=t.Ko)})),r(i)}function vn(t){void 0===t.Ko&&(t.Ko=t.time)}class mn{constructor(){this.Im=new Map,this.Lm=new Map,this.Vm=new Map,this.Bm=[]}S(){this.Im.clear(),this.Lm.clear(),this.Vm.clear(),this.Bm=[]}Fm(t,i){let s=0!==this.Im.size,n=!1;const e=this.Lm.get(t);if(void 0!==e)if(1===this.Lm.size)s=!1,n=!0,this.Im.clear();else for(const i of this.Bm)i.pointData.Nm.delete(t)&&(n=!0);let r=[];if(0!==i.length){const s=i;s.forEach((t=>vn(t))),function(t){t.forEach(cn)}(i);const e=h(on(i)),l=Qs(t.Kr());r=s.map((i=>{const s=e(i.time);let r=this.Im.get(s.Bo);void 0===r&&(r=dn(s),this.Im.set(s.Bo,r),n=!0);const h=l(s,r.gn,i,i.Ko);return r.Nm.set(t,h),h}))}s&&this.zm(),this.Wm(t,r);let l=-1;if(n){const t=[];this.Im.forEach((i=>{t.push({Yo:0,ht:i.Zh,pointData:i,Ko:pn(i.Nm)})})),t.sort(((t,i)=>t.ht.Bo-i.ht.Bo)),l=this.jm(t)}return this.$m(t,l,function(t,i){const s=fn(t),n=fn(i);if(void 0!==s&&void 0!==n)return{$h:s.Am>=n.Am&&s.Rm>=n.Rm}}(this.Lm.get(t),e))}Yu(t){return this.Fm(t,[])}Hm(t,i){const s=i;vn(s),cn(i);const n=h(on([i]))(i.time),e=this.Vm.get(t);if(void 0!==e&&n.Bo<e.Bo)throw new Error(`Cannot update oldest data, last time=${e.Bo}, new time=${n.Bo}`);let r=this.Im.get(n.Bo);const l=void 0===r;void 0===r&&(r=dn(n),this.Im.set(n.Bo,r));const a=Qs(t.Kr())(n,r.gn,i,s.Ko);r.Nm.set(t,a),this.Um(t,a);const o={$h:Zs(a)};if(!l)return this.$m(t,-1,o);const _={Yo:0,ht:r.Zh,pointData:r,Ko:pn(r.Nm)},u=ct(this.Bm,_.ht.Bo,((t,i)=>t.ht.Bo<i));this.Bm.splice(u,0,_);for(let t=u;t<this.Bm.length;++t)wn(this.Bm[t].pointData,t);return hn(this.Bm,u),this.$m(t,u,o)}Um(t,i){let s=this.Lm.get(t);void 0===s&&(s=[],this.Lm.set(t,s));const n=0!==s.length?s[s.length-1]:null;null===n||i.ht.Bo>n.ht.Bo?Zs(i)&&s.push(i):Zs(i)?s[s.length-1]=i:s.splice(-1,1),this.Vm.set(t,i.ht)}Wm(t,i){0!==i.length?(this.Lm.set(t,i.filter(Zs)),this.Vm.set(t,i[i.length-1].ht)):(this.Lm.delete(t),this.Vm.delete(t))}zm(){for(const t of this.Bm)0===t.pointData.Nm.size&&this.Im.delete(t.ht.Bo)}jm(t){let i=-1;for(let s=0;s<this.Bm.length&&s<t.length;++s){const n=this.Bm[s],e=t[s];if(n.ht.Bo!==e.ht.Bo){i=s;break}e.Yo=n.Yo,wn(e.pointData,s)}if(-1===i&&this.Bm.length!==t.length&&(i=Math.min(this.Bm.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)wn(t[s].pointData,s);return hn(t,i),this.Bm=t,i}qm(){if(0===this.Lm.size)return null;let t=0;return this.Lm.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].gn))})),t}$m(t,i,s){const n={Ym:new Map,St:{O_:this.qm()}};if(-1!==i)this.Lm.forEach(((i,e)=>{n.Ym.set(e,{Ce:i,Xm:e===t?s:void 0})})),this.Lm.has(t)||n.Ym.set(t,{Ce:[],Xm:s}),n.St.Km=this.Bm,n.St.Zm=i;else{const i=this.Lm.get(t);n.Ym.set(t,{Ce:i||[],Xm:s})}return n}}function wn(t,i){t.gn=i,t.Nm.forEach((t=>{t.gn=i}))}function gn(t){return{value:t.Dt[3],time:t.Ko}}function bn(t){const i=gn(t);return void 0!==t.N&&(i.color=t.N),i}function Mn(t){return{open:t.Dt[0],high:t.Dt[1],low:t.Dt[2],close:t.Dt[3],time:t.Ko}}const Sn={Area:gn,Line:bn,Baseline:gn,Histogram:bn,Bar:function(t){const i=Mn(t);return void 0!==t.N&&(i.color=t.N),i},Candlestick:function(t){const i=Mn(t),{N:s,Et:n,Jn:e}=t;return void 0!==s&&(i.color=s),void 0!==n&&(i.borderColor=n),void 0!==e&&(i.wickColor=e),i}};function yn(t){return Sn[t]}const kn={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class xn{constructor(t){this.Fr=t}applyOptions(t){this.Fr.Hr(t)}options(){return this.Fr.F()}Gm(){return this.Fr}}class Tn{constructor(t,i,s){this.sn=t,this.Jm=i,this.Qm=s}priceFormatter(){return this.sn.nl()}priceToCoordinate(t){const i=this.sn.xt();return null===i?null:this.sn.Pt().Ct(t,i.Dt)}coordinateToPrice(t){const i=this.sn.xt();return null===i?null:this.sn.Pt().Yi(t,i.Dt)}barsInLogicalRange(t){if(null===t)return null;const i=new is(new Ji(t.from,t.to)).t_(),s=this.sn.fs();if(s.gi())return null;const n=s.uh(i.Xs(),1),e=s.uh(i.Ks(),-1),r=h(s.ah()),l=h(s.ds());if(null!==n&&null!==e&&n.gn>e.gn)return{barsBefore:t.from-r,barsAfter:l-t.to};const a={barsBefore:null===n||n.gn===r?t.from-r:n.gn-r,barsAfter:null===e||e.gn===l?l-t.to:l-e.gn};return null!==n&&null!==e&&(a.from=n.ht.Vo||n.ht.Bo,a.to=e.ht.Vo||e.ht.Bo),a}setData(t){this.sn.Kr(),this.Jm.tw(this.sn,t)}update(t){this.sn.Kr(),this.Jm.iw(this.sn,t)}dataByIndex(t,i){const s=this.sn.fs().uh(t,i);return null===s?null:yn(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:_n(t.time)})));this.sn.Uh(i)}markers(){return this.sn.qh().map((t=>{const{originalTime:i,time:s}=t,n=function(t,i){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(n=Object.getOwnPropertySymbols(t);e<n.length;e++)i.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(t,n[e])&&(s[n[e]]=t[n[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},n)}))}applyOptions(t){this.sn.Hr(t)}options(){return y(this.sn.F())}priceScale(){return this.Qm.priceScale(this.sn.Pt().al())}createPriceLine(t){const i=w(y(kn),t),s=this.sn.Yh(i);return new xn(s)}removePriceLine(t){this.sn.Xh(t.Gm())}seriesType(){return this.sn.Kr()}}class Cn extends Tn{applyOptions(t){cs(t),super.applyOptions(t)}}const Pn={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#efefef",entireTextOnly:!1,visible:!1,ticksVisible:!0,scaleMargins:{bottom:.1,top:.2}},Dn={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:T,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},En={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:T},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Pn),leftPriceScale:Object.assign(Object.assign({},Pn),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Pn),{visible:!0}),nonPrimaryPriceScale:Object.assign(Object.assign({},Pn),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!0},watermark:Dn,localization:{locale:Ss?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},On={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Nn={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Rn={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},An={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},In={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ln={color:"#26a69a",base:0},Vn={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Bn{constructor(t,i){this.vf=t,this.sw=i}applyOptions(t){this.vf.$t().Bu(this.sw,t)}options(){return this.mi().F()}width(){return Z(this.sw)?this.vf.bm(this.sw):0}mi(){return h(this.vf.$t().Fu(this.sw)).Pt}}class Fn{constructor(t,i){this.nw=new m,this.__=new m,this.Rv=new m,this.yi=t,this.za=t.St(),this.am=i,this.za.X_().l(this.ew.bind(this)),this.za.K_().l(this.rw.bind(this)),this.am.Wv().l(this.hw.bind(this))}S(){this.za.X_().v(this),this.za.K_().v(this),this.am.Wv().v(this),this.nw.S(),this.__.S(),this.Rv.S()}scrollPosition(){return this.za.L_()}scrollToPosition(t,i){i?this.za.Y_(t,1e3):this.yi.Ds(t)}scrollToRealTime(){this.za.q_()}getVisibleRange(){var t,i;const s=this.za.k_();return null===s?null:{from:null!==(t=s.from.Vo)&&void 0!==t?t:s.from.Bo,to:null!==(i=s.to.Vo)&&void 0!==i?i:s.to.Bo}}setVisibleRange(t){const i={from:_n(t.from),to:_n(t.to)},s=this.za.P_(i);this.yi.cc(s)}getVisibleLogicalRange(){const t=this.za.y_();return null===t?null:{from:t.Xs(),to:t.Ks()}}setVisibleLogicalRange(t){e(t.from<=t.to,"The from index cannot be after the to index."),this.yi.cc(t)}resetTimeScale(){this.yi.Cs()}fitContent(){this.yi.J_()}logicalToCoordinate(t){const i=this.yi.St();return i.gi()?null:i.Nt(t)}coordinateToLogical(t){return this.za.gi()?null:this.za.N_(t)}timeToCoordinate(t){const i=_n(t),s=this.za._l(i,!1);return null===s?null:this.za.Nt(s)}coordinateToTime(t){var i;const s=this.yi.St(),n=s.N_(t),e=s.Xi(n);return null===e?null:null!==(i=e.Vo)&&void 0!==i?i:e.Bo}width(){return this.am.Of().Lt}height(){return this.am.Of().Vt}subscribeVisibleTimeRangeChange(t){this.nw.l(t)}unsubscribeVisibleTimeRangeChange(t){this.nw.p(t)}subscribeVisibleLogicalRangeChange(t){this.__.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.__.p(t)}subscribeSizeChange(t){this.Rv.l(t)}unsubscribeSizeChange(t){this.Rv.p(t)}applyOptions(t){this.za.Hr(t)}options(){return y(this.za.F())}ew(){this.nw.M()&&this.nw.m(this.getVisibleRange())}rw(){this.__.M()&&this.__.m(this.getVisibleLogicalRange())}hw(t){this.Rv.m(t.Lt,t.Vt)}}function zn(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function Wn(t){return function(t){if(S(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&S(t.handleScale.axisPressedMouseMove)){const i=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:i,price:i}}const i=t.handleScroll;S(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class jn{constructor(t,i){this.lw=new mn,this.aw=new Map,this.ow=new Map,this._w=new m,this.uw=new m;const s=void 0===i?y(En):w(y(En),Wn(i));this.vf=new Ys(t,s),this.vf._v().l((t=>{this._w.M()&&this._w.m(this.cw(t()))}),this),this.vf.$u().l((t=>{this.uw.M()&&this.uw.m(this.cw(t()))}),this);const n=this.vf.$t();this.dw=new Fn(n,this.vf.dm())}remove(){this.vf._v().v(this),this.vf.$u().v(this),this.dw.S(),this.vf.S(),this.aw.clear(),this.ow.clear(),this._w.S(),this.uw.S(),this.lw.S()}resize(t,i,s){this.vf.om(t,i,s)}addAreaSeries(t={}){zn(t.priceFormat);const i=w(y(Vn),An,t),s=this.vf.$t()._c("Area",i),n=new Tn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addBaselineSeries(t={}){zn(t.priceFormat);const i=w(y(Vn),y(In),t),s=this.vf.$t()._c("Baseline",i),n=new Tn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addBarSeries(t={}){zn(t.priceFormat);const i=w(y(Vn),Nn,t),s=this.vf.$t()._c("Bar",i),n=new Tn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addCandlestickSeries(t={}){cs(t),zn(t.priceFormat);const i=w(y(Vn),On,t),s=this.vf.$t()._c("Candlestick",i),n=new Cn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addHistogramSeries(t={}){zn(t.priceFormat);const i=w(y(Vn),Ln,t),s=this.vf.$t()._c("Histogram",i),n=new Tn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}addLineSeries(t={}){zn(t.priceFormat);const i=w(y(Vn),Rn,t),s=this.vf.$t()._c("Line",i),n=new Tn(s,this,this);return this.aw.set(n,s),this.ow.set(s,n),n}removeSeries(t){const i=r(this.aw.get(t)),s=this.lw.Yu(i);this.vf.$t().Yu(i),this.fw(s),this.aw.delete(t),this.ow.delete(i)}tw(t,i){this.fw(this.lw.Fm(t,i))}iw(t,i){this.fw(this.lw.Hm(t,i))}subscribeClick(t){this._w.l(t)}unsubscribeClick(t){this._w.p(t)}subscribeCrosshairMove(t){this.uw.l(t)}unsubscribeCrosshairMove(t){this.uw.p(t)}priceScale(t){return new Bn(this.vf,t)}timeScale(){return this.dw}applyOptions(t){this.vf.Hr(Wn(t))}options(){return this.vf.F()}takeScreenshot(){return this.vf.vm()}removePane(t){this.vf.$t().qu(t)}swapPane(t,i){this.vf.$t().Xu(t,i)}getPaneElements(){return this.vf.wf().map((t=>t.Mv()))}fw(t){const i=this.vf.$t();i.ac(t.St.O_,t.St.Km,t.St.Zm),t.Ym.forEach(((t,i)=>i.G(t.Ce,t.Xm))),i.A_()}pw(t){return r(this.ow.get(t))}cw(t){const i=new Map;t.Dm.forEach(((t,s)=>{const n=yn(s.Kr())(t);e(function(t){return void 0!==t.open||void 0!==t.value}(n)),i.set(this.pw(s),n)}));const s=void 0===t.Pm?void 0:this.pw(t.Pm);return{time:t.ht,logical:t.gn,point:t.Cm,paneIndex:t.hc,hoveredSeries:s,hoveredMarkerId:t.Em,seriesData:i}}}var $n=Object.freeze({__proto__:null,version:function(){return"4.0.0"},get LineStyle(){return i},get LineType(){return t},get TrackingModeExitMode(){return ns},get CrosshairMode(){return X},get MismatchDirection(){return wi},get PriceScaleMode(){return zi},get PriceLineSource(){return rs},get LastPriceAnimationMode(){return es},get TickMarkType(){return ss},get ColorType(){return hs},isBusinessDay:ds,isUTCTimestamp:fs,createChart:function(t,i){let s;if(M(t)){const i=document.getElementById(t);e(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new jn(s,i)}});window.LightweightCharts=$n}();
